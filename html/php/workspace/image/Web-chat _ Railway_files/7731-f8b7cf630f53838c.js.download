"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7731],{94922:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){Object.keys(e).forEach(function(n){"default"===n||Object.prototype.hasOwnProperty.call(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[n]}})})}(n(24162),t)},24162:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{renderText:function(){return a},normalizeText:function(){return r},renderObject:function(){return function e(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,l=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},l=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),l.forEach(function(t){var l,a;l=e,a=n[t],t in l?Object.defineProperty(l,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):l[t]=a})}return e}({},t),r=Object.keys(l).sort(),s=0;s<n;s++){var i=!0,o=!1,c=void 0;try{for(var d,u=r[Symbol.iterator]();!(i=(d=u.next()).done);i=!0){var m=d.value,x=l[m];"string"!=typeof x&&(l[m]=e(x,n))}}catch(e){o=!0,c=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw c}}}for(var h=0;h<n;h++){var v=!0,p=!1,g=void 0;try{for(var j,f=r[Symbol.iterator]();!(v=(j=f.next()).done);v=!0){var y=j.value,b=l[y];"string"==typeof b&&(l[y]=a(l,b))}}catch(e){p=!0,g=e}finally{try{v||null==f.return||f.return()}finally{if(p)throw g}}}return l}},stripNestedContext:function(){return s},leafValueFromPath:function(){return i},findReferences:function(){return o},containsReference:function(){return c},findDirectNamespaceReference:function(){return d},findDirectReference:function(){return u},hasOnlyVariables:function(){return m},containsDirectReference:function(){return x},replaceNamespaces:function(){return h},buildTemplateTag:function(){return v},escapeNamespace:function(){return p},unescapeNamespace:function(){return g}});var n=/\${{ *([a-z0-9_." -]*?) *}}/gi,l=RegExp('\\${{ *(?:"(?<quoted>.*?)"|(?<unquoted>[^.]*))\\.(?<variable>.*?) *}}',"gi");function a(e,t){return t.replace(n,function(t){for(var n=arguments.length,l=Array(n>1?n-1:0),a=1;a<n;a++)l[a-1]=arguments[a];var r=i(l[0].split("."),e);return"string"==typeof r?r:""})}function r(e){return e.replace(n,function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),l=1;l<t;l++)n[l-1]=arguments[l];return v({variableName:n[0]})})}var s=function(e){var t={},n=!0,l=!1,a=void 0;try{for(var r,s=Object.keys(e)[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var i=r.value,o=e[i];"string"==typeof o&&(t[i]=o)}}catch(e){l=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(l)throw a}}return t},i=function(e,t){if(0===e.length)return t;var n=t[e[0]];if("string"==typeof n||"[object Object]"===Object.prototype.toString.call(n))return i(e.slice(1),n)};function o(e){var t=[],l=!0,a=!1,r=void 0;try{for(var s,i=e.matchAll(n)[Symbol.iterator]();!(l=(s=i.next()).done);l=!0){var o=s.value[1].split(".");1===o.length?t.push(o[0]):t.push("".concat(g(o[0]),".").concat(o[1]))}}catch(e){a=!0,r=e}finally{try{l||null==i.return||i.return()}finally{if(a)throw r}}return t}function c(e,t){return o(e).includes(t)}function d(e){var t=u(e);return null==t?null:g(t.split(".")[0])}function u(e){var t=o(e);return 1===t.length&&x(e,t[0])?t[0]:null}function m(e){return""===a({},e)}function x(e,t){if(!m(e))return!1;var n=o(e);return 1===n.length&&n[0]===t}function h(e,t){return e.replace(l,function(e){for(var n,l=arguments.length,a=Array(l>1?l-1:0),r=1;r<l;r++)a[r-1]=arguments[r];var s=a[a.length-1],i=null!==(n=s.quoted)&&void 0!==n?n:s.unquoted,o=s.variable,c=t[i];return c?v({variableName:o,namespace:c}):e})}function v(e){var t=e.variableName,n=e.namespace;return null==n?"${{".concat(t,"}}"):"${{".concat(p(n),".").concat(t,"}}")}function p(e){return e.match(/[.\s{}[\]]/)?'"'.concat(e,'"'):e}function g(e){return e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e}},65146:function(e,t,n){n.d(t,{F:function(){return f}});var l=n(52322),a=n(2784),r=n(6500),s=n(64853),i=n(88601),o=n.n(i),c=n(37277),d=n(4735),u=n(14307),m=n(42328),x=n(57507),h=n(64648),v=n(38532),p=n(25460),g=n(35057),j=n(77967);let f=a.forwardRef((e,t)=>{let{value:n,defaultOpen:i,options:o,onChange:p,onSelect:j,icon:f,iconText:b,overflowHint:w,behavior:S="insert",minQueryLength:k=1,...I}=e,D=(0,a.useRef)(null),[A,E]=(0,a.useState)(null),P=e=>{E(e)};(0,a.useImperativeHandle)(t,()=>A);let[T,R]=(0,a.useState)(null!=i&&i),[M,O]=(0,a.useState)(!1),[L,U]=(0,a.useState)(null),[F,V]=(0,a.useState)(0),[B,K]=(0,a.useState)(0),[z,Q]=(0,a.useState)(null!=n?n:"");(0,a.useEffect)(()=>{R(T||i||!1)},[i,T]);let{prefix:_,suffix:J,matchedOptions:W,selectableOptions:q}=(0,a.useMemo)(()=>{let e=z.slice(0,null!=F?F:0),t=z.slice(null!=B?B:0,z.length),{results:n,hasValidQuery:l}=N({options:o,prefix:e,suffix:t,minQueryLength:T?1:k}),a=l?n:o.map(e=>({obj:e,query:"",score:0,target:e.value}));return{prefix:e,suffix:t,matchedOptions:n,selectableOptions:a}},[z,F,B,T,JSON.stringify(o)]);(0,a.useEffect)(()=>{if(null==A)return;let e=(0,m.ZP)(A,{Enter:e=>{!T||e.shiftKey||e.ctrlKey||e.metaKey||e.altKey||(e.preventDefault(),e.stopPropagation(),null!==L&&Z(q[L]))},ArrowUp:e=>{var t,n;if(!T)return;e.preventDefault(),U(e=>null===e?0:e-1);let l=null!==(n=null===(t=D.current)||void 0===t?void 0:t.querySelectorAll("."+y.className))&&void 0!==n?n:[],a=l[(null!=L?L:-1)-1];null==a||a.scrollIntoView({block:"nearest"})},ArrowDown:e=>{var t,n;if(!T)return;e.preventDefault(),U(e=>null===e?0:e+1);let l=null!==(n=null===(t=D.current)||void 0===t?void 0:t.querySelectorAll("."+y.className))&&void 0!==n?n:[],a=l[(null!=L?L:-1)+1];null==a||a.scrollIntoView({block:"nearest"})},Escape:e=>{T&&(e.stopPropagation(),$())},"Control+Space":e=>{T||(e.preventDefault(),H())}});return e},[A,T,L,q]),(0,a.useEffect)(()=>{0!==q.length&&null!=L&&(L<0?U(0):L>q.length-1&&U(q.length-1))},[L,q]),(0,a.useEffect)(()=>{!T&&W.length>0&&H()},[W.length,q.length]);let Y=e=>{let t=0===e.length&&z.length>0;t&&$(),Q(e),p(e)},Z=e=>{var t;let n=null!==(t=e.query.length)&&void 0!==t?t:0,l=_.slice(0,_.length-n)+e.target,a="replace"===S?e.target:l+J;null!=A&&(A.value=a,A.setSelectionRange(l.length,l.length,"forward"),V(A.selectionStart),K(A.selectionEnd),A.focus()),Y(a),$(),null==j||j(e.obj)},H=()=>{T||(U(0),R(!0),null==A||A.focus())},$=()=>{T&&(R(!1),O(!1))},[G,X]=(0,a.useState)(),ee=()=>{null!=G&&clearTimeout(G);let e=setTimeout($,400);X(e)},et=()=>{null!=G&&clearTimeout(G)},en=(0,g.i)(100),{positionStyles:el,numToShow:ea}=(0,a.useMemo)(()=>{let e=null==A?void 0:A.getBoundingClientRect();if(null==e)return{numToShow:1/0};let t=Math.min(600,document.body.offsetHeight-e.bottom-30),n=Math.floor(t/37-1);return w&&(n-=1),(M||n<3)&&(n=1/0),{numToShow:n,positionStyles:{top:"".concat(e.bottom,"px"),left:"".concat(e.left,"px"),minWidth:"".concat(e.width,"px"),maxHeight:"".concat(t,"px")}}},[A,T,M,en]);return(0,l.jsxs)("div",{className:"relative w-full",children:[(0,l.jsx)(c.g,{ref:P,enterToSubmit:!0,autoComplete:"off",spellCheck:!1,...I,value:n,onChange:e=>Y(e.currentTarget.value),onBlur:ee,onFocus:et,onSelect:e=>{V(e.currentTarget.selectionStart),K(e.currentTarget.selectionEnd)},className:"resize-none max-h-[30vh]"}),(0,l.jsx)(d.zx,{"aria-hidden":!0,tabIndex:-1,variant:"primary",title:"Open",size:"xs",type:"button",color:"gray",onClick:H,className:"absolute right-0 top-0 mt-1 mr-1 !bg-gray-100 border-0 text-gray-600",children:(0,l.jsxs)(h.U,{align:"center",children:[(0,l.jsx)(x.JO,{icon:f,size:"xs",className:"!h-[14px] !w-[14px]"}),(0,l.jsx)(v.E.div,{animate:!n&&b?{marginLeft:"0.2rem"}:{marginLeft:0,opacity:0,width:0},className:"overflow-hidden whitespace-nowrap",children:b})]})}),(0,l.jsx)(r.f,{"aria-hidden":!0,children:T&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{onClick:$,className:"fixed top-0 left-0 right-0 bottom-0 z-50"}),(0,l.jsx)("div",{ref:D,style:el,className:"fixed z-50 bg-background shadow-md dark:bg-gray-100 rounded border border-gray-200 mt-0.5 flex",children:(0,l.jsxs)(s.x,{thumbCSS:"brightness-95 dark:brightness-125",className:"h-auto w-full p-2",children:[0===q.length&&(0,l.jsx)(C,{className:"text-gray-500 italic py-0",children:"No suggestions"}),w&&q.length>ea&&(0,l.jsxs)(C,{className:"text-gray-500",children:[(0,l.jsx)(x.JO,{icon:u.kI,size:"sm",className:"mr-2"}),(0,l.jsx)("span",{className:"text-xs",children:w})]}),q.slice(0,M?-1:ea).map(e=>(0,l.jsx)(y,{hint:e.obj.hint,isFocused:null!==L&&q[L]===e,onClick:()=>{Z(e)},onHover:()=>U(q.indexOf(e)),onBlur:()=>U(null),textBeforeCursor:_,result:e},e.obj.value+e.obj.hint)),q.length>ea&&(0,l.jsxs)(C,{hoverStyles:!0,onClick:e=>{e.stopPropagation(),e.preventDefault(),O(!0),null==A||A.focus()},className:"text-gray-500",children:[(0,l.jsx)(x.JO,{icon:u.yF,size:"sm",className:"mr-2"}),(0,l.jsxs)("span",{className:"text-sm",children:["Show ",q.length-ea," More"]})]})]})})]})})]})}),y=e=>{let{isFocused:t,onClick:n,onHover:a,onBlur:r,result:s,hint:i,textBeforeCursor:c,...d}=e;return(0,l.jsxs)(C,{isFocused:t,className:y.className,onClick:e=>{e.preventDefault(),e.stopPropagation(),n()},onMouseEnter:a,onMouseLeave:r,...d,children:[s.obj.icon&&(0,l.jsx)(x.JO,{icon:s.obj.icon,size:"sm",className:"mr-2 text-gray-500"}),(0,l.jsx)("div",{className:"font-mono text-gray-600",children:null!=s._indexes?o().highlight(s,(e,t)=>(0,l.jsx)("span",{className:"underline",children:e},t)):s.target}),null!=i&&(0,l.jsx)(p.$2,{className:"ml-auto text-gray-500",children:i})]})};y.className="autocomplete-item";let b=(e,t,n,l)=>{let a="";for(let t=0;t<e.length;t++){let r=e.length-1-t,s=e[r];if(l&&e.slice(r,r+l.length)===l)break;if(a=s+a,n&&e.slice(r,r+n.length)===n)return a}return""},w=(e,t,n)=>{for(let l=0;l<e.length;l++)if(n&&e.slice(l-n.length,l)===n||t&&e.slice(l-t.length,l)===t)return!1;return!0},N=e=>{let{options:t,prefix:n,suffix:l,minQueryLength:a}=e,r=[],s=!1;for(let e of t){var i,c;let t=e.value.slice(0,null!==(i=e.numMatchStart)&&void 0!==i?i:1),d=e.value.slice(-(null!==(c=e.numMatchStop)&&void 0!==c?c:0));if(!w(l,t,d))continue;let u=""===t?n:b(n,l,t,d);if(u.length<a||e.value.length===u.length)continue;s=!0;let m=o().single(u,e.value);null!==m&&r.push({...m,obj:e,query:u})}return{results:r,hasValidQuery:s}},C=(0,j.Q$)("div")(e=>["w-full px-2 py-2 text-sm rounded-md flex items-center cursor-default",e.isFocused&&"bg-gray-100 dark:bg-gray-200",e.hoverStyles&&"hover:bg-gray-100 dark:hover:bg-gray-200"])},12532:function(e,t,n){n.d(t,{w:function(){return r}});var l=n(25237),a=n.n(l);let r=a()(()=>Promise.all([n.e(4842),n.e(7434)]).then(n.bind(n,7434)),{loadableGenerated:{webpack:()=>[7434]},ssr:!1})},16147:function(e,t,n){n.d(t,{g:function(){return r}});var l=n(25237),a=n.n(l);let r=a()(()=>Promise.all([n.e(3706),n.e(3308)]).then(n.bind(n,23308)),{loadableGenerated:{webpack:()=>[23308]},ssr:!1})},50952:function(e,t,n){n.d(t,{d:function(){return i}});var l=n(52322),a=n(25237),r=n.n(a),s=n(18345);let i=r()(()=>Promise.all([n.e(5766),n.e(4014)]).then(n.bind(n,54014)),{loadableGenerated:{webpack:()=>[54014]},ssr:!1,loading:()=>(0,l.jsx)(s.B,{width:"100%",height:"42px"})});r()(()=>Promise.all([n.e(5766),n.e(4014)]).then(n.bind(n,54014)),{loadableGenerated:{webpack:()=>[54014]},ssr:!1})},66186:function(e,t,n){n.d(t,{A:function(){return u}});var l=n(52322),a=n(2784),r=n(15039),s=n(14307),i=n(99888),o=n(4735),c=n(25460),d=n(16147);let u=e=>{let{value:t,alwaysShowButtons:n,hideControls:u,autoFocus:m,editorStyles:x,editorId:h,onEdit:v,onChange:p,onCancel:g}=e,[j,f]=(0,a.useState)(!1),[y,b]=(0,a.useState)(!1),w=(0,a.useMemo)(()=>JSON.stringify(t,null,2),[t]),[N,C]=(0,a.useState)(w),[S,k]=(0,a.useState)(w);(0,a.useEffect)(()=>{b(N.trim()!==w.trim())},[w,N]);let I=(0,a.useMemo)(()=>(0,i.V)(N),[N]);(0,a.useEffect)(()=>{if(null!=v)try{v(I?JSON.parse(N):null,I)}catch(e){}},[N,I]);let D=async()=>{if(I)try{p&&(p(JSON.parse(N)),b(!1),k(N))}catch(e){}},A=async()=>{f(!1)},E=()=>{C(S),b(!1),null!=g&&g()},P=e=>{C(e)},T=e=>{e.metaKey&&"Enter"===e.key?(D(),e.preventDefault()):"Escape"===e.key&&(E(),e.preventDefault())};return(0,l.jsxs)("div",{className:"relative",children:[!u&&(y||n)&&(0,l.jsxs)("div",{className:"flex justify-end absolute top-1 right-1 z-10",children:[(0,l.jsx)(o.hU,{icon:s.X,title:"Cancel",onClick:e=>{E(),e.preventDefault(),e.stopPropagation()}}),(0,l.jsx)(o.hU,{icon:s.Jr,title:"Save",disabled:!I,onClick:e=>{D(),e.preventDefault(),e.stopPropagation()}})]}),(0,l.jsx)(d.g,{textareaId:null!=h?"json-editor-".concat(h):void 0,language:"json",value:N,error:!I,onChange:e=>P(e),onFocus:()=>f(!0),onBlur:()=>A(),autoFocus:m,onKeyDown:T,styles:x}),!u&&j&&(0,l.jsxs)(c.Ew,{className:"opacity-70 text-right",children:[r.Un,"+enter to save"]})]})}},36476:function(e,t,n){n.d(t,{s:function(){return o}});var l=n(92228),a=n(52322),r=n(83192);n(2784);var s=n(77967);function i(){let e=(0,l.Z)(["flex rounded-md text-gray-600 max-w-max"]);return i=function(){return e},e}let o=e=>{var t;let{value:n,options:l,onChange:r,...s}=e;return(0,a.jsx)(c,{type:"single",defaultValue:n,onValueChange:e=>{r&&r(e)},...s,children:l.map(e=>(0,a.jsx)(d,{value:e.value,children:null!==(t=e.text)&&void 0!==t?t:e.value},e.value))})},c=(0,s.Lq)(r.tX)(i()),d=(0,s.Lq)(r.ck)(()=>["relative flex items-center justify-center h-sm -ml-px","px-4 py-2 border border-gray-200","first:rounded-l first:ml-0","last:rounded-r","data-[state=on]:text-pink-500 data-[state=on]:bg-secondaryBg data-[state=on]:border-gray-300 data-[state=on]:z-50","hover:bg-secondaryBg hover:border-gray-300 hover:z-50","focus-visible:border-pink-500 focus:outline-none"])},77323:function(e,t,n){n.d(t,{r:function(){return x}});var l=n(52322),a=n(23627),r=n(91786),s=n(13928),i=n(2784),o=n(70177),c=n(98937),d=n(77967);let u={md:{classes:"w-10 h-6",width:40},sm:{classes:"w-8 h-5",width:32},xs:{classes:"w-7 h-4",width:28}},m={md:"w-5 h-5",sm:"w-4 h-4",xs:"w-3 h-3"},x=e=>{var t;let{track:n}=(0,c.K)(),x=t=>{null!=e.name&&n({action:"Toggle",object:"".concat(e.name," Switch"),properties:{isOn:t}}),e.onChange&&e.onChange(t)},h=(0,s.l)({...e,onChange:x}),v=(0,i.useRef)(null),{inputProps:p}=(0,o.h)(e,h,v),{isFocusVisible:g,focusProps:j}=(0,a.Fx)(),f=null!==(t=e.size)&&void 0!==t?t:"md";return(0,l.jsxs)("label",{className:(0,d.AK)(e.className,"flex items-center cursor-pointer"),children:[(0,l.jsx)(r.T,{children:(0,l.jsx)("input",{...p,...j,disabled:e.disabled,ref:v})}),(0,l.jsx)("div",{className:(0,d.AK)(u[f].classes,"flex items-center mr-4 rounded-full shadow",h.isSelected?"bg-pink-500":"bg-gray-300",g&&"ring-2 ring-pink-400",e.disabled&&"opacity-50"),children:(0,l.jsx)("span",{className:(0,d.AK)(m[f],"block rounded-full bg-white","transition-transform transform translate-x-1"),style:{transform:h.isSelected?"translateX(calc((".concat(u[f].width,"px - 4px) / 2))"):void 0}})}),e.children]})}},17731:function(e,t,n){n.d(t,{j:function(){return r7}});var l,a,r,s,i,o,c,d=n(52322),u=n(28879),m=n.n(u),x=n(51585),h=n(38532),v=n(25237),p=n.n(v),g=n(2784),j=n(8900),f=n(86289),y=n(83225),b=n(46824),w=n(33834),N=n(75451),C=n(82854),S=n(31921),k=n(60435),I=n(63986),D=n(1988),A=n(80031),E=n(27728),P=n(68663),T=n(67930),R=n(63798),M=n(16231);let O=e=>{let{projectId:t,enabled:n}=e,{graphqlClient:l}=(0,M.S)(),{result:a}=(0,R.o)(["source-template",t],async()=>(await l.templateSourceForProject({projectId:t})).templateSourceForProject,{enabled:n,staleTime:1/0});return{sourceTemplate:a}};var L=n(98937),U=n(14307),F=n(25154),V=n(79583),B=n(10241),K=n(77491),z=n.n(K),Q=n(33314),_=n(77967),J=n(5326),W=n(67846),q=n(4735),Y=n(37160),Z=n(64648),H=n(26343);m().extend(z());let $=e=>{let[{project:t,isTempProject:n},l]=(0,T.PY)(),{modalActions:a}=(0,F.o)(),[{user:r,claimProjectOnLogin:s},{setClaimProjectOnLogin:i}]=(0,V.aF)(),{query:o,navActions:c}=(0,P.H)(),[u,x]=(0,g.useState)(!1),h=(0,g.useMemo)(()=>null!=o.claim||s,[o.claim,s]);(0,Q.b)(async()=>{null!=t&&n&&null!=r&&h&&!u&&(i(!1),x(!0),await l.claimProject(),c.replace({url:window.location.pathname}))},[r,t,h,u]);let v=()=>{null!=r&&x(!0),l.claimProject()},p=()=>{a.openModal((0,d.jsx)(G,{claimProject:v}))};return null==t?null:(0,d.jsx)(W.j,{variant:"warning",...e,className:(0,_.AK)(e.className,"px-5 md:px-3 md:items-center"),customIconStyles:"hidden md:block",children:(0,d.jsxs)("div",{className:(0,_.AK)("flex flex-col md:flex-row","md:items-center","space-y-4 md:space-y-0 md:space-x-4","justify-between w-full"),children:[(0,d.jsxs)("span",{children:["This is a temporary project (",(0,d.jsx)(q.Qj,{variant:"underline",onClick:p,children:"what's this?"}),") and will be deleted ",m()(t.expiredAt).fromNow(),". Claim it to make it yours."]}),(0,d.jsx)(q.zx,{onClick:v,size:"sm",isLoading:h||u,name:"Claim Project Banner",className:"max-w-max",children:"Claim Project"})]})})},G=e=>{let{claimProject:t}=e,{modalActions:n}=(0,F.o)(),{id:l}=(0,H.Lf)();return(0,d.jsxs)(H.u_,{title:"About temporary projects",children:[(0,d.jsx)(H.r6,{className:"mb-4",children:"About temporary projects"}),(0,d.jsx)(H.iO,{className:"mb-4",children:"Any project created without logging in is a temporary public project."}),(0,d.jsxs)(H.iO,{className:"mb-4",children:["These projects can be modified by anyone with the URL and are automatically"," ",(0,d.jsxs)("span",{className:"text-red-500 font-bold",children:["destroyed in ",B.TEMP_PROJECT_MAX_DAYS," ",(0,J._6)("day",B.TEMP_PROJECT_MAX_DAYS)]})," ","if nobody claims it."]}),(0,d.jsx)(Y.i,{className:"my-8"}),(0,d.jsx)(H.r6,{className:"mb-6",children:"Thinking about keeping this project?"}),(0,d.jsx)(H.iO,{className:"mb-8",children:"Login to claim it as yours, this turns this project into a private project where only you can access it"}),(0,d.jsxs)(Z.U,{space:4,justify:"end",children:[(0,d.jsx)(q.zx,{color:"gray",onClick:()=>n.exitModal(l),children:"Dismiss"}),(0,d.jsx)(q.zx,{color:"pink",onClick:()=>{n.exitModal(l),t()},name:"Claim Project Modal",children:"Claim Project"})]})]})};var X=n(50409),ee=n(57507),et=n(48212),en=n(95457),el=n(97258),ea=n(14178),er=n(23453),es=n(25460),ei=n(11892);let eo=()=>{let[{project:e,environment:t}]=(0,T.PY)();return(0,d.jsx)(ei.Aj,{title:"Legacy Deploy",tabs:[],icon:U.Tf,children:null==e||null==t?(0,d.jsx)(er.bJ,{}):(0,d.jsx)(ec,{projectId:e.id})})},ec=e=>{let{projectId:t}=e;return(0,d.jsxs)("div",{className:"-mx-5 md:-mx-12 -mt-8 p-4 bg-yellow-100 border-b border-t border-yellow-500",children:[(0,d.jsx)(es.h4,{className:"mb-1",children:"Upgrade Service"}),(0,d.jsx)(es.Zb,{className:"mb-3",children:"This project was not upgraded to use services, and is no longer valid."})]})};var ed=n(79640),eu=n.n(ed);eu().enableAll(),eu().setLevel("warn");var em=eu(),ex=n(84762);let eh=e=>e,ev=e=>e,ep=e=>e,eg=e=>e,ej=e=>{let{MONGOUSER:t,MONGOPASSWORD:n,MONGOHOST:l,MONGOPORT:a}=e;return"mongodb://".concat(t,":").concat(n,"@").concat(l,":").concat(a)},ef=e=>'mongosh "'.concat(ej(e),'"');var ey=n(55443),eb=n(8560);let ew=e=>{let{projectId:t,environmentId:n,pluginId:l}=e,a=(0,ex.Sb)({projectId:t,environmentId:n,pluginId:l}),{graphqlClient:r}=(0,M.S)(),s=(0,eb.D)(a,async()=>{null!=t&&null!=n&&null!=l&&await r.pluginReset({id:l,input:{environmentId:n}})});return{resetPluginEnvs:s}},eN=(0,g.createContext)([{},{}]),eC=(e,t)=>{let{graphqlClient:n}=(0,M.S)();return(0,R.o)(["mongo","databaseNames",e.environmentId,e.pluginId],async()=>(await n.getMongoDatabaseNames(e)).mongoDatabaseNames,{enabled:t,refetchInterval:8e3})},eS=(e,t,n)=>{let{graphqlClient:l}=(0,M.S)();return(0,R.o)(["mongo",e,"collectionNames",t.environmentId,t.pluginId],async()=>(await l.getMongoCollectionNames({database:e,...t})).mongoCollectionNames,{enabled:n,refetchInterval:8e3})},ek=(e,t,n,l)=>{let{graphqlClient:a}=(0,M.S)();return(0,R.o)(["mongo",e,"collectionData",t,n.environmentId,n.pluginId],async()=>{if(null==t)throw Error("Cannot fetch collection");return(await a.getMongoCollection({database:e,name:t,...n})).mongoCollectionData},{enabled:l&&null!=t,refetchInterval:8e3})},eI=e=>{var t,n,l,a;let{project:r,environment:s,plugin:i,envs:o,children:c}=e,u=r.id,m=i.id,x=s.id,h=i.logsEnabled,[v,p]=(0,g.useState)(ey.DEFAULT_MONGO_DATABASE),[j,f]=(0,g.useState)(null),[y,b]=(0,g.useState)(null),{graphqlClient:w}=(0,M.S)(),{result:N}=eC({environmentId:x,pluginId:m},null!=o);(0,g.useEffect)(()=>{p(N.data?N.data[0]:ey.DEFAULT_MONGO_DATABASE),f(null),b(null)},[u,x,m,N.data]);let{result:C,cancelQuery:S,invalidateQuery:k,setQuery:I}=eS(v,{environmentId:x,pluginId:m},null!=o),{result:D,cancelQuery:A,invalidateQuery:E,setQuery:P}=ek(v,j,{environmentId:x,pluginId:m},null!=o),{resetPluginEnvs:T}=ew({projectId:u,environmentId:x,pluginId:m}),R=(0,g.useMemo)(()=>null!==(n=(null!==(t=C.data)&&void 0!==t?t:[]).findIndex(e=>e===j))&&void 0!==n?n:null,[j,C.data]),O=(0,g.useMemo)(()=>{var e;return null==y?null:null!==(a=(null!==(l=null===(e=D.data)||void 0===e?void 0:e.data)&&void 0!==l?l:[]).findIndex(e=>e._id===y._id))&&void 0!==a?a:null},[D.data,y]),L=(0,g.useMemo)(()=>({selectDatabase:e=>{p(e),f(null),b(null)},selectCollection:e=>{f(e),b(null)},selectDocument:b,selectCollectionByIndex:e=>{null==C.data||e<0||e>=C.data.length||(f(C.data[e]),b(null))},selectDocumentByIndex:e=>{var t;let n=null===(t=D.data)||void 0===t?void 0:t.data;null==n||e<0||e>=n.length||b(n[e])},addDocument:async(e,t,n)=>{S(),f(e),b({...t,_id:"<new-document>"});let l=await w.insertMongoDocument({environmentId:x,pluginId:m,database:null!=n?n:v,name:e,data:t});b({...t,_id:l.mongoInsertDocument}),k(),E()},updateDocument:async(e,t)=>{null!=j&&(A(),await w.updateMongoDocument({environmentId:x,pluginId:m,database:v,id:e,name:j,data:t}),E())},deleteDocument:async e=>{var t;let n=null===(t=D.data)||void 0===t?void 0:t.data;null!=j&&null!=n&&(A(),P({...D.data,data:n.filter(t=>t._id!==e)}),b(null),await w.deleteMongoDocument({environmentId:x,pluginId:m,database:v,id:e,name:j}),E())},deleteCollection:async e=>{null!=C.data&&(S(),A(),I(C.data.filter(t=>t!==e)),b(null),f(null),await w.deleteMongoCollection({environmentId:x,pluginId:m,database:v,name:e}),k(),E())},generateDummyData:async()=>{await w.generateMongoDummyData({environmentId:x,pluginId:m,database:v}),k()},resetData:async()=>{await T({}),I([]),f(null),b(null)}}),[N,C,D,v,j,y]);return(0,d.jsx)(eN.Provider,{value:[{projectId:u,environmentId:x,pluginId:m,logsEnabled:h,envs:o,databaseNames:N,collectionNames:C,collectionData:D,database:v,selectedCollection:j,selectedDocument:y,selectedCollectionIndex:R,selectedDocumentIndex:O},L],children:c})},eD=()=>(0,g.useContext)(eN);var eA=n(19333);let eE=()=>{let{routes:e}=(0,P.H)();return(0,d.jsxs)(Z.g,{space:3,children:[(0,d.jsx)(es.w4,{children:"Connect to a Railway Service"}),(0,d.jsxs)(es.Zb,{children:['Go to a service, create a variable, and click "Add Reference".'," ",(0,d.jsxs)(et.r,{variant:"coloured",...e.docs({page:"/develop/services#connecting-to-your-database"}),className:"text-sm whitespace-nowrap",children:["Docs ",(0,d.jsx)("span",{"aria-hidden":!0,children:"â†—"})]})]})]})};var eP=n(78750),eT=n(64023);let eR=e=>{var t,n,l;let{plugin:a,projectId:r,environmentId:s}=e,{projectVariablesByEnvironment:i}=(0,eT.aq)({projectId:r}),o=null!==(t=i[s])&&void 0!==t?t:[],c=(0,ex.Qy)({projectId:r,enabled:!0,environmentId:s,pluginId:a.id,serviceId:null}),u=(0,g.useMemo)(()=>null!==(n=null==o?void 0:o.filter(e=>e.pluginId===a.id).sort((e,t)=>e.name.localeCompare(t.name)))&&void 0!==n?n:[],[o]);return(0,d.jsxs)(Z.g,{space:3,children:[(0,d.jsx)(es.w4,{children:"Available Variables"}),(0,d.jsx)(es.Zb,{children:"This plugin exposes the following variables."}),(0,d.jsx)(Z.g,{space:1,children:u.map(e=>{var t;return(0,d.jsx)(eP.$,{name:e.name,value:null!==(l=null===(t=c.variables)||void 0===t?void 0:t[e.name])&&void 0!==l?l:"",className:"text-gray-600 rounded-md bg-gray-50 hover:!bg-gray-50 dark:bg-gray-100 dark:hover:!bg-gray-100"},e.name)})})]})};var eM=n(50952),eO=n(83577),eL=n(26390);let eU=e=>{let{text:t,secrets:n=[],label:l,openLink:a,...r}=e,[s,i]=(0,eL.k)(!0,1e4),o=(0,eO.obscureSecretsFromText)(t,n,8);return(0,d.jsxs)(Z.g,{space:1,children:[(0,d.jsxs)(Z.U,{align:"center",justify:"between",space:3,...r,children:[(0,d.jsx)(es.Zb,{children:l}),(0,d.jsxs)(Z.U,{space:2,children:[t!==o&&(0,d.jsx)(q.Qj,{variant:"small",onClick:()=>i(!s),children:s?"show":"hide"}),a&&(0,d.jsx)(et.r,{href:a,variant:"small",children:"open"})]})]}),(0,d.jsx)(eM.d,{textToCopy:t,children:s?(0,eO.obscureSecretsFromText)(t,n,8):t})]})},eF=e=>{let{commandName:t,plugin:n,secret:l,rawCommand:a}=e;return(0,d.jsxs)(Z.g,{space:3,children:[(0,d.jsx)(es.w4,{children:"Using the Command Line"}),(0,d.jsx)(eU,{label:(0,d.jsxs)(d.Fragment,{children:["Railway CLI ",(0,d.jsx)(es.ZM,{children:t})," command"]}),text:"railway connect ".concat(eV(n.friendlyName))}),(0,d.jsx)(eU,{secrets:[l],label:(0,d.jsxs)(d.Fragment,{children:["Raw ",(0,d.jsx)(es.ZM,{children:t})," command"]}),text:a})]})},eV=e=>e.includes(" ")?'"'.concat(e,'"'):e,eB=()=>{let[{project:e,permissions:t,plugin:n,environment:l}]=(0,T.PY)(),[{envs:a}]=eD();if(!t.Write)return(0,d.jsx)(eA.O,{});if(null==e||null==a||null==n||null==l)return(0,d.jsx)(er.bJ,{});let r=ef(a);return(0,d.jsxs)("section",{className:"pb-12",children:[(0,d.jsx)(eE,{}),(0,d.jsx)(Y.i,{className:"my-6"}),(0,d.jsx)(eF,{commandName:"mongo",rawCommand:r,secret:a.MONGOPASSWORD,plugin:n}),(0,d.jsx)(Y.i,{className:"my-6"}),(0,d.jsx)(eR,{projectId:e.id,environmentId:l.id,plugin:n})]})};var eK=n(42328);let ez=e=>{let t=e.length;return{height:40*t>500?500:40*t,width:"100%",itemCount:t,itemSize:()=>40}};var eQ=n(13235),e_=n(11083),eJ=n(16163),eW=n(67421),eq=n(72776),eY=n(92788),eZ=n(66186),eH=n(92228),e$=n(68580);function eG(){let e=(0,eH.Z)(["\n  flex flex-grow overflow-x-auto space-x-4 pb-2\n"]);return eG=function(){return e},e}function eX(){let e=(0,eH.Z)(["\n  flex flex-col min-w-80 py-2 border border-gray-200 rounded-sm\n"]);return eX=function(){return e},e}function e0(){let e=(0,eH.Z)(["\n  flex items-center justify-between opacity-60 px-2 h-8\n"]);return e0=function(){return e},e}function e1(){let e=(0,eH.Z)(["m-0 p-0 overflow-y-auto"]);return e1=function(){return e},e}let e2=(e,t)=>0===e.length?[]:e.slice(1).reduce((e,n)=>e.concat([t,n]),[e[0]]),e4=e=>{let{path:t,pathClickable:n,onClickPath:l,children:a}=e,r=(0,g.useRef)(null);return(0,g.useEffect)(()=>{var e,t;null===(e=r.current)||void 0===e||e.scrollTo({left:(null===(t=r.current)||void 0===t?void 0:t.clientWidth)*5,behavior:"smooth"})},[t]),(0,d.jsxs)("div",{className:"flex flex-col flex-grow",children:[(0,d.jsxs)(en.E,{largerOrEqualTo:"sm",children:[(0,d.jsx)(e5,{path:t,pathClickable:n,onClickPath:(e,t)=>{null!=l&&n&&l(e,t)}}),(0,d.jsx)(eY.L,{y:2})]}),(0,d.jsx)(e8,{ref:r,children:a})]})},e3=e=>{let{title:t,panelActions:n,children:l}=e;return(0,d.jsxs)(e7,{children:[(0,d.jsxs)(e9,{children:[(0,d.jsx)(es.xv,{className:"overflow-ellipsis overflow-hidden whitespace-nowrap",children:t}),null!=n&&n]}),(0,d.jsx)(eY.L,{y:2}),l]})},e5=e=>{let{path:t,pathClickable:n,onClickPath:l}=e;return(0,d.jsx)(Z.U,{space:3,children:e2(t.map((e,t)=>(0,d.jsx)(e6,{title:e,clickable:n,onClick:n=>{n.preventDefault(),l(e,t)},children:e},t)),(0,d.jsx)("div",{children:"/"}))})},e6=(0,_.Q$)("a")(()=>[],e=>({maxWidth:240,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",cursor:e.clickable?"pointer":"default","&:hover":{textDecoration:e.clickable?"underline":"none"}})),e8=_.dy.div(eG()),e7=_.dy.div(eX()),e9=_.dy.div(e0()),te=e=>{let{onClick:t,selected:n,style:l,children:a}=e;return(0,d.jsxs)(tn,{selected:n,onClick:t,selectable:null!=t,style:l,children:[(0,d.jsx)(es.xv,{className:"overflow-ellipsis overflow-hidden",children:a}),null!=t&&(0,d.jsx)(ee.JO,{icon:U._Q})]})},tt=(0,_.Lq)(e$.S_)(e1()),tn=(0,_.Q$)("li")(e=>["flex items-center justify-between p-2",e.selectable?"cursor-pointer hover:bg-gray-200":"cursor-default",e.selected&&e.selectable?"bg-gray-200":"bg-transparent"]),tl=(0,_.Q$)("div")(e=>["flex items-center justify-between text-foreground p-2 rounded-none w-auto cursor-pointer",e.selected?"bg-gray-200":"bg-transparent","hover:bg-gray-200 opacity-100"],{height:41});var ta=n(94106),tr=n(60017);let ts=e=>{let{addDocument:t}=e,{modalActions:n}=(0,F.o)(),[l,a]=(0,e_.f)(),{register:r,control:s,errors:i,handleSubmit:o}=(0,ta.cI)(),[c,u]=(0,g.useState)(!1),m=async e=>{try{a(null),u(!0),await t(e.collection,e.document,e.database),n.createToast((0,d.jsx)(tr.FN,{variant:"success",title:"Database successfully added!"})),n.exitModal()}catch(e){a(e.message)}u(!1)};return(0,d.jsx)(eJ.l0,{onSubmit:o(m),name:"Add Mongo Database",className:"space-y-4 md:min-w-96",children:(0,d.jsxs)(Z.g,{space:5,children:[(0,d.jsx)(H.r6,{children:"Add database"}),null!=l&&(0,d.jsx)(es.y,{children:l}),(0,d.jsx)(eW.II,{name:"database",label:"Database name",ref:r({required:!0,minLength:2,maxLength:128}),error:null!=i.database}),(0,d.jsx)(eW.II,{name:"collection",label:"Collection name",ref:r({required:!0,minLength:2,maxLength:128}),error:null!=i.collection}),(0,d.jsx)(ta.Qr,{name:"document",control:s,rules:{required:!0},defaultValue:{hello:"world"},render:e=>{let{onChange:t,value:n}=e;return(0,d.jsxs)(Z.g,{children:[(0,d.jsx)(eW.__,{children:"Document (json)"}),(0,d.jsx)(eZ.A,{value:n,onChange:e=>t(e),editorStyles:{margin:0}}),null!=i.document&&(0,d.jsx)(es.$2,{className:"text-red-400",children:"Required"})]})}}),(0,d.jsxs)(Z.U,{justify:"end",space:3,children:[(0,d.jsx)(q.zx,{type:"button",color:"gray",onClick:()=>n.exitModal(),children:"Cancel"}),(0,d.jsx)(q.KM,{type:"submit",isLoading:c,children:"Add database"})]})]})})};(l=s||(s={}))[l.Normal=0]="Normal",l[l.AddingCollection=1]="AddingCollection",l[l.AddingDocument=2]="AddingDocument";let ti=[{value:ey.DEFAULT_MONGO_DATABASE}],to=e=>{var t;null===(t=document.getElementById("json-editor-".concat(e)))||void 0===t||t.focus()},tc=e=>{let{state:t,setState:n}=e,[{selectedCollectionIndex:l,selectedDocumentIndex:a,selectedDocument:r},i]=eD();(0,g.useEffect)(()=>{let e=()=>{var e;return(null===(e=document.activeElement)||void 0===e?void 0:e.nodeName)==="TEXTAREA"},o=(0,eK.ZP)(window,{ArrowDown:n=>{t!==s.Normal||e()||(n.preventDefault(),null!=a?i.selectDocumentByIndex((null!=a?a:-1)+1):i.selectCollectionByIndex((null!=l?l:-1)+1))},ArrowUp:n=>{t!==s.Normal||e()||(n.preventDefault(),null!=a?i.selectDocumentByIndex((null!=a?a:-1)-1):i.selectCollectionByIndex((null!=l?l:-1)-1))},ArrowRight:n=>{t!==s.Normal||e()||(n.preventDefault(),null==a?i.selectDocumentByIndex(0):null!=r&&to(r._id))},ArrowLeft:n=>{t!==s.Normal||e()||(n.preventDefault(),i.selectDocument(null))},Escape:()=>{var e;n(s.Normal),null===(e=document.getElementById("json-editor-".concat(null==r?void 0:r._id)))||void 0===e||e.blur()},"$mod+Enter":()=>{var e;null===(e=document.getElementById("json-editor-".concat(null==r?void 0:r._id)))||void 0===e||e.blur()}});return()=>o()},[l,a,r,t,i])},td=()=>{var e,t,n;let[{permissions:l}]=(0,T.PY)(),[{database:a,selectedCollection:r,selectedDocument:i,databaseNames:o,collectionNames:c,collectionData:u},m]=eD(),[x,h]=(0,e_.f)(),[v,p]=(0,g.useState)(s.Normal),[j,y]=(0,g.useState)([]),{confirm:b}=(0,eQ.p)(),{modalActions:w}=(0,F.o)();tc({state:v,setState:p});let N=(0,g.useMemo)(()=>["\uD83C\uDFE0",a,r,null==i?void 0:i._id,...j,...v===s.AddingDocument?["new document"]:[]].filter(Boolean),[r,i,j,v,a]),C=()=>{p(s.AddingCollection),m.selectCollection(null)},S=()=>{p(s.AddingDocument),m.selectDocument(null)},k=e=>{p(s.Normal),m.selectDatabase(e)},I=e=>{p(s.Normal),y([]),m.selectCollection(e)},D=e=>{p(s.Normal),m.selectDocument(e)},A=()=>{p(s.Normal),y([])},E=async(e,t)=>{p(s.Normal),y([]);try{await m.addDocument(e,t)}catch(e){h(e.message)}},P=async e=>{let t=await b({title:"Delete document",description:"Are you sure you want to delete this document? Deleting this document is permanent and cannot be undone.",confirmButtonText:"Delete"});if(t)try{await m.deleteDocument(e)}catch(e){h(e.message)}},R=async e=>{let t=await b({title:"Delete collection",description:"Are you sure you want to delete the collection ".concat(e,"? All documents in it will be gone forever."),confirmButtonText:"Delete"});if(t)try{await m.deleteCollection(e)}catch(e){h(e.message)}},M=e=>{e<2&&m.selectDocument(null),e<1&&m.selectCollection(null),p(s.Normal),y([])};(0,f.qN)(()=>({value:"create-collection-document",text:null==i?"Create Collection":"Create Document",icon:U.v3,highlighted:!0,group:"Mongo",keybinding:"C",isAvailable:()=>v===s.Normal&&l.Write,action:()=>{null==i?C():S()}}),[v,i,l]),(0,f.qN)(()=>({value:"delete-collection-document",text:null==i?"Delete Collection":"Delete Document",icon:U.Vh,highlighted:!0,group:"Mongo",keybinding:"D",isAvailable:()=>v===s.Normal&&l.Write,action:()=>{null!=i?P(i._id):null!=r&&R(r)}}),[v,r,i,l]),(0,f.qN)(()=>({value:"edit-document",text:"Edit Document",icon:U.I8,highlighted:!0,group:"Mongo",keybinding:"E",isAvailable:()=>null!=i&&v===s.Normal,action:()=>to(null!==(t=null==i?void 0:i._id)&&void 0!==t?t:"")}),[v,i]);let O=()=>{w.openModal((0,d.jsx)(H.u_,{title:"Add database",children:(0,d.jsx)(ts,{addDocument:m.addDocument})}))};if(!l.Write)return(0,d.jsx)(eA.O,{});if(null==c.data)return(0,d.jsx)(er.bJ,{});let L=e=>{let{index:t,style:n}=e,l=c.data[t];return(0,d.jsx)(te,{style:n,onClick:()=>I(l),selected:l===r,children:l})},V=e=>{let{index:t,style:n}=e;if(null==u.data)return null;let l=u.data.data[t];return(0,d.jsx)(te,{style:n,selected:l._id===(null==i?void 0:i._id),onClick:()=>D(l),children:l._id})};return(0,d.jsxs)("div",{className:"flex flex-col flex-grow",children:[null!=x&&(0,d.jsx)(es.y,{children:x}),(0,d.jsxs)(Z.g,{space:1,className:"mb-5 max-w-xs",children:[(0,d.jsxs)(Z.U,{align:"center",justify:"between",children:[(0,d.jsx)(eW.__,{children:"Database"}),(0,d.jsx)(q.hU,{title:"Add Database",icon:U.FU,onClick:O})]}),(0,d.jsxs)(Z.U,{align:"center",space:3,className:"max-w-xs",children:[(0,d.jsx)("div",{className:"w-full",children:(0,d.jsx)(eq.P,{label:{text:"Database",hidden:!0},options:null!==(n=null===(e=o.data)||void 0===e?void 0:e.map(e=>({value:e})))&&void 0!==n?n:ti,value:a,onChange:e=>k(e),size:"sm"})}),o.isFetching&&(0,d.jsx)(er.gb,{})]})]}),(0,d.jsxs)(e4,{path:N,pathClickable:!0,onClickPath:(e,t)=>M(t),children:[(0,d.jsxs)(e3,{title:"collections",children:[(0,d.jsxs)(tl,{onClick:()=>C(),selected:v===s.AddingCollection,children:["Start collection",(0,d.jsx)(ee.JO,{icon:U.v3})]}),c.data.length>0&&(0,d.jsx)(tt,{...ez(c.data),children:L})]}),v===s.AddingCollection&&(0,d.jsx)(tm,{onAddDocument:E,onCancel:A,onPathUpdate:e=>y(e)}),null!=r&&v!==s.AddingCollection&&(0,d.jsx)(e3,{title:r,panelActions:(0,d.jsx)(q.hU,{icon:U.Vh,title:"Delete collection",onClick:()=>R(r)}),children:null==u.data?(0,d.jsx)(er.bJ,{}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(tl,{onClick:()=>S(),selected:v===s.AddingDocument,children:["Add document",(0,d.jsx)(ee.JO,{icon:U.v3})]}),(0,d.jsx)(tt,{...ez(u.data.data),children:V})]})}),v===s.AddingDocument&&null!=r&&(0,d.jsx)(tu,{collectionName:r,onAddDocument:E,onCancel:A}),null!=i&&v!==s.AddingDocument&&(0,d.jsx)(e3,{title:i._id,panelActions:(0,d.jsx)(q.hU,{icon:U.Vh,title:"Delete document",onClick:()=>P(i._id)}),children:(0,d.jsx)(tx,{document:i})},i._id)]})]})},tu=e=>{let{collectionName:t,onAddDocument:n,onCancel:l}=e;return(0,d.jsx)(e3,{title:"new document (json)",children:(0,d.jsx)(eZ.A,{value:{hello:"world"},onChange:e=>n(t,e),onCancel:l,alwaysShowButtons:!0,autoFocus:!0})})},tm=e=>{let{onAddDocument:t,onCancel:n,onPathUpdate:l}=e,[a,r]=(0,g.useState)(""),[s,i]=(0,g.useState)(!1),o=(0,g.useRef)(null);(0,g.useEffect)(()=>{s?l([a,"new document"]):l(["new collection"])},[s]),(0,g.useEffect)(()=>{setTimeout(()=>{var e;null===(e=o.current)||void 0===e||e.focus()},0)},[o.current]);let c=e=>{""!==a.trim()&&t(a,e)};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(e3,{title:"new collection",children:(0,d.jsx)(eJ.l0,{onSubmit:()=>i(!0),name:"New Mongo Collection",children:(0,d.jsxs)(Z.U,{space:3,align:"center",children:[(0,d.jsx)(eW.II,{ref:o,placeholder:"name",label:{text:"Name",hidden:!0},value:a,onChange:e=>r(e.target.value),disabled:s,autoFocus:!0,className:"rounded-none"}),(0,d.jsx)(q.hU,{icon:U._Q,title:"Create collection",disabled:""===a.trim()}),(0,d.jsx)(eY.L,{x:3})]})})}),s&&(0,d.jsx)(e3,{title:"new document (json)",children:(0,d.jsx)(eZ.A,{value:{hello:"world"},onChange:c,onCancel:n,alwaysShowButtons:!0,autoFocus:!0})})]})},tx=e=>{let{document:t}=e,[,{updateDocument:n}]=eD(),l=(0,g.useMemo)(()=>{let e={...t};return delete e._id,e},[t]);return(0,d.jsx)("div",{className:"whitespace-pre-wrap px-2",children:(0,d.jsx)(eZ.A,{value:l,editorId:t._id,onChange:e=>n(t._id,e)})})};var th=n(11670);let tv=()=>(0,d.jsxs)(th.jK,{children:[(0,d.jsx)(th.oC,{children:"Backup Database"}),(0,d.jsx)(W.j,{variant:"info",children:(0,d.jsx)(es.$2,{children:"While we do not offer first-party backups, we have a workaround in the form of deploying a service to automatically back up your database to an Amazon S3 bucket."})}),(0,d.jsx)(q.ZP,{color:"blue",variant:"outline",size:"sm",href:"https://blog.railway.app/p/automated-postgresql-backups",className:"max-w-max mt-4 font-medium",children:"Learn More"})]});var tp=n(37277);let tg=e=>{var t,n,l;let{value:a,onChange:r,onEdit:s,textarea:i,...o}=e,{register:c,watch:u,errors:m,setValue:x,handleSubmit:h}=(0,ta.cI)({mode:"all",defaultValues:{text:null==a?void 0:a.toString()}}),v=u().text,p=(0,g.useMemo)(()=>a!==v,[v,a]),j=e=>{let{text:t}=e;null!=r&&r(null!=t?t:"")},f=()=>{x("text",a)};return(0,g.useEffect)(()=>{x("text",null==a?void 0:a.toString(),{shouldDirty:!1,shouldValidate:!1})},[a]),(0,g.useEffect)(()=>{null!=s&&null!=v&&s(v)},[v]),(0,d.jsxs)(eJ.l0,{enableBindings:!0,onSubmit:h(j),onCancel:f,className:"flex items-start space-x-2",children:[i?(0,d.jsx)(tp.g,{error:null===(t=m.text)||void 0===t?void 0:t.message,ref:c({validate:o.validate}),...o,name:"text"}):(0,d.jsx)(eW.II,{error:null===(n=m.text)||void 0===n?void 0:n.message,ref:c({validate:o.validate}),...o,name:"text"}),p&&(null===(l=m.text)||void 0===l?void 0:l.message)==null&&(0,d.jsxs)(Z.U,{space:1,className:"mt-1",children:[(0,d.jsx)(q.hU,{icon:U.X,title:"Cancel",type:"button",onClick:f}),(0,d.jsx)(q.hU,{icon:U.Jr,title:"Save",type:"submit"})]})]})},tj=()=>{let[{project:e,plugin:t},{optimisticallyUpdateProject:n}]=(0,T.PY)(),l=(0,T.GX)(null==e?void 0:e.id),{graphqlClient:a}=(0,M.S)(),r=l=>{n({plugins:null==e?void 0:e.plugins.map(e=>e.id===(null==t?void 0:t.id)?{...e,..."function"==typeof l?l(e):l}:e)})},s=(0,eb.f)(l,async e=>{null!=t&&(r({friendlyName:e}),await a.pluginUpdate({id:t.id,input:{friendlyName:e}}))});return{updatePluginFriendlyName:s}},tf=e=>{let{plugin:t}=e,[{permissions:n}]=(0,T.PY)(),{updatePluginFriendlyName:l}=tj();return(0,d.jsxs)(th.jK,{children:[(0,d.jsx)(th.oC,{children:"Plugin Name"}),(0,d.jsx)(tg,{name:"plugin-name",validate:e=>{if(!(0,B.validatePluginName)(e))return"Must only contain letters, numbers, spaces, and dashes"},value:t.friendlyName,readOnly:!n.Write,label:{text:"Service Name",hidden:!0},onChange:e=>l(e)})]})};var ty=n(40940),tb=n(77685);let tw=e=>{let{projectId:t,environmentId:n,pluginId:l}=e,a=(0,ex.Sb)({projectId:t,environmentId:n,pluginId:l}),{onServiceChanged:r}=(0,tb.Q)(),{graphqlClient:s}=(0,M.S)(),i=(0,eb.D)(a,async()=>{if(null==t||null==n||null==l)throw Error("Cannot reset credentials for empty project");let e=(await s.pluginResetCredentials({id:l,input:{environmentId:n}})).pluginResetCredentials;return r({environmentId:n}),e});return{resetCredentials:i}},tN=e=>{let{projectId:t,environmentId:n,pluginId:l,pluginName:a}=e,[{permissions:r,environment:s}]=(0,T.PY)(),{graphqlClient:i}=(0,M.S)(),{confirm:o}=(0,eQ.p)(),{modalActions:c}=(0,F.o)(),[u,m]=(0,g.useState)(null),[x,h]=(0,e_.f)(),{routes:v,navActions:p}=(0,P.H)(),{invalidateDecryptedVariables:j}=(0,ex.Qy)({projectId:t,environmentId:n,pluginId:l,enabled:r.Write}),{resetCredentials:f}=tw({projectId:t,environmentId:n,pluginId:l}),{result:y}=(0,R.o)(["workflow",u],async()=>{if(null==u)throw Error("workflowId is null");return(await i.workflowStatus({workflowId:u,projectId:t})).workflowStatus},{enabled:null!=u,refetchInterval:!x&&2e3});(0,g.useEffect)(()=>{null!=y.data&&y.data.status!==ty.x8e.Running&&(m(null),c.exitModal(),y.data.status===ty.x8e.Error?h("There was a problem resetting plugin credentials"):y.data.status===ty.x8e.Complete&&(j(),p.push(v.projectPluginView({view:"connect"}))))},[y.data]);let b=async()=>{var e;let t=await o({title:"Reset Plugin Credentials",requireConfirmationText:a,description:(0,d.jsxs)(d.Fragment,{children:["Are you sure you want to reset credentials for this plugin in the"," ",(0,d.jsx)("strong",{children:null!==(e=null==s?void 0:s.name)&&void 0!==e?e:""})," environment? Current credentials will no longer work."]}),confirmButtonText:"Reset Credentials"});if(t)try{c.openModal((0,d.jsx)(H.RZ,{text:"Resetting plugin credentials",preventClose:!0,messages:["hold on to your hats","this should only take a few seconds"]}));let e=await f({});null!=e&&m(e)}catch(e){h(e.message),c.exitModal()}};return(0,d.jsxs)(th.jK,{children:[(0,d.jsx)(th.oC,{children:"Reset Database Credentials"}),(0,d.jsx)(W.j,{variant:"warning",children:(0,d.jsxs)(es.$2,{children:["Resetting the plugin credentials will change the password for the plugin."," ",(0,d.jsx)("b",{children:"Anything that uses the old credentials, including deployments, will need to be updated"}),"."]})}),null!=x&&(0,d.jsx)(es.y,{children:x}),(0,d.jsx)(q.zx,{color:"red",variant:"outline",size:"sm",disabled:!r.Admin,onClick:()=>b(),className:"max-w-max mt-4 font-medium",children:"Reset Plugin Credentials"})]})},tC=e=>{let{environmentId:t,pluginId:n,pluginName:l}=e,[{permissions:a,environment:r}]=(0,T.PY)(),{graphqlClient:s}=(0,M.S)(),{confirm:i}=(0,eQ.p)(),{modalActions:o}=(0,F.o)(),c=async()=>{var e,a;let c=await i({title:"Restart Database",requireConfirmationText:l,description:"Are you sure you want to restart the ".concat(l," database in the ").concat(null!==(e=null==r?void 0:r.name)&&void 0!==e?e:""," environment?"),confirmButtonText:"Restart Database"});if(c)try{await s.pluginRestart({id:n,input:{environmentId:t}}),o.createToast((0,d.jsx)(tr.FN,{variant:"success",title:"Database Restarted",description:"The ".concat(l," database has been restarted successfully!")}))}catch(e){o.createToast((0,d.jsx)(tr.FN,{variant:"error",title:"Error restarting database",description:null!==(a=e.message)&&void 0!==a?a:"We ran into issues restarting your database. Please reach out to support for assistance."}))}};return(0,d.jsxs)(th.jK,{children:[(0,d.jsx)(th.oC,{children:"Restart Database"}),(0,d.jsx)(W.j,{variant:"warning",children:(0,d.jsx)(es.$2,{children:"Restarting a database will result in a short amount of downtime. Only do this if you know what you are doing or are facing issues with your database."})}),(0,d.jsx)(q.zx,{color:"red",variant:"outline",size:"sm",disabled:!a.Admin,onClick:c,className:"max-w-max mt-4 font-medium",children:"Restart Database"})]})},tS=e=>{let{onWipe:t,pluginName:n}=e,{confirm:l}=(0,eQ.p)(),{modalActions:a}=(0,F.o)(),[r,s]=(0,e_.f)(),[{permissions:i,environment:o}]=(0,T.PY)(),c=async()=>{var e;let r=await l({title:"Wipe Plugin Data",requireConfirmationText:n,description:(0,d.jsxs)(d.Fragment,{children:["Are you sure you want to wipe data for this plugin in"," ",(0,d.jsx)("strong",{children:null!==(e=null==o?void 0:o.name)&&void 0!==e?e:""})," environment? The data will be lost forever."]}),confirmButtonText:"Wipe Data"});if(r){try{a.openModal((0,d.jsx)(H.RZ,{text:"Wiping data in plugin",preventClose:!0,messages:["hold on to your hats","this should only take a few seconds"]})),await t()}catch(e){s(e.message)}a.exitModal()}};return(0,d.jsxs)(th.jK,{className:"mb-0",children:[(0,d.jsx)(th.oC,{children:"Wipe Plugin Data"}),(0,d.jsx)(W.j,{variant:"danger",children:(0,d.jsxs)(es.$2,{children:["Wiping a plugin will fully tear down and setup a new container. As a result,"," ",(0,d.jsx)("b",{children:"all data will be deleted and environment variables will be changed"}),"."]})}),null!=r&&(0,d.jsx)(es.y,{children:r}),(0,d.jsx)(q.zx,{color:"red",variant:"outline",size:"sm",disabled:!i.Admin,onClick:()=>c(),className:"max-w-max mt-4 font-medium",children:"Wipe Plugin Data"})]})},tk=e=>{let{projectId:t,plugin:n,environment:l,resetData:a}=e,[{permissions:r},s]=(0,T.PY)(),{navActions:i,routes:o}=(0,P.H)(),{confirm:c}=(0,eQ.p)(),u=async()=>{await c({title:"Delete Service",description:"Are you sure you want to delete this service. All deployments will be removed forever.",requireConfirmationText:n.friendlyName,confirmButtonText:"Delete"})&&(i.push(o.project({})),await s.removePlugin(n.id))};return(0,d.jsxs)(Z.g,{className:"pb-12",children:[(0,d.jsxs)(th.QQ,{children:[(0,d.jsxs)(th.y2,{children:[(0,d.jsx)(es.k8,{as:"h2",children:"Environment"}),(0,d.jsxs)(es.nq,{children:["Settings scoped to ",(0,d.jsx)("b",{children:l.name})," environment."]})]}),(0,d.jsx)(th.rd,{children:(0,d.jsxs)("div",{className:th.DC,children:["postgresql"===n.name&&(0,d.jsx)(tv,{}),(0,d.jsx)(tC,{environmentId:l.id,pluginId:n.id,pluginName:n.friendlyName}),(0,d.jsx)(Y.i,{className:"mt-10 mb-8"}),(0,d.jsx)(tN,{projectId:t,environmentId:l.id,pluginId:n.id,pluginName:n.friendlyName}),(0,d.jsx)(Y.i,{className:"mt-10 mb-8"}),(0,d.jsx)(tS,{pluginName:n.friendlyName,onWipe:async()=>{await a(),i.push(o.projectPluginView({view:"data"}))}})]})})]}),(0,d.jsxs)(th.QQ,{children:[(0,d.jsxs)(th.y2,{children:[(0,d.jsx)(es.k8,{as:"h2",children:"Plugin"}),(0,d.jsxs)(es.nq,{children:["Settings scoped to ",(0,d.jsx)("b",{children:"ALL"})," environments."]})]}),(0,d.jsx)(th.rd,{children:(0,d.jsx)("div",{className:th.DC,children:(0,d.jsx)(tf,{plugin:n})})}),(0,d.jsx)(th.Jh,{title:"Danger",danger:!0,children:(0,d.jsxs)(th.jK,{children:[(0,d.jsx)(th.oC,{className:"text-red-500",children:"Delete Service"}),(0,d.jsx)(W.j,{variant:"danger",children:(0,d.jsxs)(es.$2,{children:["Deleting this database service will ",(0,d.jsx)("b",{children:"permanently delete"})," ","all the service data and remove it from ",(0,d.jsx)("b",{children:"all environments"}),". This cannot be undone."]})}),(0,d.jsx)(q.zx,{color:"red",size:"sm",onClick:u,disabled:!r.Admin,className:"max-w-max mt-4 font-bold",children:"Delete Service from All Environments"})]})})]})]})},tI=()=>{let[{projectId:e},{resetData:t}]=eD(),[{environment:n,plugin:l}]=(0,T.PY)();return null==n||null==l?(0,d.jsx)(er.bJ,{}):(0,d.jsx)(tk,{projectId:e,plugin:l,environment:n,resetData:t})};var tD=n(39933),tA=n(21780),tE=n(89499);let tP=(e,t)=>(0,tE.m)(ty._ru,e,{...t});var tT=n(18845),tR=n(14351),tM=n(65884),tO=n(27873);let tL=e=>{var t;let{pluginId:n,environmentId:l,logsEnabled:a}=e,[r,s]=(0,g.useState)(""),[{logs:i,noMoreLogs:o,isLoading:c},{loadMore:u}]=(0,tO.Tv)({environmentId:l,pluginId:n,filter:r,limit:tT.N,deps:[r,n,l]}),m=tP({pluginId:n,environmentId:l,filter:r,limit:tT.N},{compare:(e,t)=>t.timestamp>e.timestamp?1:-1,enabled:!0,deps:[r]}),x=(0,g.useRef)(null),h=(0,g.useRef)(null),v=(0,tR.n)();if((0,g.useEffect)(()=>{v?(x.current=document.querySelector(".metro-pane-content"),h.current=document.querySelector(".tabs-root")):(x.current=null,h.current=null)},[v]),(0,tM.b)({scrollContainer:x,childContainer:h}),!a)return(0,d.jsx)(W.j,{variant:"info",children:"Logs are not available for plugins created before April 6, 2022"});let p="plugin";return(0,d.jsxs)(tD.fC,{value:p,onValueChange:()=>null,className:(0,_.AK)("tabs-root","grid relative min-h-full bg-blue-100 -mx-5 md:-mx-12","grid-rows-[auto_minmax(0px,_1fr)] h-full"),children:[(0,d.jsx)(tA.Qs,{openLogs:p,activeFilter:r,setActiveFilter:s,tabs:[{label:"Plugin",value:p}]}),(0,d.jsx)(tA.Mb,{subscription:m,logs:i,pageSize:tT.N,loadMore:u,noMoreLogs:o,isLoadingMore:c,stickyScrollParent:null!==(t=x.current)&&void 0!==t?t:void 0,emptyMessage:""!==r?(0,d.jsxs)(d.Fragment,{children:["No logs found containing ",(0,d.jsx)("strong",{children:r})]}):"No plugin logs found"})]})},tU=()=>{let[{projectId:e,pluginId:t,environmentId:n,logsEnabled:l}]=eD();return(0,d.jsx)(tL,{projectId:e,pluginId:t,environmentId:n,logsEnabled:l})},tF=e=>{let{view:t}=e,[{collectionNames:n},l]=eD();return(0,f.qN)(()=>({text:"Generate dummy data",value:"generateMongoDummyData",category:"Mongo",icon:U.it,isAvailable:()=>null!=n.data&&0===n.data.length,action:async()=>{try{await l.generateDummyData()}catch(e){em.log("Error generating Mongo dummy data",e)}}}),[n.data]),"connect"===t?(0,d.jsx)(eB,{}):"settings"===t?(0,d.jsx)(tI,{}):"logs"===t?(0,d.jsx)(tU,{}):(0,d.jsx)(td,{})},tV=e=>{var t,n,l;let[{project:a,plugin:r,permissions:s,environment:i}]=(0,T.PY)(),{variables:o}=(0,ex.Qy)({projectId:null!==(t=null==a?void 0:a.id)&&void 0!==t?t:null,environmentId:null!==(n=null==i?void 0:i.id)&&void 0!==n?n:null,pluginId:null!==(l=null==r?void 0:r.id)&&void 0!==l?l:null,enabled:s.Write});return null==a||null==r||null==i?(0,d.jsx)(er.bJ,{}):(0,d.jsx)(eI,{project:a,environment:i,plugin:r,envs:null!=o?ev(o):null,children:(0,d.jsx)(tF,{...e})})},tB=[{value:"PRIMARY KEY",text:"Primary Key"},{value:"NOT NULL",text:"Not NULL"},{value:"UNIQUE",text:"Unique"}],tK=e=>{let{value:t,text:n,tags:l}=e;return{value:t,text:null!=n?n:t,tags:l}},tz=[{value:"text",tags:["string"]},{value:"integer",tags:["number"]},{value:"bigint",tags:["number"]},{value:"real",tags:["number","float"]},{value:"boolean"},{value:"character"},{value:"date"},{value:"json"},{value:"serial"},{value:"uuid"},{value:"money"}].map(tK),tQ=[{value:"text",tags:["string"]},{value:"integer",tags:["number"]},{value:"real",tags:["number","float"]},{value:"boolean"},{value:"character"},{value:"date"},{value:"json"},{value:"serial"}].map(tK),t_=["ADD","ADD CONSTRAINT","ALTER","ALTER COLUMN","ALTER TABLE","ALL","AND","ANY","AS","ASC","BACKUP DATABASE","BETWEEN","CASE","CHECK","COLUMN","CONSTRAINT","CREATE","CREATE DATABASE","CREATE INDEX","CREATE OR","CREATE TABLE","CREATE PROCEDURE","CREATE UNIQUE","CREATE VIEW","DATABASE","DEFAULT","DELETE","DESC","DISTINCT","DROP","DROP COLUMN","DROP CONSTRAINT","DROP DATABASE","DROP DEFAULT","DROP INDEX","DROP TABLE","DROP VIEW","EXEC","EXISTS","FOREIGN KEY","FROM","FULL OUTER ","GROUP BY","HAVING","IN","INDEX","INNER JOIN","INSERT INTO","INSERT INTO SELECT","IS NULL","IS NOT ","JOIN","LEFT JOIN","LIKE","LIMIT","NOT","NOT NULL","OR","ORDER BY","OUTER JOIN","PRIMARY KEY","PROCEDURE","RIGHT JOIN","ROWNUM","SELECT","SELECT DISTINCT","SELECT INTO","SELECT TOP","SET","TABLE","TOP","TRUNCATE TABLE","UNION","UNION ALL","UNIQUE","UPDATE","VALUES","VIEW","WHERE"],tJ=["DELETE","DROP"],tW=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,[n,l]=(0,g.useState)(0),a=e.length,r=Math.ceil(a/t),s=(0,g.useMemo)(()=>Math.min(n,r-1),[n,r]),i=(0,g.useMemo)(()=>e.slice(s*t,(s+1)*t),[s,e]);return{page:s,setPage:l,totalPages:r,visibleItems:i}};var tq=n(27425);let tY=(0,g.createContext)([{},{}]),tZ=(e,t)=>{let{graphqlClient:n}=(0,M.S)();return(0,R.o)(["sql","tableNames",e.environmentId,e.pluginId],async()=>(await n.getSQLTableNames(e)).sqlTableNames,{enabled:t,refetchInterval:8e3})},tH=(e,t,n)=>{let{name:l,limit:a,offset:r}=e,{graphqlClient:s}=(0,M.S)();return(0,R.o)(["sql","tableData",l,a,r,t.environmentId,t.pluginId],async()=>{if(null==l)throw Error("Cannot fetch table data");return(await s.getSQLTable({name:l,limit:a,offset:r,...t})).sqlTable},{enabled:null!=l&&n,keepPreviousData:!0,refetchInterval:8e3})},t$=e=>{var t,n;let{envs:l,project:a,environment:r,plugin:s,databaseType:i,formatValue:o,isJsonColumnType:c,children:u}=e,{graphqlClient:m}=(0,M.S)(),{query:x}=(0,P.H)(),[h,v]=(0,g.useState)(0),[p]=(0,g.useState)(10),j="string"==typeof x.table?x.table:null,f=a.id,y=r.id,b=s.id,w=s.logsEnabled;(0,g.useEffect)(()=>{v(0)},[j]);let N={environmentId:y,pluginId:b,databaseType:i},{result:C,cancelQuery:S,setQuery:k,invalidateQuery:I}=tZ(N,null!=l),{result:D,invalidateQuery:A}=tH({name:j,limit:p,offset:h*p},N,null!=l),{resetPluginEnvs:E}=ew({projectId:f,environmentId:y,pluginId:b}),T={...N,projectId:f,envs:l,viewState:"string"==typeof x.state?x.state:"",page:h,totalPages:Math.ceil((null!==(n=null===(t=D.data)||void 0===t?void 0:t.totalRows)&&void 0!==n?n:0)/p),pageSize:p,selectedTableName:j,tableNames:C,tableData:D,formatValue:o,isJsonColumnType:c,logsEnabled:w};return(0,d.jsx)(tY.Provider,{value:[T,{refresh:()=>A(),createTable:async e=>{S(),k([...C.data||[],e.name]),await m.createSQLTable({...e,...N}),I()},deleteTable:async e=>{var t;S(),k((null!==(t=C.data)&&void 0!==t?t:[]).filter(t=>t!==e.name)),await m.deleteSQLTable({...e,...N}),I()},insertColumn:async e=>{await m.insertSQLColumn({...e,...N}),A()},insertRow:async e=>{await m.insertSQLRow({...e,...N}),A()},deleteRows:async e=>{await m.deleteSQLRows({...e,...N}),A()},updateRow:async e=>{await m.updateSQLRow({...e,...N}),A()},generateDummyData:async()=>{await m.dummyDataSQL({...N}),I()},runRawQuery:async e=>{let t=await m.runRawQuery({...N,...e});return t.sqlRawQueryRun},changePage:e=>v(e),resetData:async()=>{await E({}),k([])}}],children:u})},tG=()=>(0,g.useContext)(tY);var tX=n(18345);let t0=p()(()=>Promise.all([n.e(1763),n.e(3511)]).then(n.bind(n,3511)),{loadableGenerated:{webpack:()=>[3511]},ssr:!1,loading:()=>(0,d.jsx)(tX.B,{width:"100%",height:"40px"})}),t1=e=>{for(let t of tJ)if(e.includes(t))return!0;return!1},t2=()=>{let[{permissions:e}]=(0,T.PY)(),[t,n]=(0,g.useState)(""),[{tableNames:l,databaseType:a,environmentId:r,pluginId:s},i]=tG(),[o,c]=(0,g.useState)(null),{result:u}=tH({name:o,limit:1,offset:0},{databaseType:a,environmentId:r,pluginId:s},e.Write),[m,x]=(0,e_.f)(),{modalActions:h}=(0,F.o)(),[v,p]=(0,g.useState)(null),{confirm:j}=(0,eQ.p)();(0,g.useEffect)(()=>{""===t.trim()&&c(null)},[t]);let f=(0,g.useMemo)(()=>{let e=[];return null!=l.data&&(e=l.data),null!=u.data&&null!=o&&(e=u.data.columnNames),e.map(e=>({id:e}))},[u.data,l.data,t]),[y,b]=(0,g.useState)(!1),{track:w}=(0,L.K)(),N=async()=>{try{if(p(null),""===t.trim())return;let e=t1(t);if(e){let e=await j({title:"Are you sure?",description:"Looks like you're doing a destructive action. Please confirm to proceed."});if(!e)return}b(!0);let n=await i.runRawQuery({query:t});w({action:"Submit",object:"Raw Query",properties:{query:t}}),p(n),h.createToast((0,d.jsx)(tr.FN,{variant:"success",title:"Query ran successfully"})),c(null)}catch(e){x(e.message)}b(!1)};return e.Write?(0,d.jsx)(eJ.l0,{onSubmit:N,enableBindings:!0,children:(0,d.jsxs)(Z.g,{space:3,children:[(0,d.jsx)(Z.g,{space:2,className:"flex-1",children:(0,d.jsx)(t0,{value:t,onChange:(e,t,l)=>{n(l)},placeholder:"SELECT * from TABLE_NAME",prompts:[{trigger:"/",data:t_.map(e=>({id:e})),appendSpaceOnAdd:!0},{trigger:".",data:f,onAdd:e=>{"string"==typeof e&&null!=l.data&&l.data.includes(e)&&c(e)}}]})}),(0,d.jsxs)("div",{className:"block md:flex md:space-x-2 md:justify-between",children:[(0,d.jsxs)(es.Ew,{className:"hidden md:block",children:[(0,d.jsx)("strong",{children:"ProTip"}),": Press ",(0,d.jsx)(es.sr,{children:"/"})," to view basic SQL commands or press ",(0,d.jsx)(es.sr,{children:"."})," to view table data."]}),(0,d.jsx)(q.zx,{isLoading:y,disabled:""===t.trim()||y,children:"Run query"})]}),null!=m&&(0,d.jsx)(es.y,{children:m}),null!=v&&(0,d.jsx)(Z.g,{className:"mt-5",children:"mysql"===a?(0,d.jsx)(t5,{response:v.raw}):"postgres"===a?(0,d.jsx)(t3,{response:v.raw}):(0,d.jsxs)(d.Fragment,{children:["Query response is not supported for ",a]})})]})}):(0,d.jsx)(eA.O,{})},t4=e=>{let{value:t,field:n,fields:l}=e,[{formatValue:a}]=tG(),r=l.find(e=>e.name===n);if(null==r)return null;let s="number"==typeof t?t:a(t,r.dataTypeID);return(0,d.jsx)(tq.f4,{children:(0,d.jsx)("span",{title:null!=s?s.toString():s,children:s})})},t3=e=>{var t;let{response:n}=e,{page:l,setPage:a,totalPages:r,visibleItems:s}=tW(null!==(t=n.rows)&&void 0!==t?t:[],10);return 0===s.length?(0,d.jsx)(d.Fragment,{children:"No data to display, table is empty."}):s.length>0?(0,d.jsxs)("div",{children:[(0,d.jsx)(tq.Lg,{children:(0,d.jsxs)(tq.iA,{children:[(0,d.jsx)(tq.Et,{children:(0,d.jsx)(tq.X2,{children:Object.keys(s[0]).map(e=>(0,d.jsx)(tq.qN,{children:e},e))})}),(0,d.jsx)(tq.XP,{children:s.map((e,t)=>(0,d.jsx)(tq.X2,{children:Object.keys(e).map(t=>(0,d.jsx)(t4,{field:t,value:e[t],fields:n.fields},t))},t))})]})}),(0,d.jsx)(tq.jn,{canPreviousPage:l>0,canNextPage:l+1<r,pageIndex:l,totalPages:r,gotoPage:a,previousPage:()=>a(l-1),nextPage:()=>a(l+1)})]}):(0,d.jsx)("pre",{children:JSON.stringify(n,null,2)})},t5=e=>{let{response:t}=e,n=Array.isArray(t[0]),{page:l,setPage:a,totalPages:r,visibleItems:s}=tW(n?t[0]:[],10);if(!n)return(0,d.jsx)("pre",{children:JSON.stringify(t[0],null,2)});let i=t[0];return 0===i.length?(0,d.jsx)(d.Fragment,{children:"No data to display, table is empty."}):(0,d.jsxs)("div",{className:"mt-5",children:[(0,d.jsx)(tq.Lg,{children:(0,d.jsxs)(tq.iA,{children:[(0,d.jsx)(tq.Et,{children:(0,d.jsx)(tq.X2,{children:Object.keys(s[0]).map(e=>(0,d.jsx)(tq.qN,{children:e},e))})}),(0,d.jsx)(tq.XP,{children:s.map((e,n)=>(0,d.jsx)(tq.X2,{children:Object.keys(e).map(n=>(0,d.jsx)(t4,{field:n,value:e[n],fields:t.fields},n))},n))})]})}),(0,d.jsx)(tq.jn,{canPreviousPage:l>0,canNextPage:l+1<r,pageIndex:l,totalPages:r,gotoPage:a,previousPage:()=>a(l-1),nextPage:()=>a(l+1)})]})},t6=e=>{let{PGUSER:t,PGPASSWORD:n,PGHOST:l,PGPORT:a,PGDATABASE:r}=e;return"PGPASSWORD=".concat(n," psql -h ").concat(l," -U ").concat(t," -p ").concat(a," -d ").concat(r)},t8={timestamp:1114,time:1083,date:1082,json:114,jsonb:3802},t7=e=>e===t8.json||e===t8.jsonb,t9=(e,t)=>null==e?"":t===t8.timestamp?m()(e).format("YYYY-MM-DD HH:mm:ss"):t===t8.time?m()(e).format("HH:mm:ss"):t===t8.date?m()(e).format("YYYY-MM-DD"):t7(t)?JSON.stringify(e):e.toString(),ne=e=>(0,d.jsx)(t$,{...e,databaseType:"postgres",formatValue:t9,isJsonColumnType:t7}),nt=()=>tG(),nn=()=>{let[{permissions:e,project:t,environment:n,plugin:l}]=(0,T.PY)(),[{envs:a}]=nt();if(!e.Write)return(0,d.jsx)(eA.O,{});if(null==a||null==t||null==n||null==l)return(0,d.jsx)(er.bJ,{});let r=t6(a);return(0,d.jsxs)("section",{className:"pb-12",children:[(0,d.jsx)(eE,{}),(0,d.jsx)(Y.i,{className:"my-6"}),(0,d.jsx)(eF,{commandName:"psql",rawCommand:r,secret:a.PGPASSWORD,plugin:l}),(0,d.jsx)(Y.i,{className:"my-6"}),(0,d.jsx)(eR,{projectId:t.id,environmentId:n.id,plugin:l})]})};var nl=n(60705),na=n(15039),nr=n(35519),ns=n(35057),ni=n(80506);function no(){let e=(0,eH.Z)(["flex flex-col"]);return no=function(){return e},e}function nc(){let e=(0,eH.Z)(["border-none"]);return nc=function(){return e},e}function nd(){let e=(0,eH.Z)(["relative"]);return nd=function(){return e},e}function nu(){let e=(0,eH.Z)(["bg-secondaryBg"]);return nu=function(){return e},e}function nm(){let e=(0,eH.Z)(["flex items-center flex-grow justify-between"]);return nm=function(){return e},e}function nx(){let e=(0,eH.Z)(["\n  px-2 py-1 text-sm cursor-pointer focus:outline-none\n"]);return nx=function(){return e},e}let nh=e=>{var t;let{mode:n,autoFocus:l,placeholder:a,defaultValues:r,searchItems:s,maxHeight:i,className:o,onChange:c,allowCustomValue:u,error:m,icon:x,iconRight:h,label:v}=e,p=(0,g.useRef)(null),j=(0,g.useRef)(null),f=(0,E.t)(),y=(0,g.useCallback)((e,t)=>{let l=()=>{e.results=(0,ni.U)(e.text,s,"multi"===n?e.selected:[])},a=t=>{"multi"===n?(e.text="",e.selected.push(t)):(e.text=t.text,e.selected=[t])};if("updateText"===t.type)e.text=t.text,e.isDeleting=!1,l(),1===e.results.length&&(e.selectedIndex=0);else if("changeSelectedIndex"===t.type)e.selectedIndex=Math.max(-1,Math.min(e.results.length-1,t.index));else if("select"===t.type){var r;let n=null!==(r=t.service)&&void 0!==r?r:e.results[e.selectedIndex];null==n&&u&&(n={text:e.text,value:e.text}),(null!=n||u)&&(e.selectedIndex=-1,a(n),l())}else"remove"===t.type?(e.selected=e.selected.filter(e=>e.value!==t.service.value),l()):"focus"===t.type?(e.focused=t.value,e.focused?(e.textBeforeFocus=e.text,e.text="",l()):""===e.text?e.text=e.textBeforeFocus:u&&a({text:e.text,value:e.text})):"removeSelected"===t.type?e.isDeleting?(e.selected.pop(),e.isDeleting=!1,l()):e.isDeleting=!0:em.warn("Action not handled",t)},[n,s,u]),b=(0,g.useMemo)(()=>{var e;return null==r||"multi"===n?"":null!==(t=null===(e=r[0])||void 0===e?void 0:e.text)&&void 0!==t?t:""},[]),[w,N]=(0,nl.C)(y,{focused:null!=l&&l,selectedIndex:-1,selected:null!=r?r:[],results:(0,ni.U)("",s),text:b,textBeforeFocus:b,isDeleting:!1});(0,g.useEffect)(()=>{f&&null!=c&&c(w.selected)},[w.selected]),(0,g.useEffect)(()=>{l&&setTimeout(()=>{var e;null===(e=p.current)||void 0===e||e.focus()},0)},[]);let C=e=>{e.keyCode===na.XP.enter?(N({type:"select"}),e.preventDefault()):e.keyCode===na.XP.down?N({type:"changeSelectedIndex",index:w.selectedIndex+1}):e.keyCode===na.XP.up?N({type:"changeSelectedIndex",index:w.selectedIndex-1}):e.keyCode===na.XP.backspace?N({type:"removeSelected"}):e.keyCode===na.XP.escape&&N({type:"focus",value:!1})},{focused:S,isDeleting:k,results:I,selected:D,selectedIndex:A,text:P}=w,T=(0,ns.i)(),R=(0,nr.n)(j),M=(0,g.useMemo)(()=>T.height-R.top-32,[R.top,T]),O=(0,g.useMemo)(()=>f?Math.min(Math.min(null!=i?i:1/0,M),R.height+2):"auto",[M,R.height,i,f]),L=w.results.length<=0||!S||"single"===n&&w.results[0].text===w.text||k,U="single"===n&&1===D.length&&null!=D[0].icon,F="string"==typeof v?v:v.text,V="string"!=typeof v&&v.hidden;return(0,d.jsxs)(Z.g,{children:[(0,d.jsx)(eW.__,{as:"div",className:V?"sr-only":"",children:F}),(0,d.jsxs)(nv,{className:"select ".concat(null!=o?o:""),children:[(0,d.jsxs)(nj,{error:m,focused:w.focused,children:[D.length>0&&"multi"===n&&(0,d.jsx)(nf,{children:D.map((e,t)=>(0,d.jsx)(np,{item:e,isDeleting:k&&t===D.length-1,onRemove:()=>N({type:"remove",service:e})},e.value))}),(0,d.jsxs)(Z.U,{align:"center",space:U?1:0,children:[U&&null!=D[0].icon&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(eY.L,{x:2}),(0,d.jsx)(ee.JO,{icon:D[0].icon})]}),(0,d.jsx)(ny,{autoFocus:l,placeholder:a,label:{text:F,hidden:!0},value:P,onChange:e=>N({type:"updateText",text:e.target.value}),onFocus:()=>N({type:"focus",value:!0}),onBlur:()=>N({type:"focus",value:!1}),onKeyDown:C,ref:p,icon:x,iconRight:h})]})]}),(0,d.jsx)(nb,{children:(0,d.jsx)(nw,{hidden:L,style:{height:O,opacity:O<=2?0:1},children:(0,d.jsx)(nN,{ref:j,children:I.map((e,t)=>{var n;return(0,d.jsx)(ng,{item:e,isSelected:(null===(n=D[0])||void 0===n?void 0:n.value)===e.value,isHovered:t===A&&!k,setSelected:()=>N({type:"changeSelectedIndex",index:t}),onClick:()=>N({type:"select",service:e})},e.value)})})})})]})]})},nv=_.dy.div(no()),np=e=>{let{item:t,isDeleting:n,onRemove:l}=e;return(0,d.jsxs)(nI,{isDeleting:n,children:[null!=t.icon&&(0,d.jsx)(ee.JO,{icon:t.icon}),(0,d.jsx)(eY.L,{x:3}),(0,d.jsx)(es.xv,{children:t.text}),(0,d.jsx)(nD,{onClick:()=>l(),children:"\xd7"})]})},ng=e=>{let{item:t,isSelected:n,isHovered:l,setSelected:a,onClick:r}=e;return(0,d.jsxs)(nC,{isHovered:l,onMouseDown:()=>r(),onMouseOver:()=>a(),className:"search-result",children:[(0,d.jsxs)(nS,{children:[(0,d.jsxs)(Z.U,{align:"center",children:[null!=t.icon&&(0,d.jsx)(ee.JO,{icon:t.icon}),(0,d.jsx)(eY.L,{x:3}),(0,d.jsx)(es.xv,{children:t.text})]}),n&&(0,d.jsx)(ee.JO,{icon:U.Jr})]}),null!=t.info?(0,d.jsx)(nk,{children:t.info}):(0,d.jsx)("div",{})]})},nj=(0,_.Q$)("div")(e=>["border rounded",e.error?"border-red-500 hover:border-red-500":e.focused?"border-blue-500 hover:border-blue-500":"border-gray-200 hover:border-gray-400"]),nf=(0,_.Q$)("div")(()=>["flex flex-wrap pt-1 px-1","[&>*]:mr-3 [&>*]:mb-3"]),ny=(0,_.Lq)(eW.II)(nc()),nb=_.dy.div(nd()),nw=(0,_.Q$)("div")(e=>["absolute left-0 top-0 right-0 overflow-x-hidden overflow-y-auto","mt-1 border border-gray-200 rounded-sm z-50 shadow rounded-md",e.hidden?"hidden":"block"]),nN=(0,_.Q$)("div")(nu()),nC=(0,_.Q$)("div")(e=>["flex items-center justify-between p-2 cursor-pointer",e.isHovered?"bg-gray-200":"bg-transparent"]),nS=_.dy.div(nm()),nk=(0,_.Q$)("div")(()=>["bg-gray-200 py-0 px-2 rounded text-base"],{boxShadow:"1px 1px 10px #0000001c"}),nI=(0,_.Q$)("div")(e=>["flex items-center p-1 border rounded border-pink-500",e.isDeleting?"bg-pink-500":"bg-transparent"]),nD=_.dy.button(nx());var nA=n(73452);function nE(){let e=(0,eH.Z)(["\n  grid gap-x-2 gap-y-1 mt-4\n  grid-cols-[repeat(4,_1fr)_44px]\n"]);return nE=function(){return e},e}let nP=()=>{let[{databaseType:e},{createTable:t}]=tG(),[{project:n,plugin:l}]=(0,T.PY)(),{routes:a,navActions:r}=(0,P.H)(),[s,i]=(0,g.useState)(!1),[o,c]=(0,g.useState)(null),{control:u,register:m,handleSubmit:x,errors:h}=(0,ta.cI)({defaultValues:{columns:[{name:"id",type:{text:"serial",value:"serial"},constraint:{text:"Primary Key",value:"PRIMARY KEY"}}]}}),{fields:v,append:p,remove:j}=(0,ta.Dq)({control:u,name:"columns"}),f=async e=>{if(null!=n&&null!=l){try{var s;c(null),i(!0),await t({name:e.tableName,columns:(null!==(s=e.columns)&&void 0!==s?s:[]).map(e=>{var t;return{...e,default:e.default||void 0,constraint:null===(t=e.constraint)||void 0===t?void 0:t.value,type:e.type.value}})}),r.push(a.projectPluginView({view:"data"}))}catch(e){c(e.message)}i(!1)}};return null==n||null==l?null:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(es.xv,{className:"mb-4 text-center",children:"Create Table"}),null!=o&&(0,d.jsx)(es.y,{children:o}),(0,d.jsx)(nA.Ik,{message:"You do not have permission to create a table",children:(0,d.jsxs)(eJ.l0,{enableBindings:!0,onCancel:()=>{var e;null===(e=document.activeElement)||void 0===e||e.blur()},onSubmit:x(f),name:"Create SQL Table",children:[(0,d.jsx)(eJ.gN,{label:"table name",name:"tableName",placeholder:"MyTable",ref:m({required:!0,minLength:3,maxLength:100}),error:null!=h.tableName,autoFocus:!0,className:"max-w-xs"}),(0,d.jsxs)(nT,{children:[(0,d.jsx)(es.Ew,{children:"column name"}),(0,d.jsx)(es.Ew,{children:"type"}),(0,d.jsx)(es.Ew,{children:"default"}),(0,d.jsx)(es.Ew,{children:"constraints"}),(0,d.jsx)(es.Ew,{style:{maxWidth:20}}),v.map((t,n)=>(0,d.jsxs)(g.Fragment,{children:[(0,d.jsx)(ta.Qr,{name:"columns[".concat(n,"].name"),control:u,rules:{required:!0},render:e=>{var t;let{onChange:l,value:a,name:r}=e;return(0,d.jsx)(eW.II,{value:a,onChange:l,name:r,placeholder:"my-column",label:{text:"Column Name",hidden:!0},error:null!=h.columns&&null!=h.columns[n]&&(null===(t=h.columns[n])||void 0===t?void 0:t.name)!=null})}}),(0,d.jsx)(ta.Qr,{name:"columns[".concat(n,"].type"),control:u,rules:{required:!0,validate:e=>{let{value:t}=e;return""!==t.trim()}},render:t=>{var l;let{onChange:a,value:r}=t;return(0,d.jsx)(nh,{searchItems:"mysql"===e?tQ:tz,label:{text:"Type",hidden:!0},defaultValues:[r],allowCustomValue:!0,onChange:e=>a(e[0]),error:null!=h.columns&&null!=h.columns[n]&&(null===(l=h.columns[n])||void 0===l?void 0:l.type)!=null})}}),(0,d.jsx)(ta.Qr,{name:"columns[".concat(n,"].default"),control:u,render:e=>{var t;let{onChange:l,value:a,name:r}=e;return(0,d.jsx)(eW.II,{value:a,onChange:l,name:r,label:{text:"Default",hidden:!0},placeholder:"no default",error:null!=h.columns&&null!=h.columns[n]&&(null===(t=h.columns[n])||void 0===t?void 0:t.default)!=null})}}),(0,d.jsx)(ta.Qr,{name:"columns[".concat(n,"].constraint"),control:u,render:e=>{var t;let{onChange:l,value:a}=e;return(0,d.jsx)(nh,{searchItems:tB,defaultValues:[a],onChange:e=>l(e[0]),label:{text:"Constraint",hidden:!0},error:null!=h.columns&&null!=h.columns[n]&&(null===(t=h.columns[n])||void 0===t?void 0:t.constraint)!=null})}}),(0,d.jsx)(q.hU,{icon:U.X,onClick:()=>j(n),title:"Delete Column",type:"button",hidden:v.length<=1,className:"delete-column"})]},t.id))]}),(0,d.jsx)("div",{className:"mt-4",children:(0,d.jsx)(q.zx,{size:"sm",color:"blue",onClick:()=>p({}),type:"button",className:"add-column",children:"Add column"})}),(0,d.jsxs)(Z.U,{justify:"end",className:"mt-8",children:[(0,d.jsx)(q.ZP,{variant:"primary",...a.projectPluginView({view:"data"}),scroll:!1,className:"cancel-create-table",children:"Cancel"}),(0,d.jsx)(eY.L,{x:3}),(0,d.jsx)(q.zx,{type:"submit",disabled:s,className:"create-table",children:s?(0,d.jsx)(er.gb,{}):"Create"})]})]})})]})},nT=_.dy.div(nE());var nR=n(47039),nM=n.n(nR);let nO=e=>{let[t,n]=(0,g.useState)(!1),l=(0,g.useMemo)(()=>"$mod"===e?na.V5?"Meta":"Control":e,[e]),a=(0,g.useCallback)(e=>{e.key===l&&n(!0)},[l]),r=(0,g.useCallback)(e=>{e.key===l&&n(!1)},[l]);return(0,g.useEffect)(()=>(document.addEventListener("keydown",a,!1),document.addEventListener("keyup",r,!1),()=>{document.removeEventListener("keydown",a,!1),document.removeEventListener("keyup",r,!1)}),[a,r]),(0,g.useEffect)(()=>{let e=()=>n(!1);return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[]),t},nL=()=>nO("$mod"),nU=()=>nO("Shift"),nF=e=>{let{tableGridRef:t,selected:n,sortedTableNames:l,setSelected:a,clickTable:r}=e,[s,i]=(0,g.useState)(null),o=(0,ns.i)(),c=(0,g.useMemo)(()=>o.width<1024?4:5,[o]),d=()=>{i(0)},u=()=>null!=t.current&&0===n.length;return(0,g.useEffect)(()=>{let e=(0,eK.ZP)(window,{ArrowDown:e=>{if(e.preventDefault(),!u())return;if(null==s){d();return}let t=s+c;t>=l.length&&(t=l.length-1),i(t)},ArrowUp:e=>{if(e.preventDefault(),!u())return;if(null===s){d();return}let t=s-c;t<0?i(null):i(t)},ArrowRight:e=>{if(e.preventDefault(),!u())return;if(null===s){d();return}let t=s+1;t<l.length&&i(t)},ArrowLeft:e=>{if(e.preventDefault(),!u())return;if(null===s){d();return}let t=s-1;t>=0&&i(t)},Escape:()=>{a([]),i(null)},Enter:()=>{if(n.length>0){r(n[0]);return}null!=s&&r(s)}});return()=>e()},[n,s,l]),{activeElement:s,setActiveElement:i}},nV=e=>{let[,t]=tG(),[n,l]=(0,g.useState)(!1);return(0,g.useEffect)(()=>{if(!n)return;let e=setTimeout(()=>l(!1),500);return()=>clearTimeout(e)},[n]),(0,d.jsx)(U.oQ,{...e,className:(0,_.AK)(e.className,"refresh ".concat(n?"animate-spin":"")),onClick:()=>{l(!0),t.refresh()}})},nB=()=>{var e;let[{tableNames:t,tableData:{data:n}},l]=tG(),[{project:a,plugin:r,permissions:s}]=(0,T.PY)(),[i,o]=(0,g.useState)([]),[c,u]=(0,e_.f)(),{routes:m,navActions:x}=(0,P.H)(),v=nU(),p=nL(),j=(0,g.useRef)(null),{confirm:y}=(0,eQ.p)(),b=(0,g.useRef)(null),[w,N]=(0,g.useState)(null),C=s.Write,S=(0,g.useMemo)(()=>nM()(null!==(e=t.data)&&void 0!==e?e:[],[e=>e.toLowerCase()]).filter(e=>null==w||""==w.trim()||e.toLowerCase().includes(w.toLowerCase())),[t.data,w]);(0,g.useEffect)(()=>{null!=w&&""!==w.trim()&&(0===S.length?o([]):1===S.length&&o([0]))},[w,S]),(0,f.qN)(()=>({value:"sql-table-create",text:"New Table",icon:U.v3,highlighted:!0,group:"SQL",keybinding:"C",isAvailable:()=>C,action:async()=>{x.push(m.projectPluginView({view:"data",query:{state:"create-table"}}))}}),[x,C]),(0,f.qN)(()=>({text:"Generate dummy data",value:"generateSQLDummyData",category:"SQL",group:"SQL",icon:U.it,highlighted:!0,isAvailable:()=>null==n&&null!=t.data&&0===t.data.length,action:async()=>{try{await l.generateDummyData()}catch(e){u(e.message),em.log("Error generating Postgres dummy data",e)}}}),[n,t.data]),(0,f.qN)(()=>({value:"sql-tables-filter",text:"Filter Tables",icon:U.wn,group:"SQL",keybinding:"/",highlighted:!0,isAvailable:()=>0===i.length,action:()=>{N(""),setTimeout(()=>{var e;return null===(e=b.current)||void 0===e?void 0:e.focus()},0)}}),[i]);let k=async()=>{if(0===S.length||0===i.length)return;let e=await y({title:"Delete Table",description:1===i.length?"Are you sure you want to delete the table ".concat(S[i[0]],"?"):"Are you sure you want to delete ".concat(i.length," ").concat((0,J._6)("table",i.length),"?"),confirmButtonText:"Delete"});if(e)try{await Promise.all(i.map(e=>l.deleteTable({name:S[e]}))),o([]),u(null)}catch(e){u(e.message)}};(0,f.qN)(()=>({value:"sql-delete-table",text:"Delete Table",icon:U.Vh,highlighted:!0,group:"SQL",keybinding:"D",isAvailable:()=>i.length>0,action:()=>k()}),[i]);let I=e=>{if(0===i.length)o([e]);else if(v){let t=[...i].sort((e,t)=>e-t)[0],n=[];for(let l=Math.min(e,t);l<=Math.max(e,t);l+=1)n.push(l);o(n)}else if(p){let t=i.includes(e);t?o(t=>t.filter(t=>t!==e)):o(t=>[...t,e])}},D=e=>{0!==S.length&&x.push(m.projectPluginView({view:"data",query:{state:"table",table:S[e]}}))},A=e=>{if(0!==S.length){if(!p&&!v||!C){D(e);return}I(e)}},{activeElement:E,setActiveElement:R}=nF({tableGridRef:j,selected:i,setSelected:o,sortedTableNames:S,clickTable:D});return null==a||null==r?null:null==t||t.isLoading||t.isIdle?(0,d.jsx)(er.bJ,{}):0===S.length&&null==w?(0,d.jsxs)("div",{className:"flex flex-col justify-center items-center pt-8",children:[(0,d.jsx)(es.w4,{children:"You have no tables"}),C&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(eY.L,{y:4}),(0,d.jsx)(q.ZP,{...m.projectPluginView({view:"data",query:{state:"create-table"}}),scroll:!1,className:"create-table-link no-tables",children:"Create table"}),(0,d.jsx)(eY.L,{y:4}),(0,d.jsx)(es.Ew,{children:"or"})]}),(0,d.jsx)(eY.L,{y:4}),(0,d.jsx)(et.r,{variant:"underline",...m.docs({page:"databases/database-view"}),className:"read-the-docs-link no-tables",children:"Read the docs"})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{onClick:()=>o([]),className:"flex flex-col flex-grow relative",children:[(0,d.jsxs)("div",{className:"relative flex items-center justify-center mb-8",children:[(0,d.jsxs)(es.xv,{children:["Tables"," ",i.length>0&&"(".concat(i.length," ").concat((0,J._6)("table",i.length)," selected)")]}),(0,d.jsxs)(Z.U,{space:2,align:"center",className:"absolute right-0 top-0",children:[(0,d.jsx)(q.hU,{title:"Delete table",icon:U.Vh,hidden:0===i.length,onClick:e=>{e.stopPropagation(),k()},className:"delete-table"}),(0,d.jsx)(q.hU,{title:"Refresh tables",icon:nV,className:"refresh-tables"})]})]}),null!=w&&(0,d.jsx)("div",{className:"hidden md:block absolute top-7 right-0",children:(0,d.jsx)(h.E.div,{initial:{y:-10,opacity:0},animate:{y:0,opacity:1},children:(0,d.jsx)(eW.II,{value:w,onChange:e=>N(e.target.value),label:{text:"Filter",hidden:!0},placeholder:"Filter",name:"filter",autoFocus:!0,ref:b,onKeyDown:e=>{"Escape"===e.key&&N(null)},className:"h-6 text-sm"})})}),t.isError||null!=c&&(0,d.jsx)(es.y,{children:null!=c?c:"Error loading tables"}),S.length>0?(0,d.jsx)(nQ,{isSelecting:p||v,ref:j,children:S.map((e,t)=>(0,d.jsx)(nK,{name:e,isSelected:i.includes(t),isFocused:E===t,index:t,onHover:()=>R(t),onClick:()=>A(t)},e))}):(0,d.jsx)(es.Zb,{className:"text-center my-8",children:"No tables here"})]}),C&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(eY.L,{y:5}),(0,d.jsx)("div",{className:"flex justify-end",children:(0,d.jsx)(q.ZP,{variant:"primary",...m.projectPluginView({view:"data",query:{state:"create-table"}}),className:"create-table",children:"Create table"})})]})]})},nK=e=>{let{name:t,isSelected:n,isFocused:l,onHover:a,onClick:r}=e;return(0,d.jsx)(h.E.div,{animate:l?"hover":"",variants:{hover:{scale:1.05}},children:(0,d.jsxs)(nz,{isSelected:n,isFocused:l,onMouseMove:a,onClick:e=>{e.preventDefault(),e.stopPropagation(),r()},children:[(0,d.jsx)(ee.JO,{icon:U.Ar,size:"2xl",className:"!text-blue-600"}),(0,d.jsx)(eY.L,{y:3}),(0,d.jsx)(es.xv,{title:t,className:"text-center overflow-hidden overflow-ellipsis max-w-full",children:t})]})})},nz=(0,_.Q$)("div")(e=>["flex flex-col items-center","p-2 rounded cursor-pointer stroke-current",e.isSelected&&"bg-gray-200",e.isFocused&&"bg-gray-200"]),nQ=(0,_.Q$)("div")(e=>["grid gap-x-2 gap-y-4","grid-cols-[repeat(auto-fill,_minmax(140px,_1fr))]",e.isSelecting&&"select-none"]),n_=e=>{let{pageSize:t,page:n,isInserting:l,selectedRows:a,setSelectedRows:r,table:s,gotoPrevPage:i,gotoNextPage:o,onClickRow:c}=e,[d,u]=(0,g.useState)(null),{routes:m,navActions:x}=(0,P.H)(),{sidePanels:h,modals:v}=(0,F.o)(),p=e=>e===t,j=e=>t*n+e>=s.totalRows,f=()=>0===a.length&&0!==s.totalRows;return(0,g.useEffect)(()=>{if(l||h.length>0||v.length>0)return;let e=(0,eK.ZP)(window,{ArrowDown:e=>{if(e.preventDefault(),!f())return;if(null==d){u(0);return}let t=d+1;j(t)||(p(t)&&(o(),t=0),u(t))},ArrowUp:e=>{if(e.preventDefault(),!f()||null==d)return;let l=d-1;l<0&&(0===n?l=null:(i(),l=t-1)),u(l)},Escape:()=>{d||a.length>0?(u(null),r([])):x.push(m.projectPluginView({view:"data"}))},Enter:()=>{null!=d&&c(d)}});return()=>e()},[s,a,d,n,t,l,h]),{activeElement:d,setActiveElement:u}};var nJ=n(11433),nW=n(99888),nq=n(16147);let nY=e=>{let{row:t,primaryKey:n}=e,l=t[n]?t[n].toString():null;if(null==l)throw Error("The table does not have a PRIMARY KEY. Please set one of the columns as a primary key in order to be able to edit/delete rows from this table.");return l},nZ=ta.Qr,nH=e=>{let{primaryKey:t,columnNames:n,columnTypes:l,row:a,isJsonColumnType:r,formatValue:s,onUpdateRow:i,onDeleteRow:o,onExit:c}=e,[u,m]=(0,g.useState)(!1),[x,h]=(0,g.useState)(!1),[v,p]=(0,e_.f)(),[j,f]=(0,eL.k)(!1,4e3),{confirm:y}=(0,eQ.p)(),{modalActions:b}=(0,F.o)(),[w,N]=(0,g.useState)(()=>Object.entries(a).reduce((e,t,n)=>{let[a,i]=t;return{...e,[a]:null==i?null:r(l[n])?JSON.stringify(i,null,2):s(i,l[n])}},{})),{register:C,control:S,watch:k,errors:I,getValues:D,handleSubmit:A}=(0,ta.cI)({defaultValues:w}),E=k(),P=(0,g.useMemo)(()=>Object.entries(w).some(e=>{let[t,n]=e;return n!==E[t]}),[w,E]),T=(0,g.useCallback)(async e=>{if(!P)return;let n=Object.entries(e).reduce((e,t)=>{let[n,l]=t;return{...e,[n]:""===l?null:l}},{});try{m(!0),nY({row:a,primaryKey:t}),await i(n),N(E),f(!0)}catch(e){p(e.message)}m(!1)},[P,E]);(0,g.useEffect)(()=>{let e=(0,eK.ZP)(window,{Enter:()=>{T(D())},"$mod+Enter":()=>{T(D())},"$mod+S":e=>{e.preventDefault(),T(D())},Escape:async()=>{c()}});return()=>e()},[T]);let R=async()=>{let e=await y({title:"Delete Row",description:"Are you sure you want to delete this row? Deleting this row is permanent and cannot be undone.",confirmButtonText:"Delete"});if(e){try{h(!0);let e=nY({row:a,primaryKey:t});await o(e),b.createToast((0,d.jsx)(tr.FN,{variant:"success",title:"Row successfully deleted"})),c()}catch(e){p(e.message)}h(!1)}};return(0,d.jsxs)("div",{className:"px-4",children:[(0,d.jsx)(eY.L,{y:4}),(0,d.jsxs)(Z.U,{align:"center",justify:"between",children:[(0,d.jsx)(es.Wr,{as:"h2",children:"Edit Row"}),x?(0,d.jsx)(er.gb,{}):(0,d.jsx)(q.hU,{icon:U.Vh,title:"Delete",disabled:u||x,onClick:R})]}),null!=v&&(0,d.jsx)(es.y,{children:v}),(0,d.jsx)(eY.L,{y:4}),(0,d.jsx)(eJ.l0,{onSubmit:A(T),name:"Edit SQL",children:(0,d.jsxs)(Z.g,{space:5,children:[n.map((e,t)=>(0,d.jsxs)(Z.g,{space:2,children:[(0,d.jsx)(es.Ew,{children:e}),r(l[t])?(0,d.jsx)(nZ,{name:e,control:S,rules:{validate:e=>(0,nW.V)(e)},render:e=>{let{onChange:t,value:n,name:l}=e;return(0,d.jsx)(nq.g,{language:"json",name:l,value:n,onChange:t,onKeyDown:e=>{e.metaKey&&"Enter"===e.key?e.preventDefault():"Enter"===e.key?e.stopPropagation():"Tab"===e.key&&e.preventDefault()},error:null!=I[l]})}}):(0,d.jsx)(eW.II,{autoComplete:"off",name:e,ref:C,placeholder:"DEFAULT",label:{text:"Value",hidden:!0},error:null!=I[e],onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},className:"max-w-none"})]},e)),(0,d.jsxs)(Z.U,{space:3,align:"center",children:[(0,d.jsx)("div",{children:(0,d.jsx)(q.zx,{variant:"primary",color:"gray",onClick:c,className:"cancel-edit-row",children:"Cancel"})}),P&&(0,d.jsx)(q.zx,{disabled:u,className:"save-edit-row",children:u?(0,d.jsx)(er.gb,{}):"Save"}),j&&(0,d.jsx)("div",{className:"pl-2",children:(0,d.jsx)(ee.JO,{icon:U.Jr,size:"lg",color:"success",initial:{y:-10,scale:0},animate:{y:0,scale:1}})})]})]})}),(0,d.jsx)(eY.L,{y:5})]})},n$=e=>{let{tableName:t,databaseType:n,insertColumn:l}=e,[a,r]=(0,e_.f)(),[s,i]=(0,g.useState)(!1),{modalActions:o}=(0,F.o)(),{control:c,register:u,handleSubmit:m,errors:x}=(0,ta.cI)(),h=async e=>{try{var n;r(null),i(!0),await l({tableName:t,column:{name:e.name,default:e.default,type:e.type.value,constraint:null===(n=e.constraint)||void 0===n?void 0:n.value}}),o.createToast((0,d.jsx)(tr.FN,{variant:"success",title:"Column ".concat(e.name," added to ").concat(t)})),o.exitModal()}catch(e){r(e.message)}i(!1)};return(0,d.jsxs)(Z.g,{space:6,children:[(0,d.jsx)(H.r6,{children:"Insert column"}),null!=a&&(0,d.jsx)(es.y,{children:a}),(0,d.jsx)(nA.Ik,{message:"You do not have permission to create a column",children:(0,d.jsxs)(eJ.l0,{onSubmit:m(h),enableBindings:!0,name:"Insert SQL Column",className:"space-y-5",children:[(0,d.jsx)(eJ.gN,{label:"Name",name:"name",placeholder:"name",ref:u({required:!0,minLength:2,maxLength:128}),error:null!=x.name,autoFocus:!0}),(0,d.jsx)(ta.Qr,{name:"type",control:c,rules:{required:!0,validate:e=>{let{value:t}=e;return""!==t.trim()}},render:e=>{let{onChange:t,value:l}=e;return(0,d.jsx)(nh,{searchItems:"mysql"===n?tQ:tz,label:"Type",onChange:e=>t(e[0]),error:null!=x.type,placeholder:"text",allowCustomValue:!0})}}),(0,d.jsx)(ta.Qr,{name:"default",control:c,render:e=>{let{onChange:t,value:n,name:l}=e;return(0,d.jsx)(eW.II,{value:n,onChange:t,name:l,label:"Default",placeholder:"No default",error:null!=x.default})}}),(0,d.jsx)(ta.Qr,{name:"constraint",control:c,render:e=>{let{onChange:t,value:n}=e;return(0,d.jsx)(nh,{searchItems:tB,defaultValues:[n],label:"Constraint",onChange:e=>t(e[0]),error:null!=x.constraint,placeholder:"No constraint"})}}),(0,d.jsxs)(Z.U,{justify:"end",space:4,children:[(0,d.jsx)(q.zx,{type:"button",onClick:()=>o.exitModal(),color:"gray",children:"Cancel"}),(0,d.jsx)(q.KM,{isLoading:s,children:"Add column"})]})]})})]})};function nG(){let e=(0,eH.Z)(["flex flex-col flex-grow"]);return nG=function(){return e},e}function nX(){let e=(0,eH.Z)(["relative flex items-center justify-center"]);return nX=function(){return e},e}function n0(){let e=(0,eH.Z)(["flex flex-col justify-between flex-grow mt-5"]);return n0=function(){return e},e}function n1(){let e=(0,eH.Z)(["flex justify-end pt-2"]);return n1=function(){return e},e}function n2(){let e=(0,eH.Z)(["flex flex-col items-center text-center"]);return n2=function(){return e},e}let n4=()=>{let[{tableData:e,selectedTableName:t}]=tG();if(e.isError||null==t){var n,l;return(0,d.jsx)(es.y,{children:null!==(l=null===(n=e.error)||void 0===n?void 0:n.message)&&void 0!==l?l:"Error loading table"})}return e.isLoading||e.isIdle?(0,d.jsx)(er.bJ,{}):null==e.data?(0,d.jsx)(n5,{tableName:t}):(0,d.jsx)(n3,{table:e.data,selectedTableName:t})},n3=e=>{let{table:t,selectedTableName:n}=e,[{permissions:l}]=(0,T.PY)(),{routes:a}=(0,P.H)(),[{page:r,totalPages:s,formatValue:i,isJsonColumnType:o,pageSize:c,databaseType:u},m]=tG(),[x,h]=(0,e_.f)(),[v,p]=(0,g.useState)(!1),[j,y]=(0,g.useState)(!1),[b,w]=(0,g.useState)({}),[N,C]=(0,g.useState)([]),S=nU(),k=nL(),{confirm:I}=(0,eQ.p)(),D=(0,g.useRef)(null),A=l.Write,{modalActions:E}=(0,F.o)(),R=()=>{m.changePage(r-1)},M=()=>{m.changePage(r+1)};(0,f.qN)(()=>({value:"sql-create-row",text:"New Row",icon:U.v3,highlighted:!0,keybinding:"C",group:"SQL",isAvailable:()=>!v&&A,action:async()=>O()}),[v,A]);let O=()=>{A&&(p(!0),setTimeout(()=>{var e;null===(e=D.current)||void 0===e||e.focus()},0))},L=()=>{p(!1),w({})},V=async()=>{if(null==t||j)return;let e=Object.entries(b).map(e=>{let[t,n]=e;return{name:t,value:n}}).filter(e=>{let{value:t}=e;return""!==t.trim()});try{y(!0),await m.insertRow({tableName:t.name,columns:e}),h(null),w({}),p(!1)}catch(e){h(e.message)}y(!1)},B=async()=>{let e=await I({title:"Delete Rows",description:"Are you sure you want to delete ".concat(N.length," ").concat((0,J._6)("row",N.length),"? Deleting these rows is permanent and cannot be undone."),confirmButtonText:"Delete"});if(null!=t&&e)try{let e=N.map(e=>t.rows[e][t.primaryKey].toString());await m.deleteRows({tableName:t.name,columnName:t.primaryKey,rows:e}),E.createToast((0,d.jsx)(tr.FN,{variant:"success",title:"".concat(e.length," ").concat((0,J._6)("row",e.length)," successfully deleted")})),h(null),C([])}catch(e){h(e.message)}},K=async()=>{null!=t&&E.openModal((0,d.jsx)(H.u_,{title:"Insert column",children:(0,d.jsx)(n$,{tableName:t.name,databaseType:u,insertColumn:m.insertColumn})}))};(0,f.qN)(()=>({value:"sql-delete-row",text:"Delete Row",icon:U.Vh,highlighted:!0,group:"SQL",keybinding:"D",isAvailable:()=>N.length>0,action:()=>B()}),[N]),(0,f.qN)(()=>({value:"sql-insert-column",text:"Insert column",category:"SQL",action:()=>K()}));let z=e=>{let n=N.includes(e);if(k)n?C(t=>t.filter(t=>t!==e)):C(t=>[...t,e]);else if(S){var l;let t=null!==(l=[...N].sort((e,t)=>e-t)[0])&&void 0!==l?l:e,n=[];for(let l=Math.min(e,t);l<=Math.max(e,t);l+=1)n.push(l);C(n)}else{let n=t.rows[e];E.openSidePanel((0,d.jsx)(nJ.h,{title:"Edit Row",isResizable:!0,preferredWidth:600,children:(0,d.jsx)(nH,{primaryKey:t.primaryKey,columnNames:t.columnNames,columnTypes:t.columnTypes,isJsonColumnType:o,formatValue:i,row:n,onUpdateRow:async e=>m.updateRow({pKey:t.primaryKey,pKeyValue:n[t.primaryKey].toString(),tableName:t.name,data:e}),onDeleteRow:async e=>m.deleteRows({tableName:t.name,columnName:t.primaryKey,rows:Array.of(e)}),onExit:()=>E.exitSidePanel()})}))}},{activeElement:Q,setActiveElement:_}=n_({page:r,pageSize:c,gotoNextPage:M,gotoPrevPage:R,selectedRows:N,setSelectedRows:C,isInserting:v,table:t,onClickRow:z});return(0,d.jsxs)(n6,{onClick:()=>{C([])},children:[(0,d.jsxs)(n8,{children:[(0,d.jsx)(n7,{position:"left",children:(0,d.jsx)(q.x6,{icon:U.Xd,scroll:!1,...a.projectPluginView({view:"data"}),className:"table-back"})}),(0,d.jsxs)(es.xv,{children:[n," ",N.length>0&&"(selected ".concat(N.length," ").concat((0,J._6)("row",N.length),")")]}),(0,d.jsxs)(n7,{position:"right",children:[(0,d.jsx)(q.hU,{icon:U.Vh,hidden:0===N.length,onClick:B,title:"Delete",color:"pink",className:"delete-row"}),0===N.length&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(q.hU,{icon:nV,title:"Refresh table",color:"pink"}),(0,d.jsx)(q.zx,{onClick:K,title:"Insert column",variant:"ghost",size:"sm",className:"text-pink-500",children:(0,d.jsxs)(Z.U,{align:"center",children:[(0,d.jsx)(ee.JO,{icon:U.Lx,className:"mr-1"}),"Add Column"]})})]})]})]}),(0,d.jsx)(eY.L,{y:2}),(0,d.jsxs)(n9,{children:[null!=x&&(0,d.jsx)(es.y,{className:"mt-2",children:x}),(0,d.jsxs)(tq.Lg,{children:[(0,d.jsxs)(tq.iA,{isSelecting:k||S,children:[(0,d.jsx)(tq.Et,{children:(0,d.jsx)(tq.X2,{children:t.columnNames.map(e=>(0,d.jsx)(tq.qN,{children:e},e))})}),(0,d.jsxs)(tq.XP,{children:[t.rows.map((e,n)=>(0,d.jsx)(tq.X2,{className:N.includes(n)?"selected":"",isActive:n===Q,onMouseMove:()=>_(n),children:t.columnNames.map((l,a)=>{let r=e[l],s="number"==typeof r?r:i(r,t.columnTypes[a]);return(0,d.jsx)(tq.f4,{onClick:e=>{e.preventDefault(),e.stopPropagation(),z(n)},children:(0,d.jsx)("span",{title:null!=s?s.toString():s,children:s})},l)})},n)),v&&null!=t&&(0,d.jsx)(tq.X2,{isInserting:!0,className:"inserting",children:t.columnNames.map((e,t)=>(0,d.jsx)(tq.f4,{children:(0,d.jsx)(eW.II,{ref:0===t?D:null,autoFocus:0===t,placeholder:"DEFAULT",label:{text:"Value",hidden:!0},onKeyDown:e=>{e.keyCode===na.XP.enter?V():e.keyCode===na.XP.escape&&p(!1)},onChange:t=>{let n=t.target.value;w(t=>({...t,[e]:n}))}})},e))})]})]}),null!=t&&0===t.rows.length&&!v&&(0,d.jsx)(lt,{children:(0,d.jsx)(es.w4,{className:"py-8",children:"This table is empty"})})]}),(0,d.jsx)(le,{space:3,children:v?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(q.zx,{variant:"primary",color:"gray",onClick:L,disabled:j,className:"cancel-insert-row",children:"Cancel"}),(0,d.jsx)(q.zx,{onClick:V,disabled:j,className:"insert-row",children:j?(0,d.jsx)(er.gb,{}):"Insert"})]}):(0,d.jsx)(d.Fragment,{children:A&&(0,d.jsx)(q.zx,{variant:"outline",size:"sm",onClick:()=>{O()},className:"add-row",children:"Add Row"})})}),t.rows.length>0&&(0,d.jsx)(tq.jn,{canPreviousPage:r>0,canNextPage:r+1<s,pageIndex:r,totalPages:s,gotoPage:m.changePage,previousPage:R,nextPage:M})]})]})},n5=e=>{let{tableName:t}=e,{routes:n}=(0,P.H)();return(0,d.jsxs)(lt,{children:[(0,d.jsx)(eY.L,{y:5}),(0,d.jsxs)(es.w4,{children:["Table ",(0,d.jsx)(es.xv,{color:"primary",children:t})," not found"]}),(0,d.jsx)(eY.L,{y:4}),(0,d.jsx)(q.ZP,{...n.projectPluginView({}),scroll:!1,children:"Go back"})]})},n6=_.dy.div(nG()),n8=_.dy.div(nX()),n7=(0,_.Lq)(Z.U)(e=>["absolute top-0 flex items-center","left"===e.position?"left-0":"right-0"]),n9=_.dy.div(n0()),le=(0,_.Lq)(Z.U)(n1()),lt=_.dy.div(n2()),ln=()=>{let[{permissions:e}]=(0,T.PY)(),[{viewState:t}]=nt();if(!e.Write)return(0,d.jsx)(eA.O,{});let n=(0,d.jsx)(nB,{});return"create-table"===t?n=(0,d.jsx)(nP,{}):"table"===t&&(n=(0,d.jsx)(n4,{})),(0,d.jsx)(Z.g,{className:"flex-grow",children:n})},ll=()=>{let[{projectId:e},{resetData:t}]=nt(),[{environment:n,plugin:l}]=(0,T.PY)();return null==n||null==l?(0,d.jsx)(er.bJ,{}):(0,d.jsx)(tk,{projectId:e,plugin:l,environment:n,resetData:t})},la=()=>{let[{projectId:e,pluginId:t,environmentId:n,logsEnabled:l}]=nt();return(0,d.jsx)(tL,{projectId:e,pluginId:t,environmentId:n,logsEnabled:l})},lr=e=>{let{view:t}=e;return(0,d.jsx)(d.Fragment,{children:"connect"===t?(0,d.jsx)(nn,{}):"data"===t?(0,d.jsx)(ln,{}):"settings"===t?(0,d.jsx)(ll,{}):"query"===t?(0,d.jsx)(t2,{}):"logs"===t?(0,d.jsx)(la,{}):null})},ls=e=>{var t,n,l;let[{project:a,plugin:r,permissions:s,environment:i}]=(0,T.PY)(),{variables:o}=(0,ex.Qy)({projectId:null!==(t=null==a?void 0:a.id)&&void 0!==t?t:null,environmentId:null!==(n=null==i?void 0:i.id)&&void 0!==n?n:null,pluginId:null!==(l=null==r?void 0:r.id)&&void 0!==l?l:null,enabled:s.Write});return null==a||null==r||null==i?(0,d.jsx)(er.bJ,{}):(0,d.jsx)(ne,{project:a,environment:i,plugin:r,envs:null!=o?eh(o):null,children:(0,d.jsx)(lr,{...e})})},li=e=>"redis-cli -u ".concat(e.REDIS_URL);var lo=n(82066);let lc=(0,g.createContext)([{},{}]),ld=(e,t,n)=>{let{graphqlClient:l}=(0,M.S)(),{result:a,queryKey:r,setQuery:s,invalidateQuery:i}=(0,R.o)(["redis","keys",e,t],async()=>(await l.getRedisKeys({pluginId:t,environmentId:e})).redisKeys,{enabled:n,refetchInterval:8e3});return(0,g.useEffect)(()=>{if(null==a.data)return;let e=setInterval(()=>{var e;s((null!==(e=a.data)&&void 0!==e?e:[]).map(e=>({...e,ttl:null==e.ttl||e.ttl<=0?e.ttl:e.ttl-1})))},1e3);return()=>clearInterval(e)},[a.data]),(0,g.useEffect)(()=>{if(null==a.data)return;let e=a.data.filter(e=>0===e.ttl);e.length>0&&i()},[a.data]),{keys:a,keysQuery:r,setKeys:s,invalidateKeys:i}},lu=e=>{var t,n,l;let{envs:a,project:r,plugin:s,environment:i,children:o}=e,{graphqlClient:c}=(0,M.S)(),u=(0,lo.useQueryClient)(),m=r.id,x=s.id,h=s.logsEnabled,v=i.id,[p,j]=(0,g.useState)({}),[f,y]=(0,g.useState)(null),[b,w]=(0,e_.f)(),[N,C]=(0,g.useState)(!1),{keys:S,keysQuery:k,setKeys:I,invalidateKeys:D}=ld(v,x,null!=a),A=(0,g.useMemo)(()=>{var e;if(N)return null;let t=null===(e=S.data)||void 0===e?void 0:e.find(e=>e.name===f);return null!=f&&null!=t?t:null},[N,f,S]),E=e=>["redis","data",e,m,v,x],{result:P}=(0,R.o)(E(null!==(n=null==A?void 0:A.name)&&void 0!==n?n:null),async()=>{if(null==A)throw Error("No selected key");return(await c.getRedisData({key:A.name,pluginId:x,environmentId:v})).redisGetKey},{enabled:null!=A,refetchInterval:8e3}),{resetPluginEnvs:T}=ew({projectId:m,environmentId:v,pluginId:x}),O={projectId:m,environmentId:v,pluginId:x,logsEnabled:h,envs:a,keys:S,selectedKey:A,keyData:P,error:b,isAdding:(null!==(l=null===(t=S.data)||void 0===t?void 0:t.length)&&void 0!==l?l:0)===0||N,keyState:p},L=(0,g.useMemo)(()=>({projectId:m,environmentId:v,pluginId:x}),[m,v,x]),U=async(e,t)=>{let n=u.getQueryData(e);u.cancelQueries(e);try{await t()}catch(t){u.setQueryData(e,n),w(t.message)}finally{u.invalidateQueries(e)}},F=(0,g.useMemo)(()=>({setSelectedKey:e=>{var t;y(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:null),C(!1),j({})},setIsAddingKey:e=>{y(null),C(e)},setKeyExpire:async(e,t)=>U(k,async()=>{var n;I((null!==(n=S.data)&&void 0!==n?n:[]).map(n=>n.name===e?{...n,ttl:t}:n)),await c.setRedisExpire({...L,key:e,ttl:t})}),deleteKey:async e=>U(k,async()=>{var t;I((null!==(t=S.data)&&void 0!==t?t:[]).filter(t=>t.name!==e)),y(null),await c.deleteRedisKey({...L,key:e})}),setString:async(e,t)=>{u.setQueryData(E(e),t),await c.setRedisString({...L,key:e,value:t})},setListIndex:async(e,t,n)=>U(E(e),async()=>{var l;let a=null!==(l=u.getQueryData(E(e)))&&void 0!==l?l:[];u.setQueryData(E(e),a.map((e,l)=>l===t?n:e)),await c.setRedisListIndex({...L,key:e,index:t,value:n})}),pushList:async(e,t,n)=>U(E(e),async()=>{var l;let a=null!==(l=u.getQueryData(E(e)))&&void 0!==l?l:[];"left"===t?u.setQueryData(E(e),[...n,...a]):u.setQueryData(E(e),[...a,...n]),await c.pushRedisList({...L,key:e,side:t,values:n})}),popList:async(e,t)=>U(E(e),async()=>{var n;let l=null!==(n=u.getQueryData(E(e)))&&void 0!==n?n:[];"left"===t?u.setQueryData(E(e),l.slice(1)):u.setQueryData(E(e),l.slice(0,l.length-1)),await c.popRedisList({...L,key:e,side:t})}),setAdd:async(e,t)=>U(E(e),async()=>{var n;let l=null!==(n=u.getQueryData(E(e)))&&void 0!==n?n:[];u.setQueryData(E(e),Array.from(new Set([...l,...t]))),await c.addRedisSet({...L,key:e,values:t})}),setRemove:async(e,t)=>U(E(e),async()=>{var n;let l=null!==(n=u.getQueryData(E(e)))&&void 0!==n?n:[];u.setQueryData(E(e),l.filter(e=>!t.includes(e))),await c.removeRedisSet({...L,key:e,values:t})}),hashSet:async(e,t)=>U(E(e),async()=>{let n=u.getQueryData(E(e));u.setQueryData(E(e),{...n,...t}),await c.setRedisHash({...L,key:e,values:t})}),hashDelete:async(e,t)=>U(E(e),async()=>{var n;let l=null!==(n=u.getQueryData(E(e)))&&void 0!==n?n:{};u.setQueryData(E(e),Object.keys(l).reduce((e,n)=>t.includes(n)?e:{...e,[n]:l[n]},{})),await c.deleteRedisHash({...L,key:e,values:t})}),addKey:(e,t)=>{var n;I([...null!==(n=S.data)&&void 0!==n?n:[],{name:e,type:t,ttl:-1}])},generateDummyData:async()=>{await c.generateRedisDummyData(L),D()},setKeyState:j,resetData:async()=>{await T({}),I([]),y(null)}}),[L,S]);return(0,d.jsx)(lc.Provider,{value:[O,F],children:o})},lm=()=>(0,g.useContext)(lc),lx=()=>{let[{project:e,environment:t,plugin:n,permissions:l}]=(0,T.PY)(),[{envs:a}]=lm();if(!l.Write)return(0,d.jsx)(eA.O,{});if(null==e||null==a||null==t||null==n)return(0,d.jsx)(er.bJ,{});let r=li(a);return(0,d.jsxs)("section",{className:"pb-12",children:[(0,d.jsx)(eE,{}),(0,d.jsx)(Y.i,{className:"my-6"}),(0,d.jsx)(eF,{commandName:"redis-cli",rawCommand:r,secret:a.REDISPASSWORD,plugin:n}),(0,d.jsx)(Y.i,{className:"my-6"}),(0,d.jsx)(eR,{projectId:e.id,environmentId:t.id,plugin:n})]})};var lh=n(23627);let lv=e=>{var t,n;let{redisKey:l}=e,[a,r]=(0,g.useState)(!1),[s,i]=(0,g.useState)(null!==(n=null===(t=l.ttl)||void 0===t?void 0:t.toString())&&void 0!==n?n:"-1"),[,{setKeyExpire:o}]=lm(),c=(0,g.useMemo)(()=>/^-?\d+$/.test(s),[s]),u=(0,g.useCallback)(()=>{c&&(o(l.name,parseInt(s,10)),r(!1))},[s,c,l.name]),m=()=>{var e,t;i(null!==(t=null===(e=l.ttl)||void 0===e?void 0:e.toString())&&void 0!==t?t:"-1"),r(!0)};return(0,f.qN)(()=>({value:"redis-expire-key",text:"Set Item TTL",icon:U.SU,group:"Redis",highlighted:!0,keybinding:"E",isAvailable:()=>!a,action:()=>m()}),[a,l.ttl]),(0,d.jsx)("div",{className:"h-8",children:a?(0,d.jsx)(lh.MT,{autoFocus:!0,contain:!0,children:(0,d.jsx)(eJ.l0,{enableBindings:!0,onSubmit:u,onCancel:()=>r(!1),name:"Expire Redis Key",children:(0,d.jsxs)(Z.U,{align:"center",space:1,children:[(0,d.jsx)(eW.II,{placeholder:"seconds",label:{text:"Expire Seconds",hidden:!0},value:s,onChange:e=>i(e.target.value),error:!c,style:{maxWidth:100},className:"px-1 h-8"}),(0,d.jsx)(q.hU,{icon:U.X,onClick:()=>r(!1),title:"Cancel",type:"button"}),(0,d.jsx)(q.hU,{icon:U.Jr,onClick:()=>u(),title:"Submit",type:"submit"})]})})}):(0,d.jsx)(q.Qj,{variant:"small",onClick:()=>m(),children:(0,d.jsx)(es.Ew,{children:null!=l.ttl&&l.ttl>=0?(0,d.jsxs)(d.Fragment,{children:[l.ttl,"s"]}):"no expiry"})})})};var lp=n(17250);let lg=e=>{let{redisKey:t}=e,[,{deleteKey:n}]=lm(),{confirm:l}=(0,eQ.p)(),[a,r]=(0,lp.F)(),s=async()=>{let e=await l({title:"Delete key",description:"Are you sure you want to delete this key?",confirmButtonText:"Delete"});e&&n(t.name)};return(0,d.jsxs)("div",{className:"flex justify-between p-2 mt-auto",children:[(0,d.jsx)(q.Qj,{variant:"small",onClick:()=>r(t.name),className:"text-gray-600",children:a?"copied":"copy key"}),(0,d.jsx)(q.Qj,{variant:"small",onClick:()=>s(),className:"text-gray-600",children:"delete key"})]})},lj=e=>{let{value:t,onSave:n}=e,[l,a]=(0,g.useState)(t),r=(0,g.useMemo)(()=>t!==l,[t,l]),s=()=>n(l),i=()=>{a(t)};return(0,g.useEffect)(()=>{let e=(0,eK.ZP)(window,{"$mod+Enter":s,Escape:i});return()=>e()},[t,l]),(0,d.jsxs)(Z.g,{space:2,className:"h-full px-2 flex-grow",children:[(0,d.jsx)(tp.g,{className:"string-editor",label:{text:"Value",hidden:!0},value:l,onChange:e=>a(e.target.value)}),r&&(0,d.jsxs)(Z.U,{justify:"end",children:[(0,d.jsx)(q.zx,{variant:"primary",color:"gray",onClick:i,size:"sm",children:"Revert"}),(0,d.jsx)(eY.L,{x:3}),(0,d.jsx)(q.zx,{onClick:()=>s(),size:"sm",children:"Save"})]})]})},lf=e=>{let{redisKey:t,data:n,selectedItem:l,isAddingItem:a}=e,[,{hashSet:r,hashDelete:s,setKeyState:i}]=lm(),o=e=>{e===l&&i({}),s(t.name,[e])},c=e=>{i({selectedItem:e})},u=e=>{let{index:t,style:r}=e,s=Object.keys(n).sort()[t];return(0,d.jsx)(te,{style:r,selected:!a&&null!=l&&l===s,onClick:()=>c(s),children:s})};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(e3,{title:t.name,panelActions:(0,d.jsx)(lv,{redisKey:t}),children:[(0,d.jsxs)(tl,{selected:null!=a&&a,onClick:()=>i({isAddingItem:!0}),children:["add item ",(0,d.jsx)(ee.JO,{icon:U.v3})]}),(0,d.jsx)(tt,{...ez(Object.keys(n)),children:u}),(0,d.jsx)(lg,{redisKey:t})]}),a&&(0,d.jsx)(e3,{title:"add item",children:(0,d.jsx)(ly,{redisKey:t})}),!a&&null!=l&&null!=n[l]&&(0,d.jsxs)(e3,{title:l.toString(),panelActions:(0,d.jsx)(q.hU,{icon:U.Vh,title:"Delete",onClick:()=>o(l.toString())}),children:[(0,d.jsx)(lj,{value:n[l],onSave:e=>r(t.name,{[l]:e})},"".concat(l,"-").concat(n[l])),(0,d.jsx)(eY.L,{y:3})]})]})},ly=e=>{let{redisKey:t}=e,[,{hashSet:n,setKeyState:l}]=lm(),[a,r]=(0,g.useState)(""),[s,i]=(0,g.useState)(""),o=(0,g.useMemo)(()=>""!==a.trim()&&""!==s.trim(),[a,s]),c=()=>{o&&(n(t.name,{[a]:s}),l({selectedItem:a}))};return(0,g.useEffect)(()=>{let e=(0,eK.ZP)(window,{"$mod+Enter":c});return()=>e()},[a,s]),(0,d.jsx)(lh.MT,{autoFocus:!0,contain:!0,children:(0,d.jsx)(eJ.l0,{onSubmit:c,name:"Redis Hash",children:(0,d.jsxs)(Z.g,{space:3,className:"px-2 pb-2",children:[(0,d.jsx)(eJ.gN,{name:"name",label:"name",value:a,onChange:e=>r(e.target.value),placeholder:"name",autoFocus:!0}),(0,d.jsx)(eJ.i$,{children:(0,d.jsx)(tp.g,{value:s,onChange:e=>i(e.target.value),label:"value",placeholder:"value"})}),(0,d.jsx)(q.zx,{disabled:!o,children:"Add"})]})})})},lb=e=>{let{redisKey:t,data:n,selectedItem:l,isAddingItem:a}=e,[,{setListIndex:r,setKeyState:s,popList:i}]=lm(),o=(0,g.useMemo)(()=>null!=l&&"number"==typeof l&&l>=0&&l<n.length?l:null,[l,n.length]),c=e=>{let{index:t,style:l}=e,r=n[t];return(0,d.jsx)(te,{style:l,selected:!a&&o===t,onClick:()=>s({selectedItem:t}),children:(0,d.jsxs)(Z.U,{children:[(0,d.jsx)("div",{className:"min-w-5 text-gray-500 overflow-hidden overflow-ellipsis",children:t}),(0,d.jsx)(es.xv,{children:r})]})})};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(e3,{title:t.name,panelActions:(0,d.jsx)(lv,{redisKey:t}),children:[(0,d.jsxs)(tl,{selected:null!=a&&a,onClick:()=>s({isAddingItem:!0}),children:["add item ",(0,d.jsx)(ee.JO,{icon:U.v3})]}),(0,d.jsx)(tt,{...ez(n),children:c}),(0,d.jsx)(lg,{redisKey:t})]}),a&&(0,d.jsx)(e3,{title:"add item",children:(0,d.jsx)(lw,{redisKey:t,numItems:n.length})}),!a&&null!=o&&(0,d.jsxs)(e3,{title:"item ".concat(o),panelActions:0===o?(0,d.jsx)(q.Qj,{variant:"small",onClick:()=>i(t.name,"left"),children:"lpop"}):o===n.length-1?(0,d.jsx)(q.Qj,{variant:"small",onClick:()=>{i(t.name,"right"),s({selectedItem:n.length-2})},children:"rpop"}):null,children:[(0,d.jsx)(lj,{value:n[o],onSave:e=>r(t.name,o,e)},"".concat(o,"-").concat(n[o])),(0,d.jsx)(eY.L,{y:3})]})]})},lw=e=>{let{redisKey:t,numItems:n}=e,[,{pushList:l,setKeyState:a}]=lm(),[r,s]=(0,g.useState)("left"),[i,o]=(0,g.useState)(""),c=(0,g.useMemo)(()=>""!==r.trim()&&""!==i.trim(),[r,i]),u=()=>{c&&(l(t.name,r,[i]),a({selectedItem:"left"===r?0:n}))};return(0,g.useEffect)(()=>{let e=(0,eK.ZP)(window,{"$mod+Enter":u});return()=>e()},[t.name,i]),(0,d.jsx)(lh.MT,{autoFocus:!0,contain:!0,children:(0,d.jsx)(eJ.l0,{onSubmit:u,name:"Redis List",children:(0,d.jsxs)(Z.g,{space:3,className:"px-2 pb-2",children:[(0,d.jsx)(eq.P,{value:r,onChange:e=>s(e),label:{text:"Type",hidden:!0},options:[{value:"left",text:"push left"},{value:"right",text:"push right"}]}),(0,d.jsx)(eJ.i$,{children:(0,d.jsx)(tp.g,{value:i,label:"Value",onChange:e=>o(e.target.value),placeholder:"value"})}),(0,d.jsx)(q.zx,{disabled:!c,children:"Add"})]})})})},lN=e=>{let{redisKey:t,data:n,selectedItem:l,isAddingItem:a}=e,[,{setAdd:r,setRemove:s,setKeyState:i}]=lm(),o=(e,n)=>{s(t.name,[e]),r(t.name,[n]),i({selectedItem:n})},c=e=>{let{index:t,style:r}=e,s=n.sort()[t];return(0,d.jsx)(te,{style:r,selected:!a&&null!=l&&l===s,onClick:()=>i({selectedItem:s}),children:s})};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(e3,{title:t.name,panelActions:(0,d.jsx)(lv,{redisKey:t}),children:[(0,d.jsxs)(tl,{selected:null!=a&&a,onClick:()=>i({isAddingItem:!0}),children:["add item ",(0,d.jsx)(ee.JO,{icon:U.v3})]}),(0,d.jsx)(tt,{...ez(n),children:c}),(0,d.jsx)(lg,{redisKey:t})]}),a&&(0,d.jsx)(e3,{title:"add item",children:(0,d.jsx)(lC,{redisKey:t})}),!a&&null!=l&&(0,d.jsxs)(e3,{title:l.toString(),panelActions:(0,d.jsx)(q.hU,{icon:U.Vh,title:"Delete",onClick:()=>{s(t.name,[l.toString()]),i({})}}),children:[(0,d.jsx)(lj,{value:l.toString(),onSave:e=>o(l.toString(),e)},"".concat(l,"-").concat(n[l])),(0,d.jsx)(eY.L,{y:3})]})]})},lC=e=>{let{redisKey:t}=e,[,{setAdd:n,setKeyState:l}]=lm(),[a,r]=(0,g.useState)(""),s=(0,g.useMemo)(()=>""!==a.trim(),[a]),i=()=>{s&&(n(t.name,[a]),l({selectedItem:a}))};return(0,g.useEffect)(()=>{let e=(0,eK.ZP)(window,{"$mod+Enter":i});return()=>e()},[t.name,a]),(0,d.jsx)(lh.MT,{autoFocus:!0,contain:!0,children:(0,d.jsx)(eJ.l0,{onSubmit:i,name:"Redis Set",children:(0,d.jsxs)(Z.g,{space:3,className:"px-2 pb-2",children:[(0,d.jsx)(eJ.i$,{children:(0,d.jsx)(tp.g,{value:a,label:"value",onChange:e=>r(e.target.value),placeholder:"value"})}),(0,d.jsx)(q.zx,{disabled:!s,children:"Add"})]})})})},lS=e=>{let{redisKey:t,data:n}=e,[,{setString:l}]=lm();return(0,d.jsxs)(e3,{title:t.name,panelActions:(0,d.jsx)(lv,{redisKey:t}),children:[(0,d.jsx)(lj,{value:n,onSave:e=>l(t.name,e)},"".concat(t.name,"-").concat(n)),(0,d.jsx)(lg,{redisKey:t})]})},lk=()=>{let[{keyState:e,keys:t,selectedKey:n,keyData:l,isAdding:a},r]=lm(),{confirm:s}=(0,eQ.p)(),i=(0,g.useCallback)(()=>{var e,t;return(null===(e=document.activeElement)||void 0===e?void 0:e.nodeName)==="TEXTAREA"||(null===(t=document.activeElement)||void 0===t?void 0:t.nodeName)==="INPUT"},[]),o=(0,g.useCallback)(()=>{if(null==n||null==l.data||(null==e?void 0:e.selectedItem)==null||"string"===n.type);else if("list"===n.type)return e.selectedItem;else if("hash"===n.type)return Object.keys(l.data).sort().findIndex(t=>t===e.selectedItem);else if("set"===n.type)return l.data.findIndex(t=>t===e.selectedItem);return -1},[n,l.data,e]),c=(0,g.useCallback)(e=>{if(null==n||null==l.data)return;let t="list"===n.type?Math.max(0,Math.min(l.data.length-1,e)):"hash"===n.type?Object.keys(l.data).sort()[Math.max(0,Math.min(Object.keys(l.data).length-1,e))]:"set"===n.type?l.data.sort()[Math.max(0,Math.min(l.data.length-1,e))]:null;r.setKeyState({selectedItem:t})},[n,l.data,r]);(0,f.qN)(()=>({value:"redis-add-key",text:"Add Item",group:"Redis",icon:U.v3,keybinding:"C",highlighted:!0,isAvailable:()=>!i(),action:()=>{(null==e?void 0:e.selectedItem)!=null&&(null==n?void 0:n.type)!=="string"?r.setKeyState({...e,isAddingItem:!0}):r.setIsAddingKey(!0)}}),[e,n,i]),(0,f.qN)(()=>({value:"redis-delete-item",text:"Delete Item",icon:U.Vh,group:"Redis",highlighted:!0,keybinding:"D",isAvailable:()=>!i()&&null!=n,action:async()=>{null!=n&&((null==e?void 0:e.selectedItem)==null?await s({title:"Delete Key",description:"Are you sure you want to delete this Redis key?",confirmButtonText:"Delete"})&&r.deleteKey(n.name):null!=l.data&&("hash"===n.type?(r.hashDelete(n.name,[e.selectedItem]),1===Object.keys(l.data).length?r.setKeyState({}):c(0)):"list"===n.type?(0===e.selectedItem?r.popList(n.name,"left"):e.selectedItem===l.data.length-1&&(r.popList(n.name,"right"),c(l.data.length-2)),1===l.data.length&&r.setKeyState({})):"set"===n.type&&(r.setRemove(n.name,[e.selectedItem]),1===l.data.length?r.setKeyState({}):c(0))))}}),[e,n,l.data]),(0,g.useEffect)(()=>{var l;let s=(null==e?void 0:e.isAddingItem)!=null||(null==e?void 0:e.selectedItem)!=null,d=()=>null==n?-1:(null!==(l=t.data)&&void 0!==l?l:[]).findIndex(e=>e.name===n.name),u=()=>{var e;return null===(e=document.querySelector(".string-editor"))||void 0===e?void 0:e.focus()},m=()=>{var e;return null===(e=document.querySelector(".string-editor"))||void 0===e?void 0:e.blur()},x=(0,eK.ZP)(window,{ArrowDown:l=>{if(!i()){if(l.preventDefault(),null==n&&null!=t.data)r.setSelectedKey(t.data[0]);else if(s)c(o()+1);else if(null!=t.data&&(null==e?void 0:e.selectedItem)==null){let e=Math.min(t.data.length-1,d()+1);r.setSelectedKey(t.data[e])}}},ArrowUp:n=>{if(!i()){if(n.preventDefault(),s)c(o()-1);else if(null!=t.data&&(null==e?void 0:e.selectedItem)==null){let e=Math.max(0,d()-1);r.setSelectedKey(t.data[e])}}},ArrowRight:t=>{i()||(t.preventDefault(),(null==n?void 0:n.type)==="string"?u():(null==e?void 0:e.selectedItem)==null?c(0):u())},ArrowLeft:t=>{i()||(null==e?void 0:e.selectedItem)==null||(t.preventDefault(),r.setKeyState({}))},Escape:()=>{m(),a?r.setIsAddingKey(!1):(null==e?void 0:e.isAddingItem)&&r.setKeyState({...e,isAddingItem:!1})},"$mod+Enter":()=>{m()}});return()=>x()},[t,e,l,n,a])},lI=()=>{let[{keyState:e,keys:t,selectedKey:n,keyData:l,error:a,isAdding:r},s]=lm(),[{permissions:i}]=(0,T.PY)();lk();let o=(0,g.useMemo)(()=>(null==e?void 0:e.isAddingItem)?["add item"]:(null==e?void 0:e.selectedItem)!=null?[e.selectedItem.toString()]:[],[e]),c=(0,g.useMemo)(()=>["\uD83C\uDFE0",r?"add key":null,null==n?void 0:n.name,...o].filter(e=>null!=e),[n,l,r,o]),u=(e,t)=>{0===t?s.setSelectedKey(null):1===t&&s.setKeyState({})};if(!i.Write)return(0,d.jsx)(eA.O,{});if(null==t.data)return(0,d.jsx)(er.bJ,{});let m=e=>{let{index:l,style:a}=e,r=t.data[l];return(0,d.jsx)(te,{style:a,selected:null!=n&&n.name===r.name,onClick:()=>s.setSelectedKey(r),children:(0,d.jsx)(lE,{...r})})};return(0,d.jsxs)("div",{className:"flex-grow",children:[null!=a&&(0,d.jsx)(es.y,{children:a}),(0,d.jsxs)(e4,{path:c,pathClickable:!0,onClickPath:u,children:[(0,d.jsxs)(e3,{title:"keys",children:[(0,d.jsxs)(tl,{onClick:()=>s.setIsAddingKey(!0),selected:r,children:["add key ",(0,d.jsx)(ee.JO,{icon:U.v3})]}),(0,d.jsx)(tt,{...ez(t.data),children:m})]}),r&&(0,d.jsx)(lD,{}),null!=n&&(0,d.jsx)(lA,{redisKey:n,data:l.data})]})]})},lD=()=>{let[,{setString:e,setAdd:t,pushList:n,hashSet:l,setSelectedKey:a,addKey:r}]=lm(),[s,i]=(0,g.useState)("string"),[o,c]=(0,g.useState)(""),u=async()=>{if(""===o.trim())return;let i={string:()=>e(o,"hello world"),set:()=>t(o,["item"]),list:()=>n(o,"left",["item"]),hash:()=>l(o,{hello:"world"})}[s];null!=i&&(i(),a({name:o,type:s}),r(o,s))};return(0,g.useEffect)(()=>{let e=(0,eK.ZP)(window,{"$mod+Enter":u});return()=>e()},[o,s]),(0,d.jsx)(e3,{title:"add key",children:(0,d.jsx)(Z.g,{className:"p-2",children:(0,d.jsx)(lh.MT,{contain:!0,children:(0,d.jsxs)(eJ.l0,{onSubmit:u,name:"Add Redis Key",children:[(0,d.jsxs)(Z.U,{space:2,children:[(0,d.jsx)(eW.II,{label:"Name",value:o,name:"name",onChange:e=>c(e.target.value),placeholder:"users"}),(0,d.jsx)(eq.P,{value:s,name:"type",label:"Type",onChange:i,options:[{value:"string",text:"string"},{value:"list",text:"list"},{value:"set",text:"set"},{value:"hash",text:"hash"}]})]}),(0,d.jsx)(eY.L,{y:3}),(0,d.jsx)(q.zx,{disabled:""===o.trim(),className:"w-full",children:"Add Key"})]})})})})},lA=e=>{let{redisKey:t,data:n}=e,[{keyState:l}]=lm();return null==n?(0,d.jsx)(e3,{title:t.name,children:(0,d.jsx)(er.bJ,{})},t.name):(0,d.jsx)(d.Fragment,{children:"string"===t.type?(0,d.jsx)(lS,{redisKey:t,data:n}):"list"===t.type?(0,d.jsx)(lb,{redisKey:t,data:n,...l}):"set"===t.type?(0,d.jsx)(lN,{redisKey:t,data:n,...l}):"hash"===t.type?(0,d.jsx)(lf,{redisKey:t,data:n,...l}):(0,d.jsx)(Z.g,{align:"center",className:"p-4",children:(0,d.jsx)(es.y,{children:"This key type is not supported yet :("})})})},lE=e=>{let{...t}=e,{name:n,type:l,ttl:a}=t;return(0,d.jsxs)("div",{className:"flex items-center justify-between max-w-full min-w-0",children:[(0,d.jsx)("div",{className:"bg-blue-600 text-white rounded-sm min-w-10 text-xs text-center leading-5",children:l}),(0,d.jsx)(eY.L,{x:3}),(0,d.jsx)("div",{className:"flex-grow overflow-hidden overflow-ellipsis whitespace-nowrap",children:n}),null!=a&&-1!==a&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(eY.L,{x:3}),(0,d.jsxs)("div",{className:"text-gray-500 text-xs",children:[a,"s"]})," "]})]})},lP=()=>{let[{projectId:e},{resetData:t}]=lm(),[{environment:n,plugin:l}]=(0,T.PY)();return null==n||null==l?(0,d.jsx)(er.bJ,{}):(0,d.jsx)(tk,{projectId:e,plugin:l,environment:n,resetData:t})},lT=()=>{let[{projectId:e,pluginId:t,environmentId:n,logsEnabled:l}]=lm();return(0,d.jsx)(tL,{logsEnabled:l,projectId:e,pluginId:t,environmentId:n})},lR=e=>{let{view:t}=e,[{keys:n},l]=lm();return(0,f.qN)(()=>({text:"Generate dummy data",value:"generateRedisDummyData",category:"Redis",icon:U.it,isAvailable:()=>null!=n.data&&0===n.data.length,action:async()=>{try{await l.generateDummyData()}catch(e){em.log("Error generating redis dummy data",e)}}}),[n.data]),"connect"===t?(0,d.jsx)(lx,{}):"settings"===t?(0,d.jsx)(lP,{}):"logs"===t?(0,d.jsx)(lT,{}):(0,d.jsx)(lI,{})},lM=e=>{var t,n,l;let[{project:a,plugin:r,environment:s,permissions:i}]=(0,T.PY)(),{variables:o}=(0,ex.Qy)({projectId:null!==(t=null==a?void 0:a.id)&&void 0!==t?t:null,environmentId:null!==(n=null==s?void 0:s.id)&&void 0!==n?n:null,pluginId:null!==(l=null==r?void 0:r.id)&&void 0!==l?l:null,enabled:i.Write});return null==a||null==r||null==s?(0,d.jsx)(er.bJ,{}):(0,d.jsx)(lu,{project:a,environment:s,plugin:r,envs:null!=o?ep(o):null,children:(0,d.jsx)(lR,{...e})})},lO={timestamp:7,date:10,datetime:12,json:245},lL=e=>e===lO.json,lU=(e,t)=>null==e?"":t===lO.date?m()(e).format("YYYY-MM-DD"):t===lO.timestamp?m()(e).format("YYYY-MM-DD HH:mm:ss"):t===lO.datetime?m()(e).format("YYYY-MM-DD HH:mm:ss"):lL(t)?JSON.stringify(e):e.toString(),lF=e=>(0,d.jsx)(t$,{...e,databaseType:"mysql",formatValue:lU,isJsonColumnType:lL}),lV=()=>tG(),lB=e=>{let{MYSQLHOST:t,MYSQLPASSWORD:n,MYSQLPORT:l,MYSQLUSER:a,MYSQLDATABASE:r}=e;return"mysql -h".concat(t," -u").concat(a," -p").concat(n," --port ").concat(l," --protocol=TCP ").concat(r)},lK=()=>{let[{project:e,permissions:t,environment:n,plugin:l}]=(0,T.PY)(),[{envs:a}]=lV();if(!t.Write)return(0,d.jsx)(eA.O,{});if(null==e||null==a||null==l||null==n)return(0,d.jsx)(er.bJ,{});let r=lB(a);return(0,d.jsxs)("section",{className:"pb-12",children:[(0,d.jsx)(eE,{}),(0,d.jsx)(Y.i,{className:"my-6"}),(0,d.jsx)(eF,{commandName:"mysql",rawCommand:r,secret:a.MYSQLPASSWORD,plugin:l}),(0,d.jsx)(Y.i,{className:"my-6"}),(0,d.jsx)(eR,{projectId:e.id,environmentId:n.id,plugin:l})]})},lz=()=>{let[{permissions:e}]=(0,T.PY)(),[{viewState:t}]=lV();if(!e.Write)return(0,d.jsx)(eA.O,{});let n=(0,d.jsx)(nB,{});return"create-table"===t?n=(0,d.jsx)(nP,{}):"table"===t&&(n=(0,d.jsx)(n4,{})),(0,d.jsx)(Z.g,{className:"flex-grow",children:n})},lQ=()=>{let[{projectId:e},{resetData:t}]=lV(),[{environment:n,plugin:l}]=(0,T.PY)();return null==n||null==l?(0,d.jsx)(er.bJ,{}):(0,d.jsx)(tk,{projectId:e,plugin:l,environment:n,resetData:t})},l_=()=>{let[{projectId:e,pluginId:t,environmentId:n,logsEnabled:l}]=lV();return(0,d.jsx)(tL,{projectId:e,pluginId:t,environmentId:n,logsEnabled:l})},lJ=e=>{let{view:t}=e;return"settings"===t?(0,d.jsx)(lQ,{}):"connect"===t?(0,d.jsx)(lK,{}):"data"===t?(0,d.jsx)(lz,{}):"query"===t?(0,d.jsx)(t2,{}):"logs"===t?(0,d.jsx)(l_,{}):null},lW=e=>{var t,n,l;let[{project:a,plugin:r,permissions:s,environment:i}]=(0,T.PY)(),{variables:o}=(0,ex.Qy)({projectId:null!==(t=null==a?void 0:a.id)&&void 0!==t?t:null,environmentId:null!==(n=null==i?void 0:i.id)&&void 0!==n?n:null,pluginId:null!==(l=null==r?void 0:r.id)&&void 0!==l?l:null,enabled:s.Write});return null==a||null==r||null==i?(0,d.jsx)(er.bJ,{}):(0,d.jsx)(lF,{project:a,environment:i,plugin:r,envs:null!=o?eg(o):null,children:(0,d.jsx)(lJ,{...e})})},lq={postgresql:ls,mongodb:tV,mysql:lW,redis:lM};var lY=n(50361),lZ=n(24596),lH=n(36476);let l$=e=>{let{track:t}=(0,L.K)(),[n,l]=(0,lZ.y$)(),[a,r]=(0,lZ.a9)();return(0,d.jsxs)(Z.U,{space:2,align:"center",justify:"between",...e,className:"w-full md:w-auto",children:[(0,d.jsx)(lH.s,{value:a.display,options:lZ.XH.map(e=>({value:e.display})),onChange:e=>{r(e),t({action:"Change",object:"Metrics Time Range",properties:{timeRange:e}})},className:"grid grid-cols-4 w-full max-w-none sm:max-w-max sm:w-auto sm:flex"}),(0,d.jsx)(Z.U,{align:"center",space:2,children:(0,d.jsx)(lH.s,{value:n,options:[{value:"1up",text:(0,d.jsx)(ee.JO,{icon:U.QZ})},{value:"2up",text:(0,d.jsx)(ee.JO,{icon:U.rj})}],onChange:e=>{l(e),t({action:"Change",object:"Metrics Grid",properties:{gridType:e}})},className:"hidden md:flex text-gray-300"})})]})};var lG=n(24066),lX=n(61649),l0=n(22048),l1=n(12532);let l2=e=>{let{...t}=e;return(0,d.jsxs)("div",{children:[(0,d.jsx)(l1.w,{...t,xAxis:{...t.xAxis,tickTransform:"translate(0, 0)"},height:300,chartStyle:{showBorder:!1,showArea:!0}}),(0,d.jsxs)(es.Ew,{className:"mt-2 text-right text-gray-300",children:[t.lines[0].data.length," data"," ",(0,J._6)("point",t.lines[0].data.length)]})]})},l4=(0,_.Q$)("div")(e=>["grid gap-4 grid-cols-1","2up"===e.gridType&&"md:grid-cols-2 md:gap-8"]),l3=e=>{let{metrics:t,timeRange:n,gridType:l,deployments:a}=e,{cpuMetrics:r,memMetrics:s,inboundNetworkMetrics:i,outboundNetworkMetrics:o}=(0,g.useMemo)(()=>{let e=t.find(e=>e.measurement===ty.SMQ.CpuUsage),n=t.find(e=>e.measurement===ty.SMQ.MemoryUsageGb),l=t.find(e=>e.measurement===ty.SMQ.NetworkRxGb),a=t.find(e=>e.measurement===ty.SMQ.NetworkTxGb);return{cpuMetrics:e,memMetrics:n,inboundNetworkMetrics:l,outboundNetworkMetrics:a}},[t]),c=(0,g.useMemo)(()=>{var e,t;if(null==a||null==r)return[];let n=new Date((null===(e=r.values[0])||void 0===e?void 0:e.ts)*1e3);return n?a.filter(e=>new Date(e.createdAt)>=n).map(e=>{var n;return{value:new Date(e.createdAt).getTime(),label:null!==(t=null===(n=e.meta)||void 0===n?void 0:n.commitMessage)&&void 0!==t?t:"railway up",direction:"vertical",strokeDashArray:"4px"}}):[]},[a]);return(0,d.jsxs)(l4,{gridType:l,className:"pb-10",children:[null!=r&&(0,d.jsx)(l5,{metrics:r,timeRange:n,guides:c}),null!=s&&(0,d.jsx)(l6,{metrics:s,timeRange:n,guides:c}),null!=i&&null!=o&&(0,d.jsx)(l8,{inboundMetrics:i,outboundMetrics:o,timeRange:n,guides:c})]})},l5=e=>{var t,n;let{metrics:l,timeRange:a,guides:r,...s}=e;return(0,d.jsx)(l2,{...s,lines:[{data:l.values,colour:"blue"}],title:"CPU",guides:r,xAxis:{getValue:e=>new Date(1e3*e.ts),numTicks:a.numDateTicks,dateFormat:a.dateFormat},yAxis:{getValue:e=>e.value,renderValue:e=>"".concat(e.toFixed(1)," vCPU"),domain:[0,null!==(n=(0,lX.Z)([1,null!==(t=(0,lX.Z)(l.values,e=>e.value))&&void 0!==t?t:0]))&&void 0!==n?n:1]}})},l6=e=>{let{metrics:t,timeRange:n,guides:l,...a}=e;return(0,d.jsx)(l2,{...a,lines:[{data:t.values,colour:"pink"}],title:"Memory",guides:l,xAxis:{getValue:e=>new Date(1e3*e.ts),numTicks:n.numDateTicks,dateFormat:n.dateFormat},yAxis:{getValue:e=>e.value,renderValue:l0.u,domain:0===t.values.length?[0,1]:[0,(0,lX.Z)([...t.values.map(e=>e.value),.5])]}})},l8=e=>{let{inboundMetrics:t,outboundMetrics:n,timeRange:l,guides:a,...r}=e,s=(0,g.useMemo)(()=>(0,lX.Z)([...n.values.map(e=>e.value),...t.values.map(e=>e.value)]),[t,n]);return(0,d.jsxs)("div",{children:[(0,d.jsx)(l1.w,{...r,height:300,lines:[{data:n.values,colour:"pink"},{data:t.values,colour:"blue"}],title:"Network",guides:a,xAxis:{getValue:e=>new Date(1e3*e.ts),numTicks:l.numDateTicks,dateFormat:l.dateFormat,tickTransform:"translate(0, 0)"},yAxis:{getValue:e=>e.value,renderValue:l0.u,domain:[0,s]},chartStyle:{showBorder:!1}}),(0,d.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,d.jsxs)(Z.U,{space:8,align:"center",children:[(0,d.jsxs)(Z.U,{space:2,align:"center",children:[(0,d.jsx)("div",{className:"h-1 w-8 rounded bg-pink-500"}),(0,d.jsx)(es.Ew,{children:"Outbound"})]}),(0,d.jsxs)(Z.U,{space:2,align:"center",children:[(0,d.jsx)("div",{className:"h-1 w-8 rounded bg-blue-500"}),(0,d.jsx)(es.Ew,{children:"Inbound"})]})]}),(0,d.jsxs)(es.Ew,{className:"text-right text-gray-300",children:[t.values.length," data"," ",(0,J._6)("point",t.values.length)]})]})]})},l7=e=>{let{project:t,environment:n,serviceId:l,pluginId:a}=e,{result:r}=(0,lZ.Lh)({environmentId:n.id,serviceId:l,pluginId:a}),s=(0,g.useMemo)(()=>null!=r.data,[r]),[i]=(0,lZ.a9)(),[o]=(0,lZ.y$)(),{allDeployments:c}=(0,lY.s)({projectId:t.id,environmentId:n.id,serviceId:l,disabled:null==l});return(0,d.jsxs)(Z.g,{space:8,className:"pb-12 h-full",children:[(r.isLoading||s)&&(0,d.jsx)(l$,{className:"w-full"}),null!=r.error?(0,d.jsx)(es.y,{children:r.error.message}):null==r.data?(0,d.jsx)(lG.M,{}):(0,d.jsx)(l3,{gridType:o,timeRange:i,metrics:r.data,deployments:null!=l?c:null})]})},l9=e=>{let{title:t,message:n,action:l,showUpgradeCta:a=!1,...r}=e,{routes:s}=(0,P.H)();return(0,d.jsx)(W.j,{hideIcon:!0,variant:"warning",...r,children:(0,d.jsxs)(Z.g,{space:5,align:"center",className:"my-3 w-full",children:[(0,d.jsx)(ee.JO,{icon:U.kx,size:"lg"}),(0,d.jsxs)(Z.g,{space:1,align:"center",children:[(0,d.jsx)(es.L,{className:"text-center font-semibold",children:t}),(0,d.jsx)(es.nq,{className:"text-center max-w-2xl",children:n})]}),null!=l?(0,d.jsx)(d.Fragment,{children:l}):a?(0,d.jsx)(q.ZP,{size:"sm",...s.accountUpgrade({}),className:"min-w-max",children:"Remove Limits"}):null]})})};var ae=n(88595);let at=e=>{let{environmentId:t}=e,{pluginId:n}=(0,P.H)(),[,l]=(0,T.PY)(),{modalActions:a}=(0,F.o)(),r=async()=>{if(null==n)throw Error("Plugin ID is null");try{await l.startPlugin({id:n,input:{environmentId:t}}),a.createToast((0,d.jsx)(tr.FN,{variant:"success",title:"Plugin started",description:"Choo Choo! We have successfully started your plugin."}))}catch(t){var e;a.createToast((0,d.jsx)(tr.FN,{variant:"error",title:"Error starting plugin",description:null!==(e=t.message)&&void 0!==e?e:"There was an error starting your plugin. Please contact support for assistance."}))}};return(0,d.jsx)(l9,{title:"Plugin Stopped",message:"Plugin was stopped due to exeeding usage limits. Click the button below to start the plugin again!",action:(0,d.jsx)(q.zx,{variant:"primary",onClick:r,children:"Start Plugin"})})},an=e=>{let{environmentId:t,user:n}=e,{freePlan:l,isLoading:a}=(0,ae.k)({user:n});return a?(0,d.jsx)(er.bJ,{}):(0,d.jsx)(d.Fragment,{children:l.maxedOut?(0,d.jsx)(l9,{showUpgradeCta:!0,title:"Access Paused",message:"Plugin access has been paused until the end of the month. Upgrade now to re-enable access."}):(0,d.jsx)(at,{environmentId:t})})},al=e=>{let{environmentId:t}=e,[{user:n}]=(0,V.aF)();return null==n?null:(0,d.jsx)(d.Fragment,{children:n.isDevPlan?(0,d.jsx)(at,{environmentId:t}):(0,d.jsx)(an,{user:n,environmentId:t})})},aa=e=>{var t;let{project:n,environment:l,pluginName:a,pluginView:r,pluginComponent:s,status:i}=e,{pluginId:o,routes:c}=(0,P.H)(),u=null!=s?lq[s.value]:null,m=(0,g.useMemo)(()=>{var e;if(null!=i&&i===ty.vFU.Stopped)return Array.of({text:"Info",link:c.projectPluginView({view:"info"}),active:!0});let t=(null!==(e=null==s?void 0:s.views)&&void 0!==e?e:[]).map(e=>({text:e,link:c.projectPluginView({view:e}),active:(null==r?void 0:r.toLowerCase())===e.toLowerCase()}));return t.splice(t.length-1,0,{text:"Metrics",active:(null==r?void 0:r.toLocaleLowerCase())==="metrics",link:c.projectPluginView({view:"Metrics"})}),t},[r,i]);return(0,d.jsx)(ei.Aj,{title:a,icon:null==s?void 0:s.icon,tabs:m,children:null==s?(0,d.jsx)(er.bJ,{}):(0,d.jsx)(d.Fragment,{children:i===ty.vFU.Stopped?(0,d.jsxs)(Z.g,{space:5,align:"center",children:[(0,d.jsx)(ee.JO,{icon:U.kI,size:"lg"}),(0,d.jsxs)(Z.g,{space:1,align:"center",children:[(0,d.jsx)(es.L,{className:"font-semibold",children:"Plugin stopped"}),(0,d.jsx)(es.nq,{className:"text-center max-w-lg",children:"Your plugin has been stopped to prevent any additional usage as you went over the usage limit."})]})]}):i===ty.vFU.Locked?(0,d.jsx)(al,{environmentId:l.id}):(null==r?void 0:r.toLowerCase())==="metrics"?(0,d.jsx)(l7,{project:n,environment:l,pluginId:null!=o?o:void 0}):(0,d.jsx)(d.Fragment,{children:null!=u&&(0,d.jsx)(u,{view:null!==(t=null==r?void 0:r.toLowerCase())&&void 0!==t?t:null})})})})};var ar=n(22646);function as(){let e=(0,eH.Z)(["font-semibold break-all"]);return as=function(){return e},e}function ai(){let e=(0,eH.Z)(["\n  flex flex-col h-full\n"]);return ai=function(){return e},e}function ao(){let e=(0,eH.Z)(["\n  w-full flex-shrink-0 flex border-b border-t border-gray-100 h-[34px]\n"]);return ao=function(){return e},e}function ac(){let e=(0,eH.Z)(["\n  flex-grow flex items-center justify-center text-sm text-gray-500 border-b border-transparent cursor-pointer\n  data-[state=active]:text-foreground\n  data-[state=active]:border-foreground\n"]);return ac=function(){return e},e}function ad(){let e=(0,eH.Z)(["max-w-full h-full"]);return ad=function(){return e},e}m().extend(z());let au=e=>{let{project:t,environment:n}=e;return(0,d.jsxs)(ay,{defaultValue:"all",className:"grid grid-rows-[auto_minmax(0px,_1fr)]",children:[(0,d.jsxs)(ab,{children:[(0,d.jsx)(aw,{value:"current",children:"This Environment"}),(0,d.jsx)(aw,{value:"all",className:"ml-4",children:"All Environments"})]}),(0,d.jsx)(aN,{value:"current",children:(0,d.jsx)(am,{project:t,environment:n})}),(0,d.jsx)(aN,{value:"all",children:(0,d.jsx)(am,{project:t,environment:n,showAllEnvironmentActivity:!0})})]})},am=e=>{let{project:t,environment:n,showAllEnvironmentActivity:l}=e,{activity:a}=(0,C.X)({projectId:t.id,...l?{}:{environmentId:n.id}});return null==a.data?(0,d.jsx)(er.bJ,{className:"mt-8"}):(0,d.jsx)(Z.g,{as:"ul",className:"overflow-y-auto h-full",children:0===a.data.edges.length?(0,d.jsx)(es.xv,{className:"p-4",children:"No activity"}):(0,d.jsx)(d.Fragment,{children:a.data.edges.map(e=>(0,d.jsx)(af,{project:t,event:e.node,showEnvironment:l},e.node.id))})})},ax={added:U.v3,crashed:U.bG,failed:U.bG,restarted:U.bG,created:U.v3,deleted:U.Vh,deployed:U.fU,removed:U.Vh,updated:U.I8,invited:U.Mh,paused:U.kx,resumed:U.k6,stopped:U.bG,started:U.fU,snapshoted:U.v3,redeployed:U.oQ},ah={added:"!text-blue-500",crashed:"!text-red-500",failed:"!text-red-500",restarted:"!text-yellow-500",created:"!text-blue-500",deleted:"!text-gray-500",deployed:"!text-green-500",removed:"!text-gray-500",updated:"!text-blue-500",invited:"!text-pink-500",paused:"!text-yellow-500",resumed:"!text-pink-500",stopped:"!text-red-500",started:"!text-green-500",snapshoted:"!text-blue-500",redeployed:"!text-blue-500"},av=e=>{var t,n;let{action:l}=e,a=null!==(t=ax[l])&&void 0!==t?t:U.bG,r=null!==(n=ah[l])&&void 0!==n?n:"!text-pink-500";return(0,d.jsx)(ee.JO,{size:"md",icon:a,className:(0,_.AK)("mt-1",r)})},ap=(e,t)=>{let n=t.object,l=t.action;if("Project"===n)return"This project was created!";if("Environment"===n){let e=t.payload;return(0,d.jsxs)("p",{children:[(0,d.jsx)(ag,{children:e.name})," was ",l]})}if("Service"===n||"Plugin"===n){let e=t.payload;return(0,d.jsxs)("p",{children:[(0,d.jsx)(ag,{children:e.name})," service ",l," ","added"===l?"to":"from"," project"]})}if("Shared Variable"===n){let e=t.payload;return(0,d.jsxs)("p",{children:[(0,d.jsx)(ag,{children:e.name})," was ",l]})}if("Variable"===n){let e=t.payload;return(0,d.jsxs)("p",{children:[(0,d.jsx)(ag,{children:e.name})," was ",l]})}if("Deployment"===n){let n=t.payload,a=null!=n.serviceId?e.services.find(e=>e.id===n.serviceId):null;return null!=a?(0,d.jsxs)("p",{children:[(0,d.jsx)(ag,{children:a.name})," service deployment"," ","deployed"===l?"succeeded":l]}):(0,d.jsxs)("p",{children:["Deployment ",l]})}if("Member"===n){let e=t.payload;return(0,d.jsxs)("p",{children:[(0,d.jsx)(ag,{children:e.email})," was ",l," to the project"]})}else if("Token"===n){let e=t.payload;return(0,d.jsxs)("p",{children:["Token ",(0,d.jsx)(ag,{children:e.name})," was ",l," from the project"]})}return""},ag=_.dy.span(as()),aj=(e,t)=>{let n=t.object,l=t.action;if("Project"===n);else if("Environment"===n)return e.projectSettings({});else if("Service"===n){let n=t.payload;return"deleted"===l?null:e.projectServiceDeployments({serviceId:n.id})}else if("Plugin"===n){let n=t.payload;return"deleted"===l?null:e.projectPlugin({pluginId:n.id})}else if("Shared Variable"===n)return e.projectSharedVariables({});else if("Variable"===n){let n=t.payload;return n.serviceId?e.projectServiceVariables({serviceId:n.serviceId}):n.pluginId?e.projectPluginView({pluginId:n.pluginId,view:"Variables"}):e.projectDeployVariables({})}else if("Deployment"===n){let n=t.payload;return null!=n.serviceId?e.projectServiceDeployments({deploymentId:n.id,serviceId:n.serviceId}):e.projectDeploy({deploymentId:n.id})}else if("Member"===n)return e.projectSettings({});else if("Token"===n)return e.projectSettings({});return null},af=e=>{var t;let{project:n,event:l,showEnvironment:a}=e,{routes:r}=(0,P.H)(),s=aj(r,l),i=ah[l.action],[,o]=(0,T.PY)(),c=(0,g.useMemo)(()=>{var e;return null!=l.environmentId&&null!==(t=null===(e=n.environments.find(e=>e.id===l.environmentId))||void 0===e?void 0:e.name)&&void 0!==t?t:null},[n,l]);return"snapshot"===l.action?null:(0,d.jsx)("li",{className:"w-full",children:(0,d.jsxs)(et.r,{as:null==s?"div":void 0,...s,onClick:()=>{null!=l.environmentId&&o.setActiveEnvironment(l.environmentId)},className:"w-full flex items-start space-x-4 p-4",children:[(0,d.jsx)(av,{action:l.action}),(0,d.jsxs)(Z.g,{children:[(0,d.jsxs)(es.$2,{className:(0,_.AK)("font-medium mb-1",i),children:["Plugin"===l.object?"Service":l.object," ",(0,J.kC)("deployed"===l.action?"succeeded":l.action)]}),(0,d.jsx)(es.Zb,{className:"mb-2",children:ap(n,l)}),(0,d.jsxs)(es.OM,{className:"text-gray-500",children:[a&&null!=c&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("span",{className:"font-semibold",children:c})," ",(0,d.jsx)("span",{children:"\xb7"})," "]}),(0,d.jsx)("span",{children:(0,ar.XB)(l.createdAt)})]})]})]})})},ay=(0,_.Lq)(tD.fC)(ai()),ab=(0,_.Lq)(tD.aV)(ao()),aw=(0,_.Lq)(tD.xz)(ac()),aN=(0,_.Lq)(tD.VY)(ad()),aC=g.forwardRef((e,t)=>{let{project:n,environment:l}=e,[a,r]=(0,C.K)(),s=(0,E.t)(),i=(0,S.P)("sm");return s&&(!i||a)?(0,d.jsx)("div",{ref:t,className:(0,_.AK)("absolute bottom-0 z-30 overflow-y-hidden pointer-events-none","w-auto -top-px left-0 right-0","sm:w-activity sm:top-[98px] sm:left-auto sm:right-6"),children:(0,d.jsxs)(h.E.div,{initial:!!i&&{y:40},animate:{y:a?0:"calc(100% - ".concat(42,"px)")},transition:{type:"tween",duration:i?.15:.2,ease:"easeInOut"},className:(0,_.AK)("absolute top-0 right-0 bottom-0 h-full grid grid-rows-[auto_minmax(0px,_1fr)]","rounded-t-lg border-t border-l border-r border-gray-200 overflow-hidden pointer-events-auto","bg-background dark:bg-secondaryBg","w-full","sm:w-full"),children:[(0,d.jsxs)("button",{onClick:()=>r(!a),className:"flex items-center py-2 px-4 w-full text-left",name:"Activity Feed",children:[(0,d.jsx)(ee.JO,{icon:U.cS,className:"!text-pink-500"}),(0,d.jsx)(es.xv,{className:"ml-2",children:"Activity"}),(0,d.jsx)(ee.JO,{icon:a?U._M:U.Kh,className:"ml-auto"})]}),a&&(0,d.jsx)(au,{project:n,environment:l})]},"activity")}):null});var aS=n(83752),ak=n(13508),aI=n(68079);let aD=e=>{let{project:t,environment:n}=e,l=(0,g.useMemo)(()=>(0,aI.i)({project:t,environment:n}),[t,n]),a=(0,g.useMemo)(()=>({plugin:ak.Y_,service:ak.AP,empty:ak._$,template:ak.h_}),[]);return(0,d.jsx)(aS.tV,{children:(0,d.jsx)(aA,{children:l.map(e=>{let t=a[e.type];return(0,d.jsx)(t,{data:e},e.id)})})})},aA=e=>{let{children:t}=e;return(0,d.jsx)("ul",{className:"w-full max-w-full px-5 service-list",children:t})},aE=()=>(0,d.jsx)(aA,{children:(0,d.jsx)(ak.is,{className:"border-t border-b border-gray-200"})});var aP=n(21565),aT=n(81704),aR=n(42598),aM=n(1371),aO=n(51952),aL=n(66440),aU=n(16436),aF=n(26330),aV=n(37559);let aB=e=>{var t,n;let{deployment:l,isInActive:a,showStaticUrl:r}=e,[{permissions:s}]=(0,T.PY)(),{routes:i}=(0,P.H)(),o=null!==(t=l.meta)&&void 0!==t?t:{},c=null!=o.commitMessage,u=null!=l.serviceId?i.projectServiceDeployments({deploymentId:l.id}):i.projectDeploy({deploymentId:l.id}),{actions:x,isLoading:h}=(0,aF.v)(l),v=!a&&(l.status===ty.Wtj.Crashed||l.status===ty.Wtj.Failed),p=r?l.staticUrl:null,g=l.status===ty.Wtj.Initializing||l.status===ty.Wtj.Building||l.status===ty.Wtj.Deploying,j=l.status===ty.Wtj.Success,f=l.status===ty.Wtj.Crashed,y=(0,aV.l)(p),b=(n=l.status,(0,_.AK)("grid grid-cols-[minmax(0px,_1fr)_auto_auto] sm:grid-cols-3 md:grid-cols-5 gap-4 sm:gap-6","px-3 py-3 md:px-6 md:py-4 border rounded-lg cursor-pointer",a&&az,a?aJ:aW[n]));return(0,d.jsxs)("div",{onClick:x.openDeployment,className:b,children:[(0,d.jsxs)(Z.g,{space:1,justify:"between",className:(0,_.AK)("h-full overflow-hidden",c?"col-span-2":"col-span-2 md:col-span-4"),children:[l.status===ty.Wtj.Success&&null!=p?(0,d.jsx)("div",{className:"whitespace-nowrap overflow-hidden overflow-ellipsis font-medium max-w-max",children:y?p:(0,d.jsx)(et.r,{name:"Deployment Item Open Deployment",href:"https://".concat(p),onClick:e=>e.stopPropagation(),className:"group",children:(0,d.jsxs)(Z.U,{align:"center",space:1,children:[(0,d.jsx)("span",{className:"hover:underline",children:p}),(0,d.jsx)(es.$2,{"aria-hidden":!0,className:"hidden group-hover:inline-block no-underline select-none opacity-40",children:"â†—"})]})})}):(0,d.jsxs)(es.xv,{children:[(0,J.kC)(l.status.toLowerCase())," ",g&&(0,d.jsx)(aK,{createdAt:l.createdAt})]}),(0,d.jsxs)(es.$2,{className:"text-gray-600",children:[(a||f)&&(0,d.jsx)("span",{className:"text-gray-400",children:"Deployed "}),m()(l.createdAt).fromNow()," ",(0,d.jsx)("span",{className:"text-gray-400",children:"via"})," ",c?"GitHub":"CLI"]})]}),c&&(0,d.jsxs)(Z.g,{space:1,justify:"between",className:"hidden md:flex col-span-2 h-full",children:[(0,d.jsx)(es.xv,{className:(0,_.AK)("text-foreground overflow-hidden overflow-ellipsis whitespace-nowrap",a&&"text-gray-600"),children:o.commitMessage}),(0,d.jsxs)(Z.U,{align:"center",space:2,children:[(0,d.jsx)(ee.JO,{icon:U.I0,size:"sm",className:"text-gray-500"}),(0,d.jsx)(es.Zb,{children:o.branch})]})]}),(0,d.jsxs)(Z.U,{align:"center",justify:"end",space:2,children:[!a&&(0,d.jsx)(d.Fragment,{children:f&&null!=x.restartDeployment?(0,d.jsx)(q.zx,{variant:"primary",size:"sm",color:"pink",isLoading:h,disabled:!s.Write||h,onClick:e=>{null!=x.restartDeployment&&(e.stopPropagation(),e.preventDefault(),x.restartDeployment())},className:"hidden sm:flex",children:"Restart"}):(0,d.jsx)(q.ZP,{variant:"outline",size:"sm",color:"gray",...u,className:(0,_.AK)("hidden sm:block whitespace-nowrap",j&&"border-green-200 text-green-700 dark:text-green-700",v&&"border-red-200 text-red-700 dark:text-red-700",g&&"border-blue-200 text-blue-700 dark:text-blue-700","whitespace-nowrap hover:bg-transparent hover:border-current"),children:"View Logs"})}),s.Write&&(0,d.jsxs)(aU.Lt,{children:[(0,d.jsx)(aU.z,{icon:U.hl,title:"Deployment actions",className:"w-9 h-9 flex items-center justify-center"}),(0,d.jsxs)(aU.Nv,{align:"end",children:[(a||l.status===ty.Wtj.Success)&&(0,d.jsx)(aU.hP,{onSelect:x.openDeployment,name:"View Logs",children:"View Logs"}),null!=x.restartDeployment&&(0,d.jsx)(aU.hP,{onSelect:x.restartDeployment,name:"Restart",children:"Restart"}),null!=x.redeployDeployment&&(0,d.jsx)(aU.hP,{onSelect:x.redeployDeployment,name:"Redeploy",children:"Redeploy"}),l.canRollback&&null!=x.rollbackDeployment&&(0,d.jsx)(nA.Ik,{children:(0,d.jsx)(aU.hP,{name:"Rollback",onSelect:x.rollbackDeployment,children:"Rollback"})}),null!=x.cancelDeployment&&(0,d.jsx)(nA.Ik,{children:(0,d.jsx)(aU.hP,{onSelect:x.cancelDeployment,name:"Abort",className:"text-red-500",children:"Abort"})}),null!=x.removeDeployment&&(0,d.jsx)(nA.Ik,{children:(0,d.jsx)(aU.hP,{onSelect:x.removeDeployment,name:"Remove",className:"text-red-500",children:"Remove"})})]})]})]})]})},aK=e=>{let{createdAt:t}=e,[n,l]=(0,g.useState)((0,ar.kV)(t));return(0,g.useEffect)(()=>{let e=setInterval(()=>{l((0,ar.kV)(t))},1e3);return()=>clearInterval(e)},[t]),(0,d.jsxs)("span",{className:"hidden md:inline",children:["(",n,")"]})},az="bg-secondaryBg border-secondaryBg dark:bg-gray-100 text-gray-600 hover:border-gray-200 hover:dark:border-gray-300",aQ="bg-blue-50 border-blue-200 text-blue-600 hover:bg-blue-100 dark:text-blue-700",a_="bg-red-50 border-red-200 text-red-600 hover:bg-red-100 dark:text-red-700",aJ="bg-secondaryBg border-secondaryBg text-gray-600 hover:bg-gray-100 hover:border-gray-100 dark:bg-gray-50 dark:border-gray-50 dark:hover:bg-gray-100 dark:hover:border-gray-100",aW={[ty.Wtj.Initializing]:aQ,[ty.Wtj.Building]:aQ,[ty.Wtj.Deploying]:aQ,[ty.Wtj.Success]:"bg-green-50 border-green-200 text-green-600 shadow-sm hover:bg-green-100 dark:text-green-700",[ty.Wtj.Failed]:a_,[ty.Wtj.Crashed]:a_,[ty.Wtj.Skipped]:aJ,[ty.Wtj.Removing]:"",[ty.Wtj.Removed]:"",[ty.Wtj.Waiting]:""};m().extend(z());let aq=(0,aR.Z)("@railway/showInactiveDeploys",!0),aY=e=>{let{project:t,serviceId:n,environment:l}=e,[a,r]=(0,g.useState)(500),{isLoading:s,allDeployments:i,hasMoreDeployments:o,isFetchingMoreDeployments:c,fetchMoreDeployments:u}=(0,lY.s)({projectId:t.id,environmentId:l.id,serviceId:n,refetchInterval:a}),{deployIfServiceChanged:m}=(0,tb.Q)();(0,g.useEffect)(()=>{m({serviceId:n,environmentId:l.id})},[]);let{query:x,routes:h,navActions:v}=(0,P.H)(),[p,j]=aq(),y=(0,g.useMemo)(()=>"string"==typeof x.id?x.id:null,[x]),{activeDeploys:b,historyDeploys:w}=(0,g.useMemo)(()=>{let e=[],t=[],n=i.filter(e=>e.status===ty.Wtj.Success||e.status===ty.Wtj.Crashed),l=n[n.length-1],a=null!=l?new Date(l.createdAt):null;for(let n of null!=i?i:[])null!=a&&new Date(n.createdAt)<a?t.push(n):e.push(n);return{activeDeploys:e,historyDeploys:t}},[i]);(0,g.useEffect)(()=>{null!=i&&r(4e3)},[i]);let N=i.length>0;return(0,f.qN)(()=>({text:"Service Deployments",value:"service-deployments",group:"Service",icon:U.xu,subCommands:i.filter(e=>e.id!==y).map(e=>{var t;let n=e.id.substring(0,7),l=null!==(t=e.meta)&&void 0!==t?t:{};return{text:"".concat(n," - ").concat(null!=l.commitMessage?l.commitMessage:"railway up"),value:e.id,icon:()=>(0,d.jsx)(aL.g,{status:e.status}),action:()=>{v.push(h.projectServiceDeployments({deploymentId:e.id}))}}})}),[y,i]),(0,d.jsxs)(Z.g,{children:[(0,d.jsx)(aH,{project:t,className:"mb-5"}),(0,d.jsx)(aO.q,{projectId:l.projectId,environmentId:l.id,serviceId:n,className:"mb-5"}),s?(0,d.jsx)(tX.B,{width:"100%",height:83}):N?(0,d.jsxs)(Z.g,{space:8,className:"pb-8",children:[b.length>0&&(0,d.jsx)(aZ,{deployments:b}),w.length>0&&(0,d.jsx)(aT.fC,{type:"single",collapsible:!0,defaultValue:p?"inactive":"",onValueChange:e=>j(!!e),children:(0,d.jsxs)(aT.ck,{value:"inactive",className:"flex flex-col justify-center space-y-4",children:[(0,d.jsx)(aT.h4,{children:(0,d.jsxs)(aT.xz,{className:"flex items-center space-x-2",children:[(0,d.jsx)(ee.JO,{icon:p?U._M:U.Kh}),(0,d.jsx)(es.$2,{className:"uppercase font-medium",children:"history"})]})}),(0,d.jsxs)(aT.VY,{children:[(0,d.jsx)(aZ,{deployments:w,isInActive:!0}),o&&(0,d.jsx)(q.zx,{size:"sm",variant:"outline",color:"gray",isLoading:c,onClick:()=>u(),className:"mt-6 mx-auto",children:"Load More"})]})]})}),o&&0===w.length&&(0,d.jsx)(q.zx,{size:"sm",variant:"outline",color:"gray",isLoading:c,onClick:()=>u(),className:"mt-6 mx-auto",children:"Load More"})]}):(0,d.jsx)(es.xv,{className:"flex items-center justify-center w-full border border-dashed border-gray-400 px-4 py-8 rounded-lg",children:"Your project has no deploys"})]})},aZ=e=>{let{deployments:t,...n}=e,l=(0,g.useMemo)(()=>t.filter(e=>e.status===ty.Wtj.Success),[t]);return(0,d.jsx)("ul",{className:"space-y-2 sm:space-y-3",children:t.map((e,t)=>(0,d.jsx)(aB,{deployment:e,showStaticUrl:l.length>0&&e.id===l[0].id,...n},e.id))})},aH=e=>{let{project:t,...n}=e,l=(0,aM.HS)(),a=!l.allowed&&l.message.includes("resources");return l.allowed||l.message===B.RESOURCE_ACCESS_ERRORS.ANONYMOUS_PROJECT?null:(0,d.jsx)(l9,{showUpgradeCta:a,title:"Deployments Paused",message:"".concat(l.message,". ").concat(a?"Deployments have been removed and can be re-deployed next month. Upgrade now to re-enable deploys.":null),...n})};var a$=n(94922),aG=n(38421),aX=n.n(aG),a0=n(92762);let a1=e=>{let{projectId:t,environmentId:n,pluginId:l=null,serviceId:a=null}=e,{projectVariables:r,projectVariablesByEnvironment:s}=(0,eT.aq)({projectId:t}),i=(0,g.useMemo)(()=>{var e,t;let i=(null!==(t=r.data)&&void 0!==t?t:[]).filter(e=>e.id!==n).reduce((e,t)=>({...e,[t.id]:{environmentName:t.name,variables:t.variables.filter(e=>e.pluginId===l&&e.serviceId===a)}}),{}),o=new Set(null===(e=s[n])||void 0===e?void 0:e.map(e=>e.name)),c={};for(let[e,{environmentName:t,variables:n}]of Object.entries(i))for(let l of n)o.has(l.name)||(null==c[l.name]&&(c[l.name]=[]),c[l.name].push({environmentId:e,environmentName:t}));return c},[r,s]),{graphqlClient:o}=(0,M.S)(),c=async e=>{let{name:n,environmentId:r}=e,{unrenderedVariables:s}=await o.variables({projectId:t,environmentId:r,pluginId:l,serviceId:a});return s[n]};return{phantomVariables:i,decryptPhantomVariable:c}},a2=e=>{var t;let{project:n,serviceId:l,serviceVariables:a}=e,[r,s]=a4(),i=(0,g.useMemo)(()=>a.some(e=>e.references.some(e=>!e.startsWith(eT.ye)&&e.includes("."))),[a]),o=()=>{null!=n&&s(e=>({...e,[l]:!0}))},c=null!==(t=null==n?void 0:n.plugins.length)&&void 0!==t?t:0,d={suggestAddPluginRefVariable:c>0&&!i&&!r[l]};return[d,{dismissSuggestAddPluginRefVariable:o}]},a4=(0,aR.Z)("@railway/suggestAddPluginRef/dismissed",{}),a3=e=>{let{projectId:t,environmentId:n,serviceId:l,enabled:a}=e,{graphqlClient:r}=(0,M.S)(),{result:s}=(0,R.o)(["suggestedVariables",t,n,l],async()=>{if(null==t||null==n||null==l)throw Error("No projectId or environmentId or serviceId");let e=(await r.serviceInstanceSuggestedVariables({environmentId:n,serviceId:l})).serviceInstanceSuggestedVariables;return e},{enabled:a&&null!=t&&null!=n,refetchOnWindowFocus:!1});return{suggestedVariables:s}};var a5=n(34142),a6=n(70201),a8=n(20737),a7=n(6518),a9=n(61570),re=n(24222),rt=n(92393);let rn=e=>{let{name:t,values:n,addVariable:l}=e;return(0,d.jsxs)(rt.zC,{className:"text-gray-600 rounded",children:[(0,d.jsx)("div",{className:"text-sm font-mono truncate",children:t}),(0,d.jsxs)("div",{className:"mx-3 text-sm space-y-2 truncate",children:["Found in"," ",n.map(e=>{let{environmentName:t}=e;return t}).join(", ")]}),(0,d.jsx)(nA.Ik,{children:(0,d.jsx)("div",{className:"flex items-center justify-end text-sm actions",children:(0,d.jsxs)(aU.Lt,{children:[(0,d.jsx)(aU.z,{icon:U.hl,title:"Variable actions",className:"p-1 pr-0"}),(0,d.jsx)(aU.Nv,{align:"end",children:n.map((e,n)=>{let{environmentName:a,environmentId:r}=e;return(0,d.jsx)(aU.hP,{onSelect:()=>l({name:t,environmentId:r}),children:(0,d.jsxs)("span",{children:["Import from ",(0,d.jsx)("strong",{children:a})]})},"".concat(r,"-").concat(t,"-").concat(n))})})]})})})]})};var rl=n(85192);let ra=e=>{let{suggestedVariables:t,onAddVariables:n,hideSuggestedVariables:l}=e,{register:a,control:r,errors:s,handleSubmit:i}=(0,ta.cI)({defaultValues:{variables:Object.entries(t).map(e=>{let[t,n]=e;return{name:t,value:n}})}}),{fields:o,remove:c}=(0,ta.Dq)({control:r,name:"variables"}),u=e=>{let t=e.variables.reduce((e,t)=>{let{name:n,value:l}=t;return{...e,[n]:l}},{});n(t)};return(0,d.jsxs)(Z.g,{justify:"center",className:"text-center",children:[(0,d.jsx)(es.xv,{className:"leading-6 font-medium mb-2",children:"Suggested Variables"}),(0,d.jsx)(es.Zb,{className:"leading-5 text-gray-500 mb-6",children:"We found some variables in your repo that you might need"}),(0,d.jsxs)(eJ.l0,{enableBindings:!0,onSubmit:i(u),name:"Suggested Variables",children:[(0,d.jsx)("ul",{className:"space-y-3",children:o.map((e,t)=>{var n,l;return(0,d.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,d.jsx)(eW.II,{placeholder:"VARIABLE_NAME",name:"variables[".concat(t,"].name"),label:{text:"Name",hidden:!0},ref:a({required:!0,pattern:eO.envVarRegex}),defaultValue:e.name,error:null!=s.variables&&(null===(n=s.variables[0])||void 0===n?void 0:n.name)!=null,className:"flex-grow"}),(0,d.jsx)(eW.II,{placeholder:"VALUE",name:"variables[".concat(t,"].value"),label:{text:"Value",hidden:!0},ref:a,defaultValue:e.value,error:null!=s.variables&&(null===(l=s.variables[0])||void 0===l?void 0:l.value)!=null,className:"flex-grow"}),(0,d.jsx)(q.hU,{type:"button",title:"Remove",icon:U.Vh,color:"red",onClick:()=>c(t),className:"min-w-[42px] min-h-[42px]"})]},e.id)})}),(0,d.jsxs)(Z.U,{align:"center",space:2,justify:"end",className:"mt-4",children:[(0,d.jsx)(q.zx,{type:"button",color:"gray",variant:"outline",onClick:l,children:"Hide"}),(0,d.jsx)(q.zx,{children:"Add All"})]})]})]})},rr=(e,t)=>(0,a0.ZP)("@railway/suggestedVariables/project/".concat(e,"/").concat(t),!0),rs=e=>{var t,n;let{projectId:l,environmentId:a,serviceId:r,allowEditing:s}=e,[{permissions:i,project:o}]=(0,T.PY)(),{routes:c,query:u}=(0,P.H)(),{confirm:m}=(0,eQ.p)(),{track:x}=(0,L.K)(),{projectVariablesByEnvironment:h,sharedVariablesByEnvironment:v,isLoading:p}=(0,eT.aq)({projectId:l}),f=null!==(t=h[a])&&void 0!==t?t:[],[y,b]=(0,g.useState)(!1),{phantomVariables:w,decryptPhantomVariable:N}=a1({projectId:l,environmentId:a,serviceId:r}),C=(0,g.useMemo)(()=>f.filter(e=>null!=r&&e.serviceId===r),[f,r]),{order:S,setOrder:k}=(0,a6.b)(r),I=(0,g.useMemo)(()=>(0,eO.sortVariablesByOrder)({order:S,variables:C}),[S,C]),[D,A]=rr(l,r),E=()=>A(!1),{suggestedVariables:{data:R}}=a3({projectId:l,environmentId:a,serviceId:r,enabled:D&&!0===s&&0===I.length}),{upsertVariable:M,upsertVariables:O,deleteVariable:B,promoteToSharedVariable:K,upsertVariablesFromObject:z,setVariablesFromObject:Q}=(0,a5.R)({projectId:l,environmentId:a,serviceId:r}),{unrenderedVariables:_}=(0,ex.Qy)({projectId:l,environmentId:a,serviceId:r,enabled:i.Write}),{unrenderedVariables:$}=(0,ex.Qy)({projectId:l,environmentId:a,serviceId:null,enabled:!0}),G=(0,g.useMemo)(()=>{if(null==_)return null;let e=(0,eO.sortVariablesByOrder)({order:S,variables:Object.entries(_).map(e=>{let[t,n]=e;return{name:t,value:n}})});return e.reduce((e,t)=>{let{name:n,value:l}=t;return{...e,[n]:l}},{})},[S,_]),X=null!==(n=v[a])&&void 0!==n?n:[],en=(0,g.useMemo)(()=>(0,eO.sortVariablesByOrder)({order:S,variables:X}),[S,X]),[{suggestAddPluginRefVariable:el},{dismissSuggestAddPluginRefVariable:ea}]=a2({project:o,serviceId:r,serviceVariables:I}),[ei,eo]=(0,g.useState)("string"==typeof u.addingVariable&&"yes"),ec=(0,g.useMemo)(()=>{let e=new Set;for(let t of en){let n=I.some(e=>{var n;let l=null!==(n=null==G?void 0:G[e.name])&&void 0!==n?n:"",a="".concat(eT.ye,".").concat(t.name);return e.name===t.name&&(0,a$.containsDirectReference)(l,a)});n&&e.add(t)}return e},[en,G,I]),ed=e=>"${{".concat(eT.ye,".").concat(e,"}}"),eu=async e=>{let{name:t}=e;await M({name:t,value:ed(t)})},em=async e=>{let{name:t,value:n}=e;if(("Port"===t||"port"==t)&&await m({title:"Did you mean PORT?",description:"Railway looks for the PORT variable name in all caps. Did you mean to add a PORT variable to the service?",confirmButtonText:"Yep, change it to PORT",cancelButtonText:"No, leave it as is",confirmButtonColor:"pink"}))return eo(!1),M({name:"PORT",value:n});eo(!1),await M({name:t,value:n})},eh=async e=>{e.stopPropagation(),await O(en.filter(e=>!ec.has(e)).map(e=>({name:e.name,value:ed(e.name)})))},ev=async e=>{let{name:t,environmentId:n}=e,l=await N({name:t,environmentId:n});await M({name:t,value:l})},[{user:ep}]=(0,V.aF)(),eg=(0,g.useMemo)(()=>{let e=f.filter(e=>null!=e.serviceId&&e.serviceId===r||null!=e.pluginId||null==e.serviceId&&(null==o?void 0:o.plugins.some(t=>t.id===e.pluginId))),t=[...e,...en],n=e=>(0,a7.P)(e)?3:null!=e.pluginId?2:1;return t.sort((e,t)=>{let l=n(e),a=n(t);return a!==l?l-a:e.name.localeCompare(t.name)}),t},[f]),{autocompleteOptions:ej,nameAutocompleteOptions:ef}=(0,g.useMemo)(()=>{let e=[],t=[];for(let a of eg){let r,s,i;if((0,a7.P)(a))r=eT.ye,s=U.TH;else if(null!=a.pluginId){var n,l;let e=null==o?void 0:null===(n=o.plugins)||void 0===n?void 0:n.find(e=>e.id===a.pluginId);if(null==e)continue;r=e.friendlyName,s=null===(l=j.Hh[e.name])||void 0===l?void 0:l.icon,i=e.friendlyName}else s=U._w;let c=(0,a$.buildTemplateTag)({variableName:a.name,namespace:r}),d={icon:s,value:c,numMatchStart:1,numMatchStop:1};e.push(d),s!==U._w&&t.push({hint:i,icon:s,valueOption:d,value:a.name,numMatchStart:0,numMatchStop:1})}return{autocompleteOptions:e,nameAutocompleteOptions:t}},[eg]),[ey,eb]=(0,g.useState)(!1),{modalActions:ew}=(0,F.o)(),eN=()=>{null!=G&&ew.openModal((0,d.jsx)(H.u_,{title:"Raw Environment Variable Editor",className:"md:min-w-[640px]",children:(0,d.jsx)(rl.u,{variables:G,setVariables:async e=>{eb(!0),k(Object.keys(e)),await Q({variables:e}),eb(!1)}})}))};return p?(0,d.jsx)(er.bJ,{}):(null==o||o.plugins,(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(Z.g,{space:5,className:"variables",children:[null!=r&&(0,d.jsx)(nA.Ik,{children:(0,d.jsxs)(Z.g,{className:"border-b border-gray-100",children:[ei?(0,d.jsx)(re.h,{hideAutocompleteHint:!0,forceAutocomplete:"yesAndForceAutocomplete"===ei,onCancel:()=>eo(!1),nameAutocompleteOptions:ef,autocompleteOptions:ej,onAddVariable:em,checkConflict:e=>{var t;return(null===(t=eg.find(t=>t.name===e))||void 0===t?void 0:t.serviceId)===r}}):(0,d.jsxs)(Z.U,{align:"center",children:[(0,d.jsxs)("div",{className:"font-medium",children:[I.length>0?I.length:"No"," ",(0,J._6)("Service Variable",I.length)]}),(0,d.jsxs)(Z.U,{align:"center",space:1,className:"ml-auto",children:[(0,d.jsx)(q.zx,{size:"sm",variant:y?"outline":"ghost",name:"Insert Shared Variable",icon:y?U.Kh:U.PT,isLoading:ey,"aria-controls":"shared variables","aria-expanded":!!y&&"true",onClick:()=>{x({action:y?"Close":"Open",object:"Service Shared Variables"}),b(!y)},children:(0,d.jsx)("span",{className:"text-gray-600",children:y?"Close Shared Variables":"Shared Variable"})}),(0,d.jsx)(q.zx,{size:"sm",variant:"ghost",name:"Raw Service Variable Editor",icon:U._w,onClick:eN,isLoading:ey,className:"hidden md:flex",children:(0,d.jsx)("span",{className:"text-gray-600",children:"RAW Editor"})}),(0,d.jsx)(q.zx,{size:"sm",name:"New Service Variable",variant:"outline",icon:U.v3,onClick:()=>eo("yes"),className:"new-variable",children:"New Variable"})]})]}),(0,d.jsx)(Z.g,{className:"mt-3",children:(0,d.jsx)(a9.h,{isOpen:y,children:0===en.length?(0,d.jsx)(ro,{onClose:()=>b(!1)}):(0,d.jsxs)("div",{className:"rounded-md dark:bg-gray-100 bg-secondaryBg my-4",children:[(0,d.jsxs)(Z.U,{align:"center",className:"mx-4 py-3 border-b border-gray-100 dark:border-gray-200",children:[(0,d.jsxs)(es.$2,{children:[ec.size," of"," ",en.length," shared variables in use"]}),(0,d.jsx)("span",{"aria-hidden":!0,className:"mx-1",children:"\xb7"}),(0,d.jsx)(et.r,{...c.projectSharedVariables({}),children:(0,d.jsx)(es.Zb,{className:"underline",children:"Edit Shared Variables"})}),(0,d.jsxs)(Z.U,{space:1,className:"ml-auto -mr-2",children:[(0,d.jsx)(q.zx,{onClick:eh,variant:"ghost",size:"sm",disabled:ec.size===en.length,className:"text-sm whitespace-nowrap",children:"Add All"}),(0,d.jsx)(q.hU,{icon:U.X,onClick:()=>b(!1),title:"Close Shared Variables"})]})]}),(0,d.jsx)(Z.g,{className:"py-2",children:en.map(e=>{var t;let n=ec.has(e);return(0,d.jsx)(eP.$,{name:e.name,componentLeft:(0,d.jsx)(ee.JO,{icon:n?U.Jr:U.TH,className:"text-gray-500"}),value:null!==(t=(null!=$?$:{})[e.name])&&void 0!==t?t:null,onAdd:n?"added":eu},e.name)})})]})})})]})}),(0,d.jsxs)("div",{children:[el&&(0,d.jsxs)(W.j,{icon:U.RY,size:"sm",className:"py-1 mb-4 flex items-center",children:[(0,d.jsxs)("p",{children:["Looking to connect a database? Add a"," ",(0,d.jsx)(q.Qj,{variant:"underline",onClick:()=>{eo("yesAndForceAutocomplete"),setTimeout(()=>eo("yes"),0)},children:"Variable Reference"})]}),(0,d.jsx)(q.hU,{iconStyles:"!text-gray-400",title:"Dismiss",icon:U.X,onClick:ea,className:"ml-auto -mr-2"})]}),0===I.length?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(ri,{onOpenBulkImport:eN}),D&&null!=R&&Object.keys(R).length>0&&Object.keys(R).length<=10&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(Y.i,{className:"my-8"}),(0,d.jsx)(ra,{suggestedVariables:R,onAddVariables:e=>z({variables:e}),hideSuggestedVariables:E})]})]}):I.map(e=>{var t;let n=null!==(t=(null!=G?G:{})[e.name])&&void 0!==t?t:null,l=(0,a$.findDirectNamespaceReference)(null!=n?n:""),a=l===eT.ye,r=null==o?void 0:o.plugins.find(e=>e.friendlyName===l),i=null!=r?j.Hh[r.name].icon:a?U.TH:null;return(0,d.jsx)(eP.$,{name:e.name,value:n,autocompleteOptions:ej,componentLeft:i&&(0,d.jsx)(ee.JO,{icon:i,className:"text-gray-500"}),...s?{onEdit:M,onDelete:B,onPromoteToShared:a?void 0:e=>{let{name:t}=e;return K({name:t,value:n})}}:{},className:"rounded"},e.name)})]})]}),s&&Object.keys(w).length>0&&(0,d.jsxs)("div",{className:"mt-8 phantom-variables",children:[(0,d.jsxs)(Z.U,{align:"center",space:3,children:[(0,d.jsx)(ee.JO,{icon:U.yr,size:"sm",className:"text-gray-600"}),(0,d.jsxs)(es.nq,{children:[Object.keys(w).length," ",(0,J._6)("Variable",Object.keys(w).length)," are included in other environments but missing in this one."]})]}),(0,d.jsx)(Y.i,{className:"mt-6 mb-3"}),Object.entries(w).map(e=>{let[t,n]=e;return(0,d.jsx)(rn,{name:t,values:n,addVariable:ev},t)})]})]}))},ri=e=>{let{onOpenBulkImport:t}=e;return(0,d.jsxs)(Z.g,{space:1,justify:"center",className:"text-center py-14 rounded-lg border border-dashed border-gray-200",children:[(0,d.jsx)(es.Zb,{className:"leading-6 font-semibold",children:"No Environment Variables"}),(0,d.jsx)(nA.Ik,{children:(0,d.jsxs)(es.Zb,{className:"leading-5 text-gray-500 max-w-lg mx-auto",children:["Import all your variables using the"," ",(0,d.jsx)(q.Qj,{variant:"underline",onClick:t,children:"Raw Editor"})]})})]})},ro=e=>{let{onClose:t}=e,{routes:n}=(0,P.H)(),{colorMode:l}=(0,a8.Fg)();return(0,d.jsxs)("div",{className:"relative rounded-md dark:bg-gray-50 bg-secondaryBg px-8 md:px-12 my-4 background-image[url(/illustrations/shared-variables-blurred-blob.svg)] bg-left-bottom bg-no-repeat",children:[(0,d.jsx)(q.hU,{icon:U.X,title:"Close",onClick:t,iconStyles:"!text-gray-500",className:"absolute right-3 top-3"}),(0,d.jsxs)(Z.U,{justify:"center",align:"center",className:"mx-auto flex-wrap",children:[(0,d.jsx)("div",{className:"my-8 min-w-full md:min-w-0 md:mr-10 text-center",children:(0,d.jsx)(aX(),{src:"light"===l?"/illustrations/shared-variables-light.svg":"/illustrations/shared-variables-dark.svg",alt:"graph of shared variable pointed to multiple services",width:190,height:146})}),(0,d.jsxs)(Z.g,{space:2,className:"max-w-xl mb-8 md:mt-8 flex-1",children:[(0,d.jsx)(es.$2,{className:"font-semibold",children:"Keep variables in sync across services"}),(0,d.jsxs)(es.Zb,{children:["Create a shared variable in"," ",(0,d.jsx)(et.r,{...n.projectSharedVariables({}),variant:"underline",children:"Project Settings"})," ","or promote an existing service variable to a shared variable via the"," ",(0,d.jsx)(es.ZM,{children:"â‹®"})," icon."]}),(0,d.jsxs)(Z.U,{className:"pt-2 flex-wrap",children:[(0,d.jsx)(nA.Ik,{children:(0,d.jsx)(q.ZP,{variant:"primary",color:"pink",size:"sm",...n.projectSharedVariables({}),className:"w-full md:w-auto",children:"Configure Shared Variables"})}),(0,d.jsx)(q.ZP,{variant:"outline",color:"pink",size:"sm",...n.docs({page:"develop/variables#shared-variables"}),className:"my-3 md:my-0 md:ml-3 w-full md:w-auto",children:"View Docs"})]})]})]})]})};var rc=n(42580),rd=n(28813),ru=n(34262),rm=n(63686),rx=n(58317);let rh=e=>{var t,n,l,a,r,s,i,o,c,u,m;let{service:x,serviceInstance:h,environment:v,permissions:p,className:j}=e,[{user:f,isBeta:y}]=(0,V.aF)(),{routes:b}=(0,P.H)(),{updateWatchPatterns:w,updateBuildCommand:N}=(0,rd.r)(h.serviceId),C=(0,g.useMemo)(()=>x.deployments.filter(e=>e.serviceId===x.id)[0],[x.deployments]),{serviceManifestWithInfo:S,latestManifest:k}=(0,ru.$)({deployment:C,serviceInstance:h}),I=(0,rc.M)({serviceInstance:h,environment:v,path:null===(t=S.build.nixpacksConfigPath)||void 0===t?void 0:t.value}),D=(0,g.useMemo)(()=>null!==(o=null==C?void 0:C.meta)&&void 0!==o?o:{},[C]),A=(0,g.useMemo)(()=>{var e,t,n,l;if(null==C)return!1;let a=null!==(l=null!==(n=null==D?void 0:null===(e=D.serviceManifest)||void 0===e?void 0:null===(t=e.build)||void 0===t?void 0:t.builder)&&void 0!==n?n:D.builder)&&void 0!==l?l:"";return"dockerfile"===a.toLowerCase()},[C,D]);return(0,d.jsxs)(th.Jh,{title:"Build",className:j,children:[(0,d.jsx)(rp,{serviceInstance:h,sm:S,isLatestDeployDockerfile:A,permissions:p}),(0,d.jsxs)(a9.h,{isOpen:S.build.builder.value===ty.IbL.Nixpacks&&!A,className:"space-y-8",children:[(null===(n=k.build)||void 0===n?void 0:n.nixpacksConfigPath)!=null&&(0,d.jsxs)(th.jK,{className:"grid items-center gap-3 grid-cols-[auto_1fr_auto] text-sm text-gray-600 bg-pink-50 rounded p-3",children:[(0,d.jsx)(ee.JO,{icon:U.EK,className:"!text-gray-500"}),(0,d.jsxs)("div",{children:["Using the"," ",(0,d.jsx)(es.MZ,{children:k.build.nixpacksConfigPath})," ","config file in your code."]}),null!=I&&(0,d.jsx)(et.r,{variant:"coloured",href:I,className:"text-sm whitespace-nowrap",children:"Edit in GitHub â†—"})]}),(0,d.jsxs)(th.jK,{children:[(0,d.jsx)(th.oC,{children:"Build Command"}),(0,d.jsxs)(th.v9,{children:["Override the default build command that is run when building your app."," ",(0,d.jsxs)(et.r,{external:!0,variant:"highlight",...b.docs({page:"/deploy/builds#build-command"}),children:[(0,d.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,d.jsx)(U.pr,{})]})]}),(0,d.jsx)(th.NZ,{field:S.build.buildCommand,children:(0,d.jsx)(tg,{value:null!==(c=null===(l=S.build.buildCommand)||void 0===l?void 0:l.value)&&void 0!==c?c:"",label:{text:"Build command",hidden:!0},readOnly:!p.Write||(null===(a=S.build.buildCommand)||void 0===a?void 0:a.path)!=null,placeholder:"yarn run build",onChange:e=>N(e.trim())})})]}),((null==f?void 0:f.isAdmin)||y)&&(0,d.jsx)(th.NZ,{field:S.build.nixpacksPlan,children:(0,d.jsx)(th.jK,{children:(0,d.jsx)(rx.N,{hasDeployment:null!=C,serviceId:h.serviceId,matchedProviders:null!==(u=D.nixpacksProviders)&&void 0!==u?u:[],customPlan:null!==(m=null===(r=S.build.nixpacksPlan)||void 0===r?void 0:r.value)&&void 0!==m?m:{},nixpacksConfigFile:null===(s=D.serviceManifest)||void 0===s?void 0:null===(i=s.build)||void 0===i?void 0:i.nixpacksConfigPath})})})]}),(0,d.jsxs)(th.jK,{children:[(0,d.jsx)(th.oC,{children:"Watch Paths"}),(0,d.jsxs)(th.v9,{children:["Gitignore-style rules to trigger a new deployment based on what file paths have changed."," ",(0,d.jsxs)(et.r,{external:!0,variant:"highlight",...b.docs({page:"/deploy/builds#watch-paths"}),children:[(0,d.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,d.jsx)(U.pr,{})]})]}),(0,d.jsx)(th.NZ,{field:S.build.watchPatterns,children:(0,d.jsx)(tg,{textarea:!0,value:h.watchPatterns.join("\n"),readOnly:!p.Write||null!=S.build.watchPatterns.path,label:{text:"Watch patterns",hidden:!0},placeholder:(null==h?void 0:h.rootDirectory)?"".concat(h.rootDirectory,"/src/**"):"src/**",onChange:e=>w(e),className:"min-h-[2.8rem] max-h-[22rem]"})})]})]})},rv={NIXPACKS:{name:"Nixpacks",description:"Developed by Railway and based on Nix.",link:"https://nixpacks.com",badge:(0,d.jsx)(rm.m8,{}),selectable:!0},HEROKU:{name:"Heroku Buildpacks",description:"Heroku-20 Cloudnative buildpacks.",link:"https://devcenter.heroku.com/articles/heroku-20-stack",badge:(0,d.jsx)(rm.FW,{}),selectable:!1},PAKETO:{name:"Paketo Buildpacks",description:"Newer collection of Cloudnative buildpacks.",link:"https://paketo.io/",badge:(0,d.jsx)(rm.FW,{}),selectable:!1},DOCKERFILE:{name:"Dockerfile",description:"Build with a Dockerfile using BuildKit.",link:"https://docs.docker.com/engine/reference/builder/",badge:null}},rp=e=>{var t,n;let{serviceInstance:l,sm:a,isLatestDeployDockerfile:r}=e,{setServiceBuilder:s}=(0,rd.r)(l.serviceId),[i,o]=(0,g.useState)(!1),c=(0,g.useMemo)(()=>r?"DOCKERFILE":a.build.builder.value,[r,a.build.builder.value,i]),u=(0,g.useMemo)(()=>null!==(n=rv[c])&&void 0!==n?n:rv.NIXPACKS,[c]);return(0,d.jsxs)(th.jK,{children:[(0,d.jsx)(th.oC,{className:"text-base",children:"Builder"}),(0,d.jsx)(th.NZ,{field:a.build.builder,children:(0,d.jsxs)("div",{className:"flex items-center w-full space-x-8 px-6 py-4 bg-secondaryBg dark:bg-gray-100 rounded-md",children:[(0,d.jsxs)(Z.g,{space:1.5,className:"w-full",children:[(0,d.jsxs)(Z.U,{space:2,align:"center",children:[(0,d.jsx)(es.xv,{children:u.name}),r?(0,d.jsx)(d.Fragment,{children:(null===(t=a.build.dockerfilePath)||void 0===t?void 0:t.path)!=null?(0,d.jsx)(rm.ej,{className:"text-blue-500 bg-blue-100 font-medium",children:a.build.dockerfilePath.value}):(0,d.jsx)(rm.y2,{})}):(0,d.jsx)(d.Fragment,{children:u.badge})]}),(0,d.jsxs)(es.Ew,{children:[u.description," ",(0,d.jsxs)(et.r,{href:u.link,external:!0,variant:"highlight",children:[(0,d.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,d.jsx)(U.pr,{})]})]})]}),!r&&("HEROKU"===c||"PAKETO"===c)&&(0,d.jsxs)(aU.Lt,{children:[null==a.build.builder.path&&(0,d.jsx)(aU.WA,{className:(0,_.AK)("builder-selection-dropdown","bg-transparent border-pink-200 text-pink-700 dark:text-white hover:bg-pink-100 hover:border-pink-200","h-sm py-1.5 px-3 rounded-md text-sm leading-5 space-x-2"),children:"Change"}),(0,d.jsx)(aU.Nv,{align:"end",className:"max-w-[400px]",children:Object.entries(rv).filter(e=>{let[t,n]=e;return n.selectable&&t!==c}).map(e=>{let[t,n]=e;return(0,d.jsx)(aU.hP,{onSelect:()=>{s(t),o(!1)},className:"h-auto",children:(0,d.jsxs)(Z.g,{space:1.5,className:"py-2",children:[(0,d.jsxs)(Z.U,{space:2,align:"center",children:[(0,d.jsx)(es.xv,{children:n.name}),n.badge]}),(0,d.jsx)(es.Ew,{children:n.description})]})},t)})})]})]})})]})},rg=e=>{let{service:t}=e,[,n]=(0,T.PY)(),{navActions:l,routes:a}=(0,P.H)(),{confirm:r}=(0,eQ.p)(),s=async()=>{await r({title:"Delete Service",description:"Are you sure you want to delete this service. All deployments will be removed forever.",requireConfirmationText:t.name,confirmButtonText:"Delete"})&&(l.push(a.project({})),await n.deleteService(t.id))};return(0,d.jsx)(nA.v9,{children:(0,d.jsx)(th.Jh,{title:"Danger",danger:!0,children:(0,d.jsxs)(th.jK,{children:[(0,d.jsx)(th.oC,{className:"text-red-500",children:"Delete Service"}),(0,d.jsx)(W.j,{variant:"danger",children:(0,d.jsxs)(es.xv,{children:["Deleting this service will"," ",(0,d.jsx)("b",{className:"font-semibold",children:"permanently delete"})," all its deployments and remove it from"," ",(0,d.jsx)("b",{className:"font-semibold",children:"all environments"}),". This cannot be undone."]})}),(0,d.jsx)(q.zx,{color:"red",size:"sm",onClick:()=>s(),className:"max-w-max mt-6 font-bold",children:"Delete Service from All Environments"})]})})})};var rj=n(45458);let rf=e=>{var t,n,l,a,r,s,i,o,c,u,m,x,h,v,p,j,f,y;let{service:b,serviceInstance:w,permissions:N,className:C}=e,{updateStartCommand:S,updateHealthcheck:k,updateHealthcheckTimeout:I,updateServiceRestartPolicyMaxRetries:D,updateServiceRestartPolicyType:A}=(0,rd.r)(w.serviceId),{routes:E}=(0,P.H)(),T=(0,g.useMemo)(()=>b.deployments.filter(e=>e.serviceId===b.id)[0],[b.deployments]),{serviceManifestWithInfo:R}=(0,ru.$)({deployment:T,serviceInstance:w});return(0,d.jsxs)(th.Jh,{title:"Deploy",className:C,children:[(0,d.jsxs)(th.jK,{children:[(0,d.jsx)(th.oC,{children:"Start Command"}),(0,d.jsxs)(th.v9,{children:["Command that will be run to start new deployments."," ",(0,d.jsxs)(et.r,{external:!0,variant:"highlight",...E.docs({page:"/deploy/deployments#start-command"}),children:[(0,d.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,d.jsx)(U.pr,{})]})]}),(0,d.jsx)(th.NZ,{field:R.deploy.startCommand,children:(0,d.jsx)(tg,{label:{text:"Start command",hidden:!0},value:null!==(v=null===(t=R.deploy.startCommand)||void 0===t?void 0:t.value)&&void 0!==v?v:"",readOnly:!N.Write||(null===(n=R.deploy.startCommand)||void 0===n?void 0:n.path)!=null,onChange:e=>S(e.trim())})})]}),(0,d.jsxs)(th.jK,{children:[(0,d.jsx)(th.oC,{children:"Healthcheck Path"}),(0,d.jsxs)(th.v9,{children:["Endpoint to be called before a deploy completes to ensure the new deployment is live."," ",(0,d.jsxs)(et.r,{external:!0,variant:"highlight",...E.docs({page:"/deploy/healthchecks"}),children:[(0,d.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,d.jsx)(U.pr,{})]})]}),(0,d.jsx)(th.NZ,{field:R.deploy.healthcheckPath,children:(0,d.jsx)(tg,{label:{text:"Healthcheck Path",hidden:!0},value:null!==(p=null===(l=R.deploy.healthcheckPath)||void 0===l?void 0:l.value)&&void 0!==p?p:"",readOnly:!N.Write||(null===(a=R.deploy.healthcheckPath)||void 0===a?void 0:a.path)!=null,onChange:e=>k(e.trim())})})]}),(0,d.jsxs)(th.jK,{children:[(0,d.jsx)(th.oC,{children:"Healthcheck Timeout"}),(0,d.jsxs)(th.v9,{children:["Number of seconds we will wait for the healthcheck to complete."," ",(0,d.jsxs)(et.r,{external:!0,variant:"highlight",...E.docs({page:"/deploy/healthchecks#timeout"}),children:[(0,d.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,d.jsx)(U.pr,{})]})]}),(0,d.jsx)(th.NZ,{field:R.deploy.healthcheckTimeout,children:(0,d.jsx)(tg,{type:"number",placeholder:"300",label:{text:"Healthcheck Timeout",hidden:!0},value:null!==(j=null===(r=R.deploy.healthcheckTimeout)||void 0===r?void 0:null===(s=r.value)||void 0===s?void 0:s.toString())&&void 0!==j?j:"",validate:e=>null==e||(0,B.validateHealthcheckTimeout)(parseInt(e)),readOnly:!N.Write||(null===(i=R.deploy.healthcheckTimeout)||void 0===i?void 0:i.path)!=null,onChange:e=>I(""!==e?parseInt(e.trim()):null)})})]}),(0,d.jsxs)(th.jK,{children:[(0,d.jsx)(th.oC,{children:"Restart Policy"}),(0,d.jsx)(th.NZ,{field:R.deploy.restartPolicyType,children:(0,d.jsx)(eJ.l0,{className:"relative p-1 border border-gray-100 rounded",children:(0,d.jsxs)(rj.Ee,{value:null!==(f=null===(o=R.deploy.restartPolicyType)||void 0===o?void 0:o.value)&&void 0!==f?f:"ON_FAILURE","aria-label":"On Failure",onValueChange:e=>A(e),children:[(0,d.jsxs)(ry,{selected:R.deploy.restartPolicyType.value===ty.or2.OnFailure,value:ty.or2.OnFailure,disabled:!N.Write||(null===(c=R.deploy.restartPolicyType)||void 0===c?void 0:c.path)!=null,children:[(0,d.jsxs)(Z.U,{space:2,align:"center",children:[(0,d.jsx)(es.xv,{children:"On Failure"}),(0,d.jsx)(rm.m8,{})]}),(0,d.jsxs)(es.Ew,{className:"font-normal",children:["Restart the service if it stopped due to an error."," ",(0,d.jsxs)(et.r,{...E.docs({page:"/deploy/deployments#configurable-restart-policy"}),variant:"highlight",external:!0,children:[(0,d.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,d.jsx)(U.pr,{})]})]})]}),(0,d.jsx)(Y.i,{className:"my-1 -mx-1 w-auto"}),(0,d.jsxs)(ry,{selected:R.deploy.restartPolicyType.value===ty.or2.Always,value:ty.or2.Always,disabled:!N.Write||(null===(u=R.deploy.restartPolicyType)||void 0===u?void 0:u.path)!=null,children:[(0,d.jsx)(es.xv,{children:"Always"}),(0,d.jsxs)(es.Ew,{className:"font-normal",children:["Always restart the service if it stopped for any reason."," ",(0,d.jsxs)(et.r,{...E.docs({page:"/deploy/deployments#configurable-restart-policy"}),variant:"highlight",external:!0,children:[(0,d.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,d.jsx)(U.pr,{})]})]})]}),(0,d.jsx)(Y.i,{className:"my-1 -mx-1 w-auto"}),(0,d.jsxs)(ry,{selected:R.deploy.restartPolicyType.value===ty.or2.Never,value:ty.or2.Never,disabled:!N.Write||(null===(m=R.deploy.restartPolicyType)||void 0===m?void 0:m.path)!=null,children:[(0,d.jsx)(es.xv,{children:"Never"}),(0,d.jsxs)(es.Ew,{className:"font-normal",children:["Do not automatically restart the service."," ",(0,d.jsxs)(et.r,{...E.docs({page:"/deploy/deployments#configurable-restart-policy"}),variant:"highlight",external:!0,children:[(0,d.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,d.jsx)(U.pr,{})]})]})]})]})})})]}),(0,d.jsx)(a9.h,{isOpen:w.restartPolicyType===ty.or2.OnFailure,children:(0,d.jsxs)(th.jK,{children:[(0,d.jsx)(th.oC,{children:"On-Failure Restart Policy Max Retry"}),(0,d.jsx)(th.v9,{children:"Number of times to try and restart the service if it stopped due to an error."}),(0,d.jsx)(th.NZ,{field:R.deploy.restartPolicyMaxRetries,children:(0,d.jsx)(tg,{type:"number",label:{text:"Max restart retries",hidden:!0},value:(null!==(y=null===(x=R.deploy.restartPolicyMaxRetries)||void 0===x?void 0:x.value)&&void 0!==y?y:0).toString(),readOnly:!N.Write||(null===(h=R.deploy.restartPolicyMaxRetries)||void 0===h?void 0:h.path)!=null,onChange:e=>D(parseInt(e))})})]})})]})},ry=e=>{let{value:t,selected:n,disabled:l,children:a}=e;return(0,d.jsxs)(Z.U,{align:"center",space:3,className:(0,_.AK)("group","px-4 py-2 rounded-lg",n?"bg-pink-50":"hover:bg-gray-50"),children:[(0,d.jsx)(rj.Wr,{value:t,id:t,disabled:l,children:(0,d.jsx)(rj.Q4,{})}),(0,d.jsx)("label",{htmlFor:t,className:"space-y-1 cursor-pointer",children:a})]})};var rb=n(23170),rw=n(3953),rN=n(77323);(a=i||(i={})).Loading="loading",a.Available="available",a.InValid="invalid",a.NotAvailable="taken",(r=o||(o={})).Environment="environment",r.Custom="custom";let rC=(e,t,n)=>{var l;let{graphqlClient:a}=(0,M.S)(),r=(0,I.c)(e,200),s=(0,g.useMemo)(()=>{switch(n){case o.Environment:case o.Custom:return(0,eO.isValidDomain)(e);default:throw Error("Domain check not specified!")}},[e]),{result:c}=(0,R.o)(["domainAvailable",r,n],async()=>{switch(n){case o.Environment:return(await a.serviceDomainAvailable({domain:r})).serviceDomainAvailable;case o.Custom:return(await a.customDomainAvailable({domain:r})).customDomainAvailable;default:throw Error("Invalid Query Type for Domain")}},{enabled:s&&e!==t}),d=e!==r?null:null!==(l=c.data)&&void 0!==l?l:null;return e===t?{status:i.Available,message:"Domain Available!"}:s?null==d?{status:i.Loading,message:"Checking..."}:{status:d.available?i.Available:i.NotAvailable,message:d.message}:{status:i.InValid,message:"Malformed Domain"}};var rS=n(89524),rk=n(57846);let rI=e=>{let{id:t,options:n={}}=e;return["domainWithStatus",t]},rD=e=>{var t;let{id:n,options:l={}}=e,{graphqlClient:a}=(0,M.S)(),[{project:r}]=(0,T.PY)(),s=rI({id:n}),{result:i}=(0,R.o)(s,async()=>{var e;return(await a.domainStatus({id:n,projectId:null!==(e=null==r?void 0:r.id)&&void 0!==e?e:""})).domainStatus},{refetchInterval:null!==(t=l.reFetchInterval)&&void 0!==t&&t});return{domain:i,isError:!1,isLoading:!1}},rA=e=>{let{domain:t}=e,{domain:n}=rD({id:t.id}),{id:l}=(0,H.Lf)(),{modalActions:a}=(0,F.o)(),r=()=>a.exitModal(l),{routes:s}=(0,P.H)(),i=(e,t)=>(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(es.xv,{className:"my-6 overflow-hidden overflow-ellipsis",children:["To finish setting up your custom domain, add the following DNS records to"," ",(0,d.jsx)(et.r,{variant:"coloured",href:"https://".concat(e),children:e})]}),(0,d.jsx)(tq.Lg,{className:"overflow-x-auto",children:(0,d.jsx)(tq.iA,{children:(0,d.jsxs)(tq.XP,{showRowBorder:!0,children:[(0,d.jsxs)(tq.X2,{unSelectable:!0,children:[(0,d.jsx)(tq.f4,{className:"text-xs text-gray-600",children:"Type"}),(0,d.jsx)(tq.f4,{className:"text-xs text-gray-600",children:"Name"}),(0,d.jsx)(tq.f4,{className:"text-xs text-gray-600",children:"Value"})]}),t.map((e,t)=>(0,d.jsxs)(tq.X2,{unSelectable:!0,children:[(0,d.jsx)(tq.f4,{className:"text-sm font-mono",children:e.recordType.split("_").at(-1)}),(0,d.jsx)(tq.f4,{className:"text-sm font-mono",children:e.hostlabel?e.hostlabel:"@"}),(0,d.jsxs)(tq.f4,{className:"text-sm flex items-center font-mono relative",children:[(0,d.jsx)("span",{className:"overflow-hidden overflow-ellipsis max-w-full min-w-0 mr-8",children:e.requiredValue}),(0,d.jsx)(q.qi,{text:e.requiredValue.trim(),className:"text-blue-600 bg-background absolute right-3"})]})]},t))]})})})]});return(0,d.jsxs)(H.u_,{title:"Create a DNS Record",modalStyles:"p-6 md:w-auto md:!max-w-[700px]",children:[(0,d.jsxs)(Z.U,{align:"center",justify:"between",space:2,children:[(0,d.jsx)(H.r6,{children:"Create a DNS Record"}),(0,d.jsx)(q.hU,{icon:U.X,title:"Close",onClick:r})]}),n.isLoading?(0,d.jsx)("div",{children:"Loading"}):(e=>{let t=e.domain;if(!t)return null;let n=e.dnsRecords.reduce((e,t)=>(e[t.zone]?e[t.zone].push(t):e[t.zone]=[t],e),{});return(0,d.jsxs)(d.Fragment,{children:[Object.entries(n).map(e=>{let[t,n]=e;return i(t,n)}),(0,d.jsxs)(es.Zb,{className:"my-6",children:["*"," DNS changes can take up to 72 hours to propagate worldwide"]}),(0,d.jsxs)(Z.U,{align:"center",justify:"between",children:[(0,d.jsx)(q.ZP,{size:"sm",color:"gray",variant:"outline",...s.docs({page:"deploy/exposing-your-app#add-a-custom-domain"}),children:"Visit the Docs"}),(0,d.jsx)(q.zx,{size:"sm",onClick:r,children:"Dismiss"})]})," "]})})(n.data)]})},rE=e=>null!==(c=null==e?void 0:e.domain.replace(".".concat(null==e?void 0:e.suffix),""))&&void 0!==c?c:"",rP=(e,t)=>"".concat(e,".").concat(t),rT=e=>{var t,n,l,a,r,s,i,o;let{environment:c,serviceInstance:u}=e,m=(0,aM.ms)(),{routes:x}=(0,P.H)(),[{domains:h},v]=(0,rS.J)({projectId:c.projectId,environmentId:c.id,serviceId:u.serviceId,options:{reFetchInterval:1e4}}),p=h.data?h.data.serviceDomains[0]:null,[j,f]=(0,g.useState)(!1),[y,b]=(0,g.useState)(!1),[{suggestAddServiceDomain:w}]=(0,rk.$)({serviceId:u.serviceId,environmentId:c.id}),[{permissions:N}]=(0,T.PY)(),{modalActions:C}=(0,F.o)(),{confirm:S}=(0,eQ.p)(),k=e=>{C.createToast((0,d.jsx)(tr.FN,{icon:U.uy,title:"Add custom domain",description:e,actionTitle:"Upgrade plan",href:x.accountBilling({}).url}))},I=async()=>{try{b(!0),await v.createServiceDomain({})}catch(e){C.createToast((0,d.jsx)(tr.FN,{variant:"error",title:"Error adding service domain",description:e.message}))}finally{b(!1)}},D=async e=>{try{await v.updateServiceDomain({domain:e})}catch(e){C.createToast((0,d.jsx)(tr.FN,{variant:"error",title:"Error adding custom domain",description:e.message}))}},A=async e=>{let t=await S({title:"Remove Service Domain",description:"Are you sure you want to remove the primary service domain?",confirmButtonText:"Delete"});if(t)try{await v.deleteServiceDomain({id:e.id})}catch(e){C.createToast((0,d.jsx)(tr.FN,{variant:"error",title:"Error adding custom domain",description:e.message}))}},E=async e=>{if(!m.allowed){k(m.message);return}try{let t=await v.createCustomDomain({domain:e});f(!1),null!=p&&C.openModal((0,d.jsx)(rA,{domain:t}))}catch(e){C.createToast((0,d.jsx)(tr.FN,{variant:"error",title:"Error adding custom domain",description:e.message}))}},R=async e=>{let t=await S({title:"Remove Custom Domain",description:(0,d.jsxs)(d.Fragment,{children:["Are you sure you want to remove the custom domain"," ",(0,d.jsx)("strong",{children:e.domain}),"?"]}),confirmButtonText:"Delete"});if(t)try{await v.deleteCustomDomain(e.id)}catch(e){C.createToast((0,d.jsx)(tr.FN,{variant:"error",title:"Error removing custom domain",description:e.message}))}};return(0,d.jsxs)(th.jK,{children:[(0,d.jsx)(th.oC,{children:"Domains"}),w?(0,d.jsx)(W.j,{variant:"primary",size:"sm",icon:U.Y8,className:"mb-3",children:(0,d.jsxs)("p",{children:["This service is listening on ",(0,d.jsx)(es.ZM,{children:"PORT"})," but does not yet have a domain. ",(0,d.jsx)("br",{}),"Add a domain to expose it to the internet."]})}):(0,d.jsx)(th.v9,{children:"Expose this service to the public internet."}),(0,d.jsxs)(Z.g,{space:4,children:[((null!==(r=null===(t=h.data)||void 0===t?void 0:t.serviceDomains)&&void 0!==r?r:[]).length>0||(null!==(s=null===(n=h.data)||void 0===n?void 0:n.customDomains)&&void 0!==s?s:[]).length>0)&&(0,d.jsxs)("div",{className:"py-1 border border-gray-200 rounded-lg divide-y divide-gray-200",children:[(null!==(i=null===(l=h.data)||void 0===l?void 0:l.serviceDomains)&&void 0!==i?i:[]).map(e=>(0,d.jsx)(rO,{serviceDomain:e,onSetDomain:D,onDeleteDomain:A},e.id)),(null!==(o=null===(a=h.data)||void 0===a?void 0:a.customDomains)&&void 0!==o?o:[]).map(e=>(0,d.jsx)(rR,{customDomain:e,onRemoveCustomDomain:R},e.id))]}),j?(0,d.jsx)(rM,{onAddDomain:E,onCancel:()=>f(!1)}):(0,d.jsxs)(Z.U,{space:2,children:[null==p&&(0,d.jsx)(q.zx,{variant:"outline",size:"sm",icon:U.it,disabled:!N.Write||y,onClick:I,children:y?"Generating...":"Generate Domain"}),(0,d.jsx)(q.zx,{name:"Add Custom Domain",variant:"outline",size:"sm",icon:U.v3,disabled:!N.Write,onClick:()=>f(!0),children:"Custom Domain"})]})]})]})},rR=e=>{let{customDomain:t,onRemoveCustomDomain:n}=e,[{permissions:l}]=(0,T.PY)(),a=t.cnameCheck.status,{modalActions:r}=(0,F.o)(),s=(0,g.useMemo)(()=>({ERROR:(0,d.jsx)(ee.JO,{icon:U.IW,className:"!text-red-600"}),INFO:(0,d.jsx)(ee.JO,{icon:U.fU,className:"!text-green-600"}),INVALID:(0,d.jsx)(ee.JO,{icon:U.uy,className:"!text-yellow-700"}),VALID:(0,d.jsx)(ee.JO,{icon:U.fU,className:"!text-green-600"}),WAITING:(0,d.jsx)(ee.JO,{icon:U.SU,className:"!text-gray-600"})})[a],[a]),i=a!==ty.OcS.Info&&a!==ty.OcS.Valid,[o,c]=(0,lp.F)(),u=(0,aV.l)(t.domain);return(0,d.jsxs)("div",{className:"group flex items-center space-x-3 px-4 py-3 hover:bg-secondaryBg dark:hover:bg-gray-100",children:[s,(0,d.jsxs)(Z.g,{space:1,className:"flex-grow",children:[(0,d.jsxs)(Z.U,{align:"center",justify:"between",space:4,className:"relative w-full",children:[u?t.domain:(0,d.jsx)(et.Y,{href:"https://".concat(t.domain),children:t.domain}),(0,d.jsxs)(Z.U,{space:1,className:"ml-auto",children:[(0,d.jsx)(q.hU,{icon:o?U.Jr:U.CK,size:"xs",title:"Copy",type:"button",onClick:()=>c(t.domain),className:"rounded-md opacity-0 group-hover:opacity-100 hover:bg-gray-200"}),l.Write&&(0,d.jsx)(q.hU,{icon:U.Vh,title:"Delete",size:"xs",onClick:()=>n(t),className:"rounded-md opacity-0 group-hover:opacity-100 hover:bg-gray-200"})]})]}),(0,d.jsxs)(es.Ew,{children:[t.cnameCheck.message,"INVALID"===t.cnameCheck.status?"*":"",t.cnameCheck.link&&(0,d.jsxs)(d.Fragment,{children:[" ","(",(0,d.jsx)(et.r,{href:t.cnameCheck.link,variant:"underline",children:"docs"}),")"]}),i&&(0,d.jsxs)(d.Fragment,{children:[" \xb7 ",(0,d.jsx)(q.Qj,{variant:"coloured",onClick:()=>{r.openModal((0,d.jsx)(rA,{domain:t}))},children:"How to create a DNS record for this domain"})]})]})]})]})},rM=e=>{let{onAddDomain:t,onCancel:n}=e;return(0,d.jsxs)("div",{className:"p-4 rounded-lg bg-secondaryBg dark:bg-gray-100",children:[(0,d.jsx)(es.$2,{className:"mb-4 font-semibold",children:"Add Custom Domain"}),(0,d.jsx)(rL,{onSetDomain:t,onCancel:n,buttonText:"Add Domain"})]})},rO=e=>{let{serviceDomain:t,onSetDomain:n,onDeleteDomain:l}=e,[{permissions:a}]=(0,T.PY)(),[r,s]=(0,g.useState)(!1),i=async()=>{s(!0)},[o,c]=(0,lp.F)();return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:(0,_.AK)("group","flex items-center w-full","px-4 py-3",!r&&"hover:bg-secondaryBg dark:hover:bg-gray-100"),children:[(0,d.jsx)(ee.JO,{icon:U.TH,className:"!text-gray-500 mr-3"}),(0,d.jsx)(et.Y,{href:"https://".concat(t.domain),className:(0,_.AK)("flex-grow text-left",r&&"text-gray-500"),children:t.domain}),!r&&(0,d.jsxs)(Z.U,{space:1,className:"ml-auto",children:[(0,d.jsx)(q.hU,{icon:o?U.Jr:U.CK,size:"xs",title:"Copy",type:"button",onClick:()=>c(t.domain),className:"rounded-md opacity-0 group-hover:opacity-100 hover:bg-gray-200"}),a.Write&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(q.hU,{icon:U.I8,title:"Edit",size:"xs",type:"button",onClick:i,className:"rounded-md opacity-0 group-hover:opacity-100 hover:bg-gray-200"}),(0,d.jsx)(q.hU,{icon:U.Vh,size:"xs",title:"Delete",type:"button",onClick:()=>l(t),className:"rounded-md opacity-0 group-hover:opacity-100 hover:bg-gray-200"})]})]})]}),(0,d.jsx)(a9.h,{isOpen:r,children:(0,d.jsx)("div",{className:(0,_.AK)("p-4 space-y-4",!r&&"pointer-events-none"),children:(0,d.jsx)(rL,{domain:t,suffix:t.suffix,isServiceDomain:!0,onSetDomain:async e=>{await n(e),s(!1)},onCancel:()=>s(!1)})})})]})},rL=e=>{var t,n,l;let{domain:a,buttonText:r="Update",suffix:s,isServiceDomain:c,onSetDomain:u,onCancel:m}=e,x=(0,g.useMemo)(()=>c?rE(a):null!==(t=null==a?void 0:a.domain)&&void 0!==t?t:"",[a,c]),{register:h,handleSubmit:v,errors:p,watch:j}=(0,ta.cI)({defaultValues:{domain:x}}),f=j().domain,y=rC(c?rP(f,null!==(n=null==a?void 0:a.suffix)&&void 0!==n?n:""):f,null!==(l=null==a?void 0:a.domain)&&void 0!==l?l:"",c?o.Environment:o.Custom),[b,w]=(0,g.useState)(!1),N=async e=>{var t;let{domain:n}=e;w(!0),await u(c?rP(n,null!==(t=null==a?void 0:a.suffix)&&void 0!==t?t:""):n),w(!1)};return(0,d.jsxs)(eJ.l0,{onSubmit:v(N),enableBindings:!0,onCancel:m,children:[(0,d.jsxs)("div",{className:(0,_.AK)("flex items-center justify-between pr-4 mb-4 border border-gray-200 rounded-md","focus-within:border-pink-400"),children:[(0,d.jsx)(eW.II,{autoFocus:!0,name:"domain",label:{text:"Domain",hidden:!0},ref:h({required:!0}),error:null!=p.domain,className:"border-none pl-4"}),null!=s&&(0,d.jsxs)(es.xv,{className:"text-gray-500 whitespace-nowrap",children:[".",s]})]}),(0,d.jsxs)(Z.U,{align:"center",justify:"between",space:4,children:[""===f?(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)(Z.U,{space:3,align:"center",className:"text-gray-500",children:[(0,d.jsx)(ee.JO,{icon:U.kI}),(0,d.jsxs)(es.$2,{children:["Enter your ",c?"service":"custom"," Domain"]})]})}):(0,d.jsx)(rU,{...y}),(0,d.jsxs)(Z.U,{align:"center",space:2,children:[(0,d.jsx)(q.zx,{size:"sm",color:"gray",variant:"outline",type:"button",onClick:m,children:"Cancel"}),(0,d.jsx)(q.zx,{size:"sm",color:"pink",variant:"primary",isLoading:b,disabled:y.status!==i.Available,children:r})]})]})]})},rU=e=>{let{status:t}=e,n=(0,g.useMemo)(()=>({[i.Available]:"text-green-500",[i.Loading]:"text-gray-600",[i.InValid]:"text-red-500",[i.NotAvailable]:"text-red-500"})[t],[t]),l=(0,g.useMemo)(()=>({[i.Available]:(0,d.jsx)(ee.JO,{icon:U.Jr}),[i.Loading]:(0,d.jsx)(er.gb,{}),[i.InValid]:(0,d.jsx)(ee.JO,{icon:U.X}),[i.NotAvailable]:(0,d.jsx)(ee.JO,{icon:U.X})})[t],[t]),a=(0,g.useMemo)(()=>({[i.Available]:"Domain Available!",[i.Loading]:"Checking...",[i.InValid]:"Invalid Domain",[i.NotAvailable]:"Not Available"})[t],[t]);return(0,d.jsxs)(Z.U,{space:1.5,align:"center",className:n,children:[l,(0,d.jsx)(es.$2,{children:a})]})},rF=e=>{let{project:t,serviceInstance:n}=e,[{environment:l}]=(0,T.PY)();return null==l?null:(0,d.jsx)(th.rd,{children:(0,d.jsxs)("div",{className:th.DC,children:[(0,d.jsx)(rV,{projectId:t.id,serviceInstance:n}),(0,d.jsx)(rK,{serviceInstance:n,projectId:t.id,environment:l}),(0,d.jsx)(rT,{serviceInstance:n,environment:l}),!l.isEphemeral&&t.prDeploys&&(0,d.jsx)(rB,{project:t,environment:l,serviceInstance:n})]})})},rV=e=>{let{serviceInstance:t,projectId:n}=e,[{permissions:l}]=(0,T.PY)(),{modalActions:a}=(0,F.o)(),r=(0,ey.getRepoSource)(t.source),s=(0,rw.xA)({fullName:null==r?void 0:r.repo,enabled:l.Write}),{createServiceTrigger:i,updateServiceSourceBranch:o,removeServiceSourceTrigger:c}=(0,rd.r)(t.serviceId),{triggers:u}=(0,rb.Z)({projectId:n,environmentId:t.environmentId,serviceId:t.serviceId}),[m,x]=(0,g.useState)(!1),h=(0,rw.jM)(null!==u.error||null!=u.data&&0===u.data.length),v=(0,g.useMemo)(()=>{if(null!=h.data)return h.data.find(e=>e.fullName===(null==r?void 0:r.repo))},[h.data]);return null==r?null:(0,d.jsxs)(th.jK,{children:[(0,d.jsx)(th.oC,{children:"Automatic Deployments"}),(0,d.jsx)(th.v9,{children:"Changes made to this GitHub branch will be automatically pushed to this environment."}),u.isLoading?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(tX.B,{width:"100%",height:42}),(0,d.jsx)(tX.B,{width:"122px",height:34,className:"mt-4"})]}):null==u.data||0===u.data.length?(0,d.jsx)(q.zx,{type:"button",variant:"outline",size:"sm",disabled:!l.Write,isLoading:m,onClick:async()=>{if(null==v){a.createToast((0,d.jsx)(tr.FN,{variant:"error",title:"Error",description:null==h.data?"No repos found. Are you sure you have connected your GitHub account to your Railway account?":"".concat(r.repo," not found. Are you sure the repo exists and you have access to it?")}));return}x(!0),await i({branch:v.defaultBranch}),x(!1)},className:"max-w-max",children:"Connect Environment to Branch"}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(eq.P,{name:"branch",value:u.data[0].branch,disabled:!l.Write,label:{text:"Branch",hidden:!0},onChange:e=>o({triggerId:u.data[0].id,branch:e}),options:null==s.data?[{value:u.data[0].branch}]:s.data.map(e=>({value:e.name}))}),(0,d.jsx)(q.zx,{type:"button",variant:"outline",size:"sm",disabled:!l.Write,onClick:()=>c({triggerId:u.data[0].id}),className:"mt-4 max-w-max",children:"Disable trigger"})]})]})},rB=e=>{var t;let{project:n,environment:l,serviceInstance:a}=e,r=(0,rd.r)(a.serviceId),{triggers:s}=(0,rb.Z)({projectId:n.id,environmentId:l.id,serviceId:a.serviceId}),i=(0,g.useMemo)(()=>null!=s.data?s.data[0]:null,[s.data]),o=null!==(t=null==i?void 0:i.baseEnvironmentOverrideId)&&void 0!==t?t:null==i?void 0:i.environmentId;return(0,d.jsxs)(th.jK,{children:[(0,d.jsx)(th.oC,{children:"Base Environment"}),(0,d.jsx)(th.v9,{children:"When PRs are made into this branch, variables from this environment will be used"}),(0,d.jsx)(eq.P,{name:"base environment",value:o,label:{text:"Base environment",hidden:!0},onChange:e=>{null!=i&&r.updateBaseEnvironment({triggerId:i.id,baseEnvironmentOverrideId:e})},options:n.environments.map(e=>({value:e.id,text:e.name}))})]})},rK=e=>{let{projectId:t,serviceInstance:n,environment:l}=e,[{permissions:a}]=(0,T.PY)(),r=(0,ey.getRepoSource)(n.source),{triggers:s,updateDeploymentTrigger:i}=(0,rb.Z)({projectId:t,environmentId:l.id,serviceId:n.serviceId}),{modalActions:o}=(0,F.o)(),c=(0,g.useMemo)(()=>null!=s.data?s.data[0]:null,[s.data]),u=async e=>{null!=c&&(await i({id:c.id,input:{checkSuites:e}}),o.createToast((0,d.jsx)(tr.FN,{variant:"success",title:"Check suites ".concat(e?"enabled":"disabled"),description:e?"Deployments will be triggered once all Github actions have run successfully!":"Deployments will be triggered immediately!"})))};return null==r||null==c?null:(0,d.jsxs)(th.jK,{children:[(0,d.jsx)(th.oC,{children:"Check Suites"}),(0,d.jsxs)(th.v9,{children:["If enabled, deployments are triggered after all GitHub Actions have run successfully. Make sure you have"," ",(0,d.jsx)(et.r,{href:"https://github.com/settings/installations",variant:"underline",children:"accepted our updated GitHub permissions"})," ","required for this feature."]}),(0,d.jsx)(Z.g,{className:"p-3 bg-gray-50 rounded-lg",children:c.validCheckSuites>0?(0,d.jsx)(rN.r,{disabled:!a.Write,isSelected:c.checkSuites,onChange:e=>u(e),children:"Enable check suites"}):(0,d.jsxs)(es.Zb,{children:["Add a"," ",(0,d.jsx)(et.r,{variant:"underline",href:"https://docs.github.com/en/actions/using-workflows",children:"workflow on GitHub"})," ","to enable check suites."]})})]})};var rz=n(44726);let rQ=e=>{let{service:t,permissions:n}=e,{updateServiceName:l}=(0,rd.r)(t.id);return(0,d.jsxs)(th.jK,{className:"space-y-8",children:[(0,d.jsxs)(Z.g,{children:[(0,d.jsx)(th.oC,{children:"Service ID"}),(0,d.jsx)(rz.e,{className:"bg-gray-50 border-none",children:t.id})]}),(0,d.jsxs)(Z.g,{children:[(0,d.jsx)(th.oC,{children:"Service Name"}),(0,d.jsx)(tg,{name:"service-name",value:t.name,readOnly:!n.Write,label:{text:"Service Name",hidden:!0},onChange:e=>l(e)})]})]})};var r_=n(45815),rJ=n(75868);let rW=e=>{let{serviceId:t,environmentId:n,serviceName:l,sourceRepo:a,onSuccess:r}=e,{modalActions:s}=(0,F.o)(),[i,o]=(0,g.useState)(!1),[,{updateStarter:c}]=(0,T.PY)(),u=async()=>{o(!0);try{await c({serviceId:t,environmentId:n}),r&&r(),s.createToast((0,d.jsx)(tr.FN,{icon:U.fU,variant:"success",title:"Success",description:"We've triggered an update for your project. We will send you an email upon completion!"}))}catch(t){var e;s.createToast((0,d.jsx)(tr.FN,{icon:U.X,variant:"error",title:"Error",description:null!==(e=t.message)&&void 0!==e?e:"Sorry! Something went wrong and we weren't able to trigger an update for your project."}))}o(!1),s.exitModal()};return(0,d.jsxs)(H.u_,{title:"Update template",preventClose:!0,children:[(0,d.jsx)(H.r6,{className:"mb-5",children:"Update template"}),(0,d.jsxs)(Z.g,{space:5,children:[(0,d.jsxs)(Z.g,{space:1,children:[(0,d.jsxs)(es.xv,{children:["Do you want to update ",(0,d.jsx)("strong",{children:l})," to its latest version?"]}),(0,d.jsx)(et.r,{variant:"coloured",href:a,children:(0,d.jsxs)(Z.U,{space:1,align:"center",children:[(0,d.jsx)(es.$2,{children:"View source repo"}),(0,d.jsx)(ee.JO,{icon:U._Q,size:"xs"})]})})]}),(0,d.jsx)(es.$2,{children:"Once confirmed, we will create a new branch on Github and a PR deployment on Railway. You will be notified via email once the update has been completed."}),(0,d.jsxs)(Z.U,{space:4,justify:"end",children:[(0,d.jsx)(q.zx,{color:"gray",onClick:()=>s.exitModal(),children:"Cancel"}),(0,d.jsx)(q.zx,{color:"pink",onClick:u,disabled:i,isLoading:i,children:"Yes"})]})]})]})},rq=e=>{var t,n;let{permissions:l,service:a,serviceInstance:r}=e,[{isBeta:s}]=(0,V.aF)(),{disconnectServiceFromSource:i}=(0,rd.r)(r.serviceId),o=(0,ey.getRepoSource)(r.source),{routes:c}=(0,P.H)(),{updateRootDirectory:u,updateRailwayConfigFile:m}=(0,rd.r)(r.serviceId),x=(0,g.useMemo)(()=>null==r.upstreamUrl?null:(0,B.parseGitUrl)(r.upstreamUrl),[r.upstreamUrl]);return(0,d.jsxs)(d.Fragment,{children:[null!=o?(0,d.jsxs)(th.jK,{children:[(0,d.jsx)(th.oC,{children:"Source Repo"}),(0,d.jsxs)(Z.U,{align:"center",space:3,className:"max-w-full px-3 bg-secondaryBg dark:bg-gray-100 rounded-lg hover:bg-gray-100 hover:dark:bg-gray-200 group",children:[(0,d.jsxs)(et.r,{href:"https://github.com/".concat(o.repo),className:"flex items-center flex-grow space-x-3 min-w-0 py-2",children:[(0,d.jsx)(ee.JO,{icon:U.Tf}),(0,d.jsxs)(es.xv,{className:"truncate flex-grow space-x-2",children:[(0,d.jsx)("span",{className:"group-hover:underline",children:o.repo})," ",(0,d.jsx)("span",{"aria-hidden":!0,className:"hidden group-hover:inline text-gray-500",children:"â†—"})]})]}),(0,d.jsx)(nA.Ik,{children:(0,d.jsx)(q.hU,{icon:U.X,title:"Disconnect repo from service",onClick:()=>i({}),className:"hover:bg-gray-200"})})]})]}):(0,d.jsx)(rY,{serviceId:r.serviceId}),null!=x&&(0,d.jsx)(rZ,{service:a,serviceInstance:r,upstreamGitUrl:x}),(0,d.jsxs)(th.jK,{children:[(0,d.jsx)(th.oC,{children:"Root Directory"}),(0,d.jsxs)(th.v9,{children:["Directory that will be used for build and deployment steps. Additionally, builds will be skipped if no files changed within this directory."," ",(0,d.jsxs)(et.r,{external:!0,variant:"highlight",...c.docs({page:"/deploy/builds#root-directory"}),children:[(0,d.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,d.jsx)(U.pr,{})]})]}),(0,d.jsx)(tg,{value:null!==(t=r.rootDirectory)&&void 0!==t?t:"/",label:{text:"Root Directory",hidden:!0},readOnly:!l.Write,onChange:e=>u(e)})]}),s&&(0,d.jsxs)(th.jK,{children:[(0,d.jsxs)(th.oC,{className:"flex items-center",children:["Railway Config File Path ",(0,d.jsx)(rm.vw,{className:"ml-4"})]}),(0,d.jsx)(th.v9,{children:"Location in the repo to a file that contains Railway build and deploy config."}),(0,d.jsx)(tg,{placeholder:"railway.toml",value:null!==(n=r.railwayConfigFile)&&void 0!==n?n:"",readOnly:!l.Write,label:{text:"Railway config file path",hidden:!0},onChange:e=>m(e)})]})]})},rY=e=>{var t;let{serviceId:n}=e,{connectServiceToRepo:l}=(0,rd.r)(n),a=(0,rw.jM)(),{openCommandPalette:r}=(0,f.xd)(),[s,i]=(0,g.useState)(!1),o=(0,rw.bY)(),{modalActions:c}=(0,F.o)(),[{user:u}]=(0,V.aF)(),[{project:m}]=(0,T.PY)(),x=async e=>{i(!0),await l(e),i(!1)},h=(0,g.useMemo)(()=>[{value:"configure-github-app",text:"Configure GitHub App",icon:U.Zr,action:()=>{o()}},...(null!==(t=a.data)&&void 0!==t?t:[]).map(e=>({value:"connect-repo-".concat(e.id),text:e.fullName,isPrivate:e.isPrivate,icon:U.Tf,action:()=>{x(e)}}))],[a.data,null==m?void 0:m.teamId]),v=()=>{if(null!=u){if(!u.agreedFairUse||!u.termsAgreedOn){c.openSidePanel((0,d.jsx)(rJ.n,{}));return}r({id:"connect-repo",type:"list",prompt:"Select a repo",commands:h,crumbs:["Connect Repo"]})}};return(0,d.jsxs)(th.jK,{children:[(0,d.jsx)(th.oC,{children:"Service Source"}),(0,d.jsx)(th.v9,{children:"There's no remote repository linked to this service"}),(0,d.jsx)(q.zx,{variant:"outline",size:"sm",icon:U.Tf,isLoading:s,onClick:v,className:"max-w-max",children:s?"Connecting...":"Connect Repo"})]})},rZ=e=>{let{upstreamGitUrl:t,service:n,serviceInstance:l}=e,[{project:a,environment:r}]=(0,T.PY)(),{confirm:s}=(0,eQ.p)(),{graphqlClient:i}=(0,M.S)(),[o,c]=(0,g.useState)(!1),[u,m]=(0,g.useState)(!1),[x,h]=(0,g.useState)(!1),[v,p]=(0,g.useState)(!1),{modalActions:j}=(0,F.o)(),f=(0,rd.r)(n.id),y=async()=>{let e=await s({title:"Unlink upstream repository",description:"Confirming will unlink the upstream repository from this service. This action is irreversible and you will no longer receive automatic updates when the upstream repository is updated.",confirmButtonText:"Unlink"});e&&await f.removeUpstreamUrlFromService({})},b=async()=>{if(null!=a&&null!=r){try{c(!0);let e=(await i.serviceInstanceIsUpdatable({serviceId:n.id,environmentId:r.id})).serviceInstanceIsUpdatable;m(e)}catch(e){m(!1)}c(!1),p(!0)}},w=()=>{j.openModal((0,d.jsx)(rW,{serviceId:l.serviceId,environmentId:l.environmentId,serviceName:n.name,sourceRepo:t.cloneUrl,onSuccess:()=>h(!0)}))};return(0,d.jsxs)(Z.g,{space:4,children:[(0,d.jsxs)("fieldset",{children:[(0,d.jsxs)(r_.__,{className:"flex items-center space-x-2 text-sm text-gray-500 font-normal mb-3",children:[(0,d.jsx)(ee.JO,{icon:U.rU}),(0,d.jsx)("p",{children:"Linked to the upstream repo"})]}),(0,d.jsxs)(Z.U,{align:"center",space:3,className:"max-w-full px-3 bg-secondaryBg dark:bg-gray-100 rounded-lg hover:bg-gray-100 hover:dark:bg-gray-200",children:[(0,d.jsxs)(et.r,{href:t.cloneUrl,className:"flex items-center flex-grow space-x-3 py-2 min-w-0 group",children:[(0,d.jsx)(ee.JO,{icon:U.Tf}),(0,d.jsxs)(es.xv,{className:"truncate flex-grow space-x-2",children:[(0,d.jsx)("span",{className:"group-hover:underline",children:t.repo}),(0,d.jsx)("span",{"aria-hidden":!0,className:"hidden group-hover:inline text-gray-500",children:"â†—"})]})]}),(0,d.jsx)(nA.Ik,{children:(0,d.jsx)(q.hU,{icon:U.X,disabled:x,title:"Remove upstream repository",onClick:y,className:"hover:bg-gray-200"})})]})]}),null!=r&&!r.isEphemeral&&(0,d.jsx)(nA.Ik,{children:(0,d.jsxs)(Z.g,{children:[(0,d.jsxs)(a9.h,{isOpen:v,className:"overflow-hidden",children:[x&&(0,d.jsx)(Z.U,{justify:"between",align:"center",className:"bg-blue-50 border border-blue-100 rounded-md px-3 py-2",children:(0,d.jsx)(es.$2,{className:"text-blue-600",children:"Upstream repository is being updated. We will send you an email when done."})}),!x&&u&&(0,d.jsxs)(Z.U,{justify:"between",align:"center",className:"bg-pink-50 border border-pink-100 rounded-md px-3 py-2",children:[(0,d.jsx)(es.$2,{className:"text-pink-600",children:"New version of the upstream repo available!"}),(0,d.jsxs)(q.Qj,{color:"pink",icon:U.oQ,onClick:w,className:"hover:underline text-sm text-pink-500 flex items-center space-x-2",children:[(0,d.jsx)(ee.JO,{icon:U.oQ}),(0,d.jsx)(es.$2,{children:"Update"})]})]}),!x&&!u&&(0,d.jsxs)(Z.U,{justify:"between",align:"center",className:"bg-blue-50 border border-blue-100 rounded-md px-3 py-2",children:[(0,d.jsx)(es.$2,{className:"text-blue-600",children:"You're on the latest version of this repository."}),(0,d.jsx)(q.hU,{icon:U.X,title:"Dismiss",onClick:()=>p(!1)})]})]}),(0,d.jsx)(a9.h,{isOpen:!v,children:(0,d.jsx)(q.zx,{type:"button",variant:"outline",size:"sm",icon:U.oQ,onClick:b,isLoading:o,disabled:o,className:"max-w-max",children:"Check for updates"})})]})})]})},rH=e=>{let{service:t,serviceInstance:n,permissions:l,className:a}=e;return(0,d.jsxs)(th.Jh,{title:"General",className:a,children:[(0,d.jsx)(rQ,{service:t,permissions:l}),(0,d.jsx)(rq,{service:t,serviceInstance:n,permissions:l})]})},r$=e=>{let{project:t,environment:n,service:l,serviceInstance:a}=e,[{permissions:r}]=(0,T.PY)();return(0,d.jsxs)(Z.g,{className:"pb-8",children:[(0,d.jsxs)(th.QQ,{children:[(0,d.jsxs)(th.y2,{children:[(0,d.jsx)(es.k8,{as:"h2",children:"Environment"}),(0,d.jsxs)(es.nq,{children:["Settings scoped to ",(0,d.jsx)("b",{children:n.name})," environment."]})]}),(0,d.jsx)(rF,{project:t,serviceInstance:a})]}),(0,d.jsxs)(th.QQ,{children:[(0,d.jsxs)(th.y2,{children:[(0,d.jsx)(es.k8,{as:"h2",children:"Service"}),(0,d.jsxs)(es.nq,{children:["Settings scoped to ",(0,d.jsx)("b",{children:"ALL"})," environments."]})]}),(0,d.jsx)(rH,{service:l,serviceInstance:a,permissions:r,className:"mb-12"}),(0,d.jsx)(rh,{service:l,permissions:r,serviceInstance:a,environment:n,className:"mb-12"}),(0,d.jsx)(rf,{service:l,serviceInstance:a,permissions:r,className:"mb-12"}),(0,d.jsx)(rg,{service:l})]})]})},rG=()=>{let[{user:e}]=(0,V.aF)(),{routes:t,projectId:n,serviceId:l}=(0,P.H)();return(0,aP.c)((0,g.useMemo)(()=>({Deployments:{enabled:!0,route:t.projectServiceDeployments({})},Variables:{enabled:!0,route:t.projectServiceVariables({})},Metrics:{enabled:!0,route:t.projectServiceMetrics({})},Settings:{enabled:!0,route:t.projectServiceSettings({})}}),[e,n,l]))},rX=e=>{var t;let{project:n,environment:l,service:a,serviceInstance:r}=e,{tabs:s,currentTab:i}=rG(),o=(0,ey.getRepoSource)(null==r?void 0:r.source),c=(0,g.useRef)(i);return(0,g.useEffect)(()=>{null!=i&&(c.current=i)},[i]),(0,d.jsx)(ei.Aj,{title:null!==(t=null==a?void 0:a.name)&&void 0!==t?t:"",icon:null!=a.icon?()=>(0,d.jsx)(U.XB,{src:a.icon}):null!=o?U.Tf:U.oI,tabs:s,className:"service-tabs",children:null==n||null==l||null==a?(0,d.jsx)(er.bJ,{}):(0,d.jsx)(d.Fragment,{children:"Deployments"===c.current?(0,d.jsx)(aY,{project:n,environment:l,serviceId:a.id}):"Metrics"===c.current?(0,d.jsx)(l7,{project:n,environment:l,serviceId:a.id}):"Variables"===c.current?(0,d.jsx)(rs,{projectId:n.id,environmentId:l.id,serviceId:a.id,allowEditing:!0}):"Settings"===c.current?(0,d.jsx)(r$,{project:n,environment:l,service:a,serviceInstance:r}):(0,d.jsx)(es.y,{children:"Page not found"})})})};var r0=n(95503),r1=n(26857),r2=n(59665),r4=n(5842),r3=n(60018),r5=n(97729),r6=n.n(r5);let r8=p()(()=>n.e(4102).then(n.bind(n,59939)),{loadableGenerated:{webpack:()=>[59939]},ssr:!1}),r7=e=>{var t,n,l,a;let{children:r,...s}=e,[{user:i}]=(0,V.aF)(),[{project:o,service:c,plugin:u,isError:x,isTempProject:h}]=(0,T.PY)(),{routes:v,pathname:p}=(0,P.H)(),{sourceTemplate:f}=O({projectId:null!==(n=null==o?void 0:o.id)&&void 0!==n?n:"",enabled:null!=o&&o.isPublic}),y=(0,g.useMemo)(()=>null!=o&&null!=i&&null!=i.projects.find(e=>e.id===o.id),[null==i?void 0:i.projects,o]),b=null!==(a=null==c?void 0:c.name)&&void 0!==a?a:null===(t=j.Hh[null!==(l=null==u?void 0:u.name)&&void 0!==l?l:""])||void 0===t?void 0:t.text,w=null!=b?b:null==o?void 0:o.name,N=v.projectSettings({}).url===p;return(0,d.jsxs)(r4.IE,{seo:{title:w},children:[(0,d.jsx)(si,{}),(0,d.jsxs)("div",{className:(0,_.AK)("grid min-h-screen sm:max-h-screen","grid-rows-[auto_auto_minmax(0px,_1fr)]"),children:[(0,d.jsx)(r0.w,{fullWidth:!0,showBottomBorder:!0,showProjectName:!0,showEnvironmentSelector:!N}),(0,d.jsxs)("div",{children:[(null==o?void 0:o.deletedAt)!=null&&(0,d.jsx)("div",{className:"p-4",children:(0,d.jsxs)(W.j,{variant:"danger",children:["Project was deleted on"," ",m()(o.deletedAt).format("YYYY-MM-DD h:mm a")]})}),h&&(0,d.jsx)($,{centerAlign:!0,className:"z-20 h-max border-0 rounded-none"}),null!=f.data&&!y&&(0,d.jsx)("div",{className:"p-4",children:(0,d.jsxs)(W.j,{variant:"info",children:["You are currently viewing a public project.",(0,d.jsx)(et.r,{variant:"underline",...v.newTemplate({code:f.data.code}),className:"mx-1",children:"Click here"}),"to deploy your own version of this project."]})})]}),x?(0,d.jsx)(r2.T,{className:"pb-10 md:pb-80"}):(0,d.jsx)(se,{isInService:s.isInService,children:r})]})]})},r9=e=>{let t=(0,I.c)(e,100),[n,l]=(0,g.useState)(!1),a=(0,g.useRef)(null),r=()=>{null!=a.current&&clearTimeout(a.current),t&&(a.current=setTimeout(()=>{t&&l(!0)},150))},s=()=>{null!=a.current&&clearTimeout(a.current),l(!1)},i=()=>l(!1);return{isHovering:n,onMouseEnter:r,onMouseLeave:s,resetHover:i}},se=e=>{var t;let{isInService:n,children:l}=e,{routes:a,pathname:r,serviceId:s,pluginId:i,query:o,navActions:c}=(0,P.H)(),[{project:u,environment:m,environmentServiceInstances:v,service:p,serviceInstance:j,plugin:f,pluginView:y,pluginComponent:b}]=(0,T.PY)(),[{user:w}]=(0,V.aF)(),{sidePanels:N}=(0,F.o)(),R=r.includes(a.projectDeploy({}).url);n=n||null!=s||null!=i||R;let M=r===a.project({}).url,O=N.length>0,[L]=(0,C.K)(),U=(0,g.useRef)(null),B=(0,g.useRef)(null),K=(0,nr.n)(U),z=(0,D.h)(B),Q=(0,S.P)("lg"),J=(0,S.P)("sm"),{cliSetupForProject:W}=(0,k.A)(),q=null!=u&&null!==(t=W[u.id])&&void 0!==t&&t,Y=J?g.Fragment:x.M,Z=(0,g.useMemo)(()=>n&&"string"==typeof o.id?o.id:null,[n,o]),H=(0,E.t)();(0,A.i)({Escape:()=>{M||(null!=Z?c.push(a.projectServiceDeployments({})):c.push(a.project({})))}},[M,Z]);let $=n&&!Q?z.width:0,G=O?r1.jb:0,ee=n?$:O?G:L?320:0,et=r3.k,el=(0,I.c)(K.width-ee-et,50),er=(0,g.useMemo)(()=>n?null!=s?s:i:null,[n,s,i,R]),{isHovering:es,onMouseEnter:ec,onMouseLeave:ed,resetHover:eu}=r9(null!=w&&w.isAdmin&&null!=Z);return(0,g.useEffect)(eu,[Z]),(0,d.jsxs)(h.E.main,{className:(0,_.AK)("metro-content","block sm:grid grid-cols-[minmax(0px,_1fr)] grid-rows-[auto_1fr] md:grid-rows-[initial] max-w-full relative","sm:grid-rows-1 sm:overflow-x-hidden","md:px-0 sm:grid-cols-[0px_100%] lg:grid-cols-[1fr_70%] xl:grid-cols-[1fr_minmax(auto,_920px)] 2xl:grid-cols-[1fr_minmax(auto,_1024px)] 3xl:grid-cols-[1fr_minmax(auto,_1200px)]"),children:[(0,d.jsxs)(en.E,{largerOrEqualTo:"sm",alternativeChild:M&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(sa,{}),null!=u&&null!=m?(0,d.jsx)(aD,{project:u,environment:m}):(0,d.jsx)(aE,{})]}),children:[(0,d.jsx)(ss,{}),!q&&M&&(0,d.jsx)(sr,{}),(0,d.jsx)("div",{ref:U,className:(0,_.AK)("canvas-container","absolute inset-0 grid"),children:(0,d.jsxs)(X.xV,{name:"New Service",children:[(0,d.jsx)(X.W4,{className:"grid",children:null!=u&&null!=m?(0,d.jsx)(r8,{project:u,environment:m,renderDimensions:{...K,top:0,left:0,width:el},selectedNodeId:null!=er?er:void 0}):(0,d.jsx)(st,{renderWidth:el})}),null!=u&&(0,d.jsx)(sn,{})]})})]}),(0,d.jsx)(x.M,{initial:!1,children:null!=u&&null!=m&&H&&M&&(0,d.jsx)(aC,{project:u,environment:m})}),(0,d.jsx)(Y,{initial:!1,children:l&&!M&&(0,d.jsx)("div",{className:(0,_.AK)("metro-children","col-start-1 col-end-3 row-start-1","z-40 min-w-full h-full","md:px-6 md:overflow-y-hidden md:mx-0"),children:l},"children")}),(0,d.jsxs)(ei.Ob,{className:!n&&"hidden md:block select-none pointer-events-none",children:[(0,d.jsx)(Y,{initial:!1,children:n&&(0,d.jsx)(ei.jh,{ref:B,isBehind:null!=Z,focusFromBehind:es,onMouseEnter:ec,onMouseLeave:ed,children:null!=u&&null!=m?(0,d.jsx)(d.Fragment,{children:null!=p&&null!=j?(0,d.jsx)(rX,{project:u,environment:m,service:p,serviceInstance:j},p.id):null!=y&&null!=b?(0,d.jsx)(aa,{project:u,pluginName:null==f?void 0:f.friendlyName,environment:m,pluginView:y,pluginComponent:b,status:null==f?void 0:f.status},null==f?void 0:f.id):R?(0,d.jsx)(eo,{}):null}):(0,d.jsx)(ei.yv,{})},"first")}),(0,d.jsx)(Y,{initial:!1,children:null!=Z&&(0,d.jsx)(ei.jh,{animateFromTop:!0,hideFromFront:es,children:(0,d.jsx)(ea.u,{deploymentId:Z,showBackLink:!0})},"second")})]}),(0,d.jsx)(sl,{})]})},st=e=>{let{renderWidth:t}=e;return(0,d.jsx)("div",{className:(0,_.AK)("relative","flex justify-center items-center","bg-[url(/illustrations/grid--light.svg)] dark:bg-[url(/illustrations/grid--dark.svg)]"),children:t>100?(0,d.jsx)("div",{className:"absolute left-0 top-0 bottom-0 flex justify-center items-center",style:{width:t},children:(0,d.jsx)(ak.is,{})}):null})},sn=()=>{let{openCommandPalette:e,isCommandPaletteOpen:t,updateActiveCommandGroup:n}=(0,f.xd)(),l=(0,b.B)(),{repoCommandGroup:a}=(0,w.j)({}),r=(0,y.h)();return(0,g.useEffect)(()=>{t&&n(a)},[a,t]),(0,d.jsxs)(X.h_,{children:[(0,d.jsx)(X.OS,{children:"Add New Service"}),(0,d.jsx)(X.hK,{value:"new-github-repo",icon:U.Tf,onClick:()=>{e(a)},children:"GitHub Repo"}),(0,d.jsx)(X.hK,{value:"new-database",icon:U.vo,onClick:()=>{null!=l&&e(l)},children:"Database"}),(0,d.jsx)(X.hK,{value:"new-empty-service",icon:U.oI,onClick:()=>{null!=r.action&&r.action()},children:"Empty Service"})]})},sl=()=>{let{isCommandPaletteOpen:e,openCommandPalette:t}=(0,f.xd)(),{track:n}=(0,L.K)();return e?null:(0,d.jsx)("button",{onClick:()=>{t(),n({action:"Click",object:"Mobile Command Palette"})},className:(0,_.AK)("sm:hidden","fixed right-4 bottom-4 z-50 w-14 h-14 flex items-center justify-center text-white rounded-full","focus:outline-none focus-visible:ring-2 focus-visible:ring-pink-500"),style:{background:"linear-gradient(145.33deg, #6B15C1 3.57%, #A915C1 87.06%)"},children:(0,d.jsx)(ee.JO,{icon:U.YI})})},sa=()=>{let{routes:e}=(0,P.H)(),[,t]=(0,C.K)();return(0,d.jsxs)(Z.U,{align:"center",justify:"between",space:4,className:"py-4 px-5",children:[(0,d.jsx)(q.zx,{icon:U.cS,size:"sm",color:"gray",onClick:()=>t(!0),children:"Activity"}),(0,d.jsx)(q.ZP,{icon:U.Zr,size:"sm",color:"gray",...e.projectSettings({}),children:"Settings"})]})},sr=()=>{let{modalActions:e}=(0,F.o)();return(0,d.jsx)("div",{className:"absolute left-6 bottom-0 z-[9] w-full flex",children:(0,d.jsx)(q.zx,{icon:U.oI,variant:"outline",color:"gray",onClick:()=>e.openModal((0,d.jsx)(el.r,{})),className:"px-4 bg-background border-b-0 rounded-b-none active:scale-100",children:"Set up your project locally"})})},ss=()=>{let{routes:e,pathname:t}=(0,P.H)(),{openCommandPalette:n,isCommandPaletteOpen:l,updateActiveCommandGroup:a}=(0,f.xd)(),r=(0,N.q)(),[{project:s,environmentServiceInstances:i}]=(0,T.PY)(),{modalActions:o}=(0,F.o)();(0,g.useEffect)(()=>{null!=r&&l&&a(r)},[r,l]);let c=t===e.project({}).url,u=null==i?void 0:i.find(e=>e.isUpdatable),m=null!=u?null==s?void 0:s.services.find(e=>e.id===(null==u?void 0:u.serviceId)):null,x=()=>{if(null==m||null==u){o.createToast((0,d.jsx)(tr.FN,{icon:U.X,variant:"error",title:"Error",description:"Project or service not found."}));return}if(null==u.upstreamUrl){o.createToast((0,d.jsx)(tr.FN,{icon:U.X,variant:"error",title:"Error",description:"Service does not have a source repo."}));return}o.openModal((0,d.jsx)(rW,{serviceId:u.serviceId,environmentId:u.environmentId,sourceRepo:u.upstreamUrl,serviceName:m.name}))};return c?(0,d.jsxs)(h.E.div,{className:(0,_.AK)("map-controls","absolute top-0 left-6 right-6 z-[9]","grid gap-4 grid-cols-[auto_1fr_auto_auto] items-center py-6"),children:[m&&(0,d.jsx)(nA.Ik,{children:(0,d.jsx)(q.zx,{variant:"outline",color:"pink",icon:U.kI,onClick:x,className:"bg-background col-start-1",children:"Update available"})}),(0,d.jsx)(nA.Ik,{children:(0,d.jsx)(q.zx,{icon:U.v3,variant:"outline",onClick:()=>{null!=r&&n(r)},className:"bg-background col-start-3",children:"New"})}),(0,d.jsx)(q.ZP,{icon:U.Zr,variant:"outline",color:"gray",...e.projectSettings({}),className:"bg-background col-start-4",children:"Settings"})]}):null};function si(){return(0,d.jsx)(r6(),{children:(0,d.jsx)("style",{children:"\n          body {\n            background-color: var(--secondaryBg);\n          }\n\n          html.dark body {\n            background-color: var(--background);\n          }\n        "})})}},24066:function(e,t,n){n.d(t,{M:function(){return o}});var l=n(52322),a=n(19702),r=n.n(a),s=n(64648),i=n(25460);let o=()=>(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(s.g,{space:4,justify:"center",align:"center",className:"h-full",children:[(0,l.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",className:"jsx-747faace481b70fa rounded-lg transform rotate-180 bg-gray-200 fill-current text-background dark:text-gray-500",children:[(0,l.jsx)("rect",{x:"12",y:"12",width:"4",rx:"2",id:"firstBar",className:"jsx-747faace481b70fa"}),(0,l.jsx)("rect",{x:"22",y:"12",width:"4",rx:"2",id:"secondBar",className:"jsx-747faace481b70fa"}),(0,l.jsx)("rect",{x:"32",y:"12",width:"4",rx:"2",id:"thirdBar",className:"jsx-747faace481b70fa"})]}),(0,l.jsx)(i.$2,{className:"text-gray-400",children:"Beep, beep, bop!"})]}),(0,l.jsx)(r(),{id:"747faace481b70fa",children:"#firstBar.jsx-747faace481b70fa{-webkit-animation:firstBar ease-in-out 1s infinite;-moz-animation:firstBar ease-in-out 1s infinite;-o-animation:firstBar ease-in-out 1s infinite;animation:firstBar ease-in-out 1s infinite}#secondBar.jsx-747faace481b70fa{-webkit-animation:secondBar ease-in-out 1s infinite;-moz-animation:secondBar ease-in-out 1s infinite;-o-animation:secondBar ease-in-out 1s infinite;animation:secondBar ease-in-out 1s infinite}#thirdBar.jsx-747faace481b70fa{-webkit-animation:thirdBar ease-in-out 1s infinite;-moz-animation:thirdBar ease-in-out 1s infinite;-o-animation:thirdBar ease-in-out 1s infinite;animation:thirdBar ease-in-out 1s infinite}@-webkit-keyframes firstBar{0%{height:8px}50%{height:24px}100%{height:8px}}@-moz-keyframes firstBar{0%{height:8px}50%{height:24px}100%{height:8px}}@-o-keyframes firstBar{0%{height:8px}50%{height:24px}100%{height:8px}}@keyframes firstBar{0%{height:8px}50%{height:24px}100%{height:8px}}@-webkit-keyframes secondBar{0%{height:12px}50%{height:18px}100%{height:12px}}@-moz-keyframes secondBar{0%{height:12px}50%{height:18px}100%{height:12px}}@-o-keyframes secondBar{0%{height:12px}50%{height:18px}100%{height:12px}}@keyframes secondBar{0%{height:12px}50%{height:18px}100%{height:12px}}@-webkit-keyframes thirdBar{0%{height:24px}50%{height:8px}100%{height:24px}}@-moz-keyframes thirdBar{0%{height:24px}50%{height:8px}100%{height:24px}}@-o-keyframes thirdBar{0%{height:24px}50%{height:8px}100%{height:24px}}@keyframes thirdBar{0%{height:24px}50%{height:8px}100%{height:24px}}"})]})},68079:function(e,t,n){n.d(t,{i:function(){return r}});var l=n(8900),a=n(79089);let r=e=>{let{project:t,environment:n}=e,r=t.services.flatMap(e=>e.serviceInstances.filter(e=>e.environmentId===n.id));if(0===t.plugins.length&&0===r.length)return[{type:"empty",id:"empty"}];let s=t.plugins.map(e=>({type:"plugin",id:e.id,plugin:e,pluginItem:l.Hh[e.name]})),i=[];for(let e of t.services){let t=e.serviceInstances.find(e=>e.environmentId===n.id);if(null!=t){let l=e.deployments.filter(e=>e.environmentId===n.id)[0];i.push({type:"service",id:e.id,service:e,serviceInstance:(0,a.v)(t),latestDeploy:l})}}return[...s,...i]}},19333:function(e,t,n){n.d(t,{O:function(){return r}});var l=n(52322),a=n(67846);let r=()=>(0,l.jsx)(a.j,{variant:"warning",children:"You are not authorized to view the contents of this section."})},73452:function(e,t,n){n.d(t,{Ik:function(){return i},v9:function(){return o}});var l=n(52322);n(2784);var a=n(25460),r=n(67930);let s=e=>{let{accessLevel:t,message:n,children:s}=e,[{permissions:i}]=(0,r.PY)(),o=i[t];return o?(0,l.jsx)(l.Fragment,{children:s}):null!=n?(0,l.jsx)(a.xv,{className:"py-4",children:n}):null},i=e=>(0,l.jsx)(s,{...e,accessLevel:r.uv.Write}),o=e=>(0,l.jsx)(s,{...e,accessLevel:r.uv.Admin})},24222:function(e,t,n){n.d(t,{h:function(){return g}});var l=n(52322),a=n(94922),r=n(2784),s=n(94106),i=n(13235),o=n(14307),c=n(4735),d=n(16163),u=n(64648),m=n(25460),x=n(65146),h=n(65801),v=n(67421),p=n(77967);let g=e=>{let{autocompleteOptions:t,nameAutocompleteOptions:n,onAddVariable:g,onCancel:j,checkConflict:f,hideAutocompleteHint:y,forceAutocomplete:b=!1,...w}=e,{handleSubmit:N,control:C,watch:S}=(0,s.cI)({defaultValues:{name:"",value:""}}),[k,I]=r.useState(0),D=S(),{confirm:A}=(0,i.p)(),E=async e=>{var t;let{name:n,value:l}=e,a=null!==(t=null==f?void 0:f(n))&&void 0!==t&&t;(!a||await A({title:"Variable overwrite detected",description:"Updating this variable will overwrite another with the same name. Are you sure you want to do this?",confirmButtonText:"Overwrite"}))&&(I(e=>e+1),await g({name:n,value:l}))},P=(0,r.useMemo)(()=>(0,a.findReferences)(D.value),[D.value]),T=(0,r.useCallback)(e=>{let[t,n]=e.clipboardData.getData("text").split("=",2);if(null!=n){var l;e.preventDefault(),C.setValue("name",t),C.setValue("value",n),null===(l=M.current)||void 0===l||l.focus()}},[]),R=(0,r.useRef)(null),M=(0,r.useRef)(null);return(0,l.jsxs)(d.l0,{ref:R,name:"Add Variable",trackingProperties:{containsSharedReference:P.some(e=>e.includes(".")),containsLocalReference:P.some(e=>!e.includes("."))},enableBindings:!0,...w,onSubmit:N(E),className:(0,p.AK)(w.className,"grid auto-rows-auto md:grid-cols-[1fr_1fr_auto] gap-2"),children:[(0,l.jsx)(u.g,{className:"w-full md:w-auto lg:flex-grow",children:(0,l.jsx)(s.Qr,{name:"name",control:C,defaultValue:"",rules:{required:!1},render:e=>{let{onChange:t}=e;return null==n?(0,l.jsx)(v.II,{onChange:t,onPaste:T,placeholder:"NAME",label:{text:"name",hidden:!0},size:"sm",value:D.name}):(0,l.jsx)(x.F,{size:"sm",placeholder:"VARIABLE_NAME",options:n,onPaste:T,behavior:"replace",minQueryLength:5,defaultOpen:b,label:{text:"name",hidden:!0},icon:o._M,iconText:"Add Reference",overflowHint:"Filter Database or Shared Variables",onChange:t,onSelect:e=>{var t;null===(t=M.current)||void 0===t||t.focus();let n=e.valueOption;C.setValue("value",n.value)},value:D.name,onSubmit:()=>{var e;null===(e=R.current)||void 0===e||e.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))}})}})}),(0,l.jsxs)(u.g,{className:"w-full",children:[(0,l.jsx)("label",{htmlFor:"variable-value",className:"sr-only",children:"Value"}),(0,l.jsx)(s.Qr,{name:"value",control:C,defaultValue:"",rules:{required:!1},render:e=>{let{onChange:n}=e;return(0,l.jsx)(h.B,{ref:M,autocompleteOptions:t,onChange:n,value:D.value,onSubmit:()=>{var e;null===(e=R.current)||void 0===e||e.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))}})}}),!y&&(0,l.jsxs)(m.Ew,{children:["Press ",(0,l.jsx)(m.sr,{children:"/"})," to autocomplete template variables"]})]}),(0,l.jsxs)(u.U,{space:2,children:[(0,l.jsx)(c.zx,{size:"sm",type:"submit",icon:o.Jr,disabled:0===D.name.length,className:"w-full md:max-w-max",children:"Add"}),null!=j&&(0,l.jsx)(c.zx,{size:"sm",type:"button",color:"gray",onClick:j,className:"w-full md:max-w-max",children:"Cancel"})]})]},k)}},78750:function(e,t,n){n.d(t,{$:function(){return D}});var l=n(52322),a=n(2784),r=n(14307),s=n(16436),i=n(92393),o=n(26390),c=n(4735),d=n(38532),u=n(17250),m=n(77967),x=n(57507);let h=e=>{let{value:t,...n}=e,[a,s]=(0,u.F)(),i=async()=>{null!=t&&s(t)};return(0,l.jsx)(l.Fragment,{children:a?(0,l.jsx)("span",{className:"inline-flex items-center justify-center px-1 w-xs",children:(0,l.jsx)(d.E.span,{initial:{y:10},animate:{y:0},children:(0,l.jsx)(x.JO,{icon:r.Jr,size:"sm"})})}):(0,l.jsx)(c.hU,{icon:r.CK,size:"xs",title:"Copy Variable",onClick:e=>{e.stopPropagation(),i()},...n,className:(0,m.AK)("focus:ring-0",n.className)})})};var v=n(64648),p=n(64853);let g=e=>{let{value:t}=e,[n,a]=(0,o.k)(!1,1e4),s=null!=t&&n?t:"*******";return(0,l.jsxs)("div",{className:"flex items-center h-full text-sm",children:[(0,l.jsx)(v.U,{className:"font-mono whitespace-pre min-w-[60px] max-h-[30vh] h-full pt-2",children:(0,l.jsx)(p.x,{children:s.length>0?s:(0,l.jsx)("span",{"aria-hidden":!0,className:"italic text-gray-500 select-none",children:"<empty string>"})})}),(0,l.jsxs)("div",{className:"flex whitespace-nowrap flex-nowrap justify-end ml-2 space-x-0.5",children:[(0,l.jsx)(c.hU,{icon:n?r._j:r.bA,name:"".concat(n?"Mask":"Reveal"," Variable"),size:"xs",onClick:()=>a(!n),title:n?"Hide value":"Show value",className:"opacity-0 group-hover:opacity-100 focus:opacity-100 focus:ring-0 reveal"}),(0,l.jsx)(h,{value:t,title:"Copy value",className:"opacity-0 group-hover:opacity-100 focus:opacity-100"})]})]})};var j=n(25154),f=n(16163),y=n(92788),b=n(60017),w=n(94922),N=n(65801);let C=e=>{let{value:t,onEdit:n,onCancelEdit:s,autocompleteOptions:i}=e,[o,d]=(0,a.useState)(t),{modalActions:u}=(0,j.o)(),m=async()=>{d(t),await s()},x=async()=>{try{await n(o)}catch(e){u.createToast((0,l.jsx)(b.FN,{variant:"error",title:"Failed to save variable"}))}},h=(0,a.useMemo)(()=>(0,w.findReferences)(o),[o]);return(0,l.jsxs)(f.l0,{name:"Edit Variable",trackingProperties:{containsSharedReference:h.some(e=>e.includes(".")),containsLocalReference:h.some(e=>!e.includes("."))},onCancel:m,onSubmit:x,enableBindings:!0,className:"flex items-center w-full",children:[(0,l.jsx)(N.B,{autocompleteOptions:null!=i?i:[],onChange:d,onSubmit:x,value:o}),(0,l.jsx)(y.L,{x:2}),(0,l.jsxs)(v.U,{align:"center",children:[(0,l.jsx)(c.hU,{icon:r.X,title:"Cancel",type:"button",onClick:m}),(0,l.jsx)(c.hU,{icon:r.Jr,title:"Submit",type:"button",onClick:x})]})]})};var S=n(73452),k=n(13235),I=n(25460);let D=e=>{let{name:t,value:n,componentLeft:o,className:d,onEdit:u,onDelete:x,onAdd:h,onShare:p,isShared:j,onPromoteToShared:f,skipConfirmation:y,componentAfterValue:b,autocompleteOptions:w,...N}=e,[D,A]=(0,a.useState)(!1),{confirm:E}=(0,k.p)(),P=async e=>{if("function"!=typeof u)throw Error("onEdit not passed to GenericVariableRow");A(!1),await u({name:t,value:e})},T=async()=>{null!=n&&A(!0)},R=f?async()=>{await E({title:"Promote to Shared Variable",confirmButtonText:"Promote",confirmButtonColor:"pink",description:(0,l.jsxs)(l.Fragment,{children:["Are you sure you want to promote ",(0,l.jsx)(I.ZM,{children:t}),"? This will convert it to a shared variable that can be referenced by multiple services."]})})&&await f({name:t})}:null,M=x?async()=>{(y||await E({confirmButtonText:"Delete",title:"Delete Variable",description:(0,l.jsxs)(l.Fragment,{children:["Are you sure you want to delete ",(0,l.jsx)(I.ZM,{children:t}),"? Once deleted, it will be gone forever."]})}))&&await x({name:t})}:null;return(0,l.jsxs)(i.zC,{className:"".concat(null!=d?d:""," variable-row group"),...N,children:[(0,l.jsxs)(v.U,{space:2,align:"center",className:"text-sm",children:[o,(0,l.jsx)("span",{title:t,className:(0,m.AK)("truncate","added"===h&&"text-gray-500"),children:t})]}),(0,l.jsx)("div",{className:(0,m.AK)("pl-3 w-full h-full",D?"cols-span-2":"pr-2"),children:D&&null!=n?(0,l.jsx)(C,{value:n,onEdit:P,onCancelEdit:()=>A(!1),autocompleteOptions:w}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(g,{value:n}),(0,l.jsx)("div",{className:"w-full ml-3",children:b})]})}),(0,l.jsx)(v.U,{align:"center",justify:"end",children:!D&&(0,l.jsxs)(S.Ik,{children:["added"===h&&(0,l.jsx)(c.zx,{disabled:!0,size:"xs",variant:"outline",color:"gray",children:"ADDED"}),"function"==typeof h&&(0,l.jsx)(c.zx,{size:"xs",variant:"outline",onClick:()=>h({name:t}),className:"opacity-0 group-hover:opacity-100",children:"ADD"}),(u||M||R||p)&&(0,l.jsxs)(v.U,{align:"center",space:2,className:"actions",children:[p&&(0,l.jsx)(c.zx,{variant:"outline",size:"xs",onClick:()=>p({name:t}),className:(0,m.AK)("opacity-0 group-hover:opacity-100",!j&&"opacity-100"),children:"SHARE"}),(0,l.jsxs)(s.Lt,{children:[(0,l.jsx)(s.z,{icon:r.hl,title:"Variable actions",className:"p-1 pr-0 text-gray-600"}),(0,l.jsxs)(s.Nv,{align:"end",children:[u&&(0,l.jsx)(s.hP,{onSelect:T,icon:r.I8,className:"edit-variable",children:"Edit"}),R&&(0,l.jsx)(s.hP,{onSelect:R,icon:r.TH,children:"Promote"}),M&&(0,l.jsx)(s.hP,{onSelect:M,variant:"danger",icon:r.Vh,children:"Delete"})]})]})]})]})})]})}},85192:function(e,t,n){n.d(t,{u:function(){return g}});var l=n(52322),a=n(39933),r=n(83577),s=n(2784),i=n(17250),o=n(14307),c=n(25154),d=n(4735),u=n(16163),m=n(64648),x=n(66186),h=n(26343),v=n(16147),p=n(77967);let g=e=>{let{variables:t,setVariables:n}=e,{modalActions:a}=(0,c.o)(),[r,i]=(0,s.useState)(null),o=e=>{n(e),a.exitModal()};return(0,l.jsxs)(m.g,{space:3,className:"w-full md:min-w-md",children:[(0,l.jsx)(h.r6,{children:"Raw Editor"}),null==r?(0,l.jsx)(h.iO,{className:"mt-0 py-2 text-gray-500 border border-transparent",children:"Add, edit, or delete your project variables"}):(0,l.jsx)(h.iO,{className:"mt-0 px-3 py-2 text-red-500 bg-red-50 border border-red-100 rounded-md",children:r}),(0,l.jsx)(j,{variables:t,onError:i,onChangeVariables:o,onCancel:()=>a.exitModal()})]})},j=e=>{let{variables:t,onChangeVariables:n,onError:c,onCancel:h}=e,[g,j]=(0,s.useState)("ENV"),[b,w]=(0,i.F)(),[N,C]=(0,s.useState)(t),[S,k]=(0,s.useState)((0,r.variablesToEnvText)(N)),[I,D]=(0,s.useState)(null),A=e=>{k((0,r.variablesToEnvText)(N)),j(e)};(0,s.useEffect)(()=>{c(I)},[I]);let E=()=>{null==I&&n(N)},P=()=>{try{let e="ENV"===g?S:JSON.stringify(N);w(e)}catch(e){}},T={border:"none",minHeight:"100%",margin:"0.3rem 0.5rem"};return(0,l.jsxs)(u.l0,{onSubmit:E,enableBindings:!0,name:"Raw Editor",className:"raw-editor",children:[(0,l.jsxs)(a.fC,{value:g,onValueChange:e=>A(e),className:(0,p.AK)("grid grid-rows-[auto_minmax(0px,_1fr)] h-96","border border-gray-200 rounded",null!=I&&"border-red-500"),children:[(0,l.jsxs)(a.aV,{className:"grid grid-cols-2",children:[(0,l.jsx)(f,{value:"ENV",active:"ENV"===g,children:"ENV"}),(0,l.jsx)(f,{value:"JSON",active:"JSON"===g,children:"JSON"})]}),(0,l.jsx)(a.VY,{value:"ENV",className:"w-full min-w-0 h-full",children:(0,l.jsx)(v.g,{language:"env",value:S,onChange:e=>{k(e),C((0,r.parseEnvContents)(e))},styles:T,placeholder:"HELLO=world\nFOO=bar"})}),(0,l.jsx)(y,{value:"JSON",children:(0,l.jsx)(x.A,{value:N,onEdit:e=>{null==e?D("Invalid JSON"):(0,r.isValidJsonEnv)(e)?(D(null),C(e)):D("JSON values must be strings")},hideControls:!0,editorStyles:T})})]}),(0,l.jsxs)(m.U,{space:4,className:"mt-3 flex-wrap xs:justify-end",children:[(0,l.jsx)(d.zx,{name:"Copy ".concat(g," Variables"),variant:"ghost",color:"pink",size:"sm",icon:o.CK,onClick:e=>{e.preventDefault(),P()},className:"mr-auto mt-3",children:b?(0,l.jsxs)(l.Fragment,{children:["Copied! ",g]}):(0,l.jsxs)(l.Fragment,{children:["Copy ",g]})}),(0,l.jsx)(d.zx,{variant:"primary",color:"gray",size:"sm",onClick:e=>{e.preventDefault(),h()},className:"mt-3",children:"Cancel"}),(0,l.jsx)(d.zx,{size:"sm",disabled:null!=I,className:"mt-3 w-full xs:w-auto",children:"Update Variables"})]})]})},f=(0,p.Lq)(a.xz)(e=>{let{active:t}=e;return["h-10 px-3 py-2 text-sm leading-5 text-center text-gray-500 border-b cursor-pointer","hover:text-foreground",t&&"font-semibold border-b-2 border-black text-foreground dark:border-white"]}),y=(0,p.Lq)(a.VY)(()=>[],{display:"grid",gridTemplateRows:"minmax(0px, 1fr)",gridTemplateColumns:"minmax(0px, 1fr)"})},65801:function(e,t,n){n.d(t,{B:function(){return i}});var l=n(52322),a=n(2784),r=n(65146),s=n(14307);let i=(0,a.forwardRef)((e,t)=>{let{autocompleteOptions:n,onChange:a,onSubmit:i,value:o}=e;return(0,l.jsx)(r.F,{ref:t,autoHeight:!0,enterToSubmit:!0,onChange:a,onSubmit:i,options:n,icon:s._w,label:{text:"value",hidden:!0},size:"sm",autoComplete:"off",value:o,placeholder:"VALUE or ${{REF}}",className:"resize-none max-h-[30vh]"})})},92393:function(e,t,n){n.d(t,{aZ:function(){return v},zC:function(){return p}});var l=n(92228),a=n(52322);n(2784),n(14307);var r=n(57507),s=n(38532),i=n(77967);function o(){let e=(0,l.Z)(["space-y-1 flex-grow text-left"]);return o=function(){return e},e}function c(){let e=(0,l.Z)(["text-base leading-6 text-foreground"]);return c=function(){return e},e}function d(){let e=(0,l.Z)(["text-sm leading-5 text-gray-500"]);return d=function(){return e},e}function u(){let e=(0,l.Z)(["flex items-center space-x-4 w-full pt-4 p-4 focus:outline-none"]);return u=function(){return e},e}function m(){let e=(0,l.Z)([""]);return m=function(){return e},e}function x(){let e=(0,l.Z)(["bg-gray-200 my-2"]);return x=function(){return e},e}function h(){let e=(0,l.Z)(["px-4 pb-4"]);return h=function(){return e},e}(0,i.Q$)("div")(e=>["rounded-lg bg-gray-100 border border-gray-100","hover:border-gray-200",e.isOpen&&"border-gray-200"]),i.dy.header(o()),i.dy.h4(c()),i.dy.p(d()),i.dy.button(u()),(0,i.Lq)(r.JO)(m()),i.dy.hr(x()),(0,i.Lq)(s.E.div)(h());let v=e=>{let{icon:t,bgColor:n,borderColor:l}=e;return null==t?null:(0,a.jsx)(r.JO,{icon:t,size:"2xl",className:(0,i.AK)("p-3 rounded-md text-foreground border",null!=n?n:"!text-gray-100",null!=l?l:"border-gray-200")})},p=e=>(0,a.jsx)("div",{...e,className:(0,i.AK)(e.className,e.noHover?"":"hover:hover:bg-secondaryBg dark:hover:bg-gray-50","grid grid-cols-[minmax(0,_2fr)_minmax(0,_3fr)_minmax(4rem,_auto)]","justify-items-stretch min-h-[2.25rem] max-h-[2.25rem] px-4 items-center font-mono")})},33314:function(e,t,n){n.d(t,{b:function(){return a}});var l=n(2784);let a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];(0,l.useEffect)(()=>{let t=e();t&&t.then(()=>{}).catch(()=>{})},t)}},35519:function(e,t,n){n.d(t,{n:function(){return s}});var l=n(2784),a=n(97209);let r=e=>{let t=e.getBoundingClientRect();return{top:t.top,left:t.left,width:t.width,height:t.height}},s=e=>{let[t,n]=(0,l.useState)({top:0,left:0,width:0,height:0}),s=(0,l.useCallback)(()=>{null!=e.current&&n(r(e.current))},[e,n]);return(0,l.useEffect)(()=>{if(null==e.current)return;let t=e.current;try{let e=new a.Z(()=>{s()});return e.observe(t),()=>{e.unobserve(t)}}catch(e){}},[e.current,s]),(0,l.useEffect)(()=>{if(null!=e.current)return window.addEventListener("scroll",s),window.addEventListener("resize",s),()=>{window.removeEventListener("scroll",s),window.removeEventListener("resize",s)}},[e.current,s]),(0,l.useEffect)(()=>{s();let e=setTimeout(()=>{s()},1e3);return()=>{clearTimeout(e)}},[e.current,s]),t}},80031:function(e,t,n){n.d(t,{i:function(){return s}});var l=n(2784),a=n(42328),r=n(86289);let s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],{isCommandPaletteOpen:n}=(0,r.xd)();(0,l.useEffect)(()=>{if(n)return;let t=e=>t=>{var n;let l=null===(n=t.target)||void 0===n?void 0:n.nodeName,a=t.metaKey||t.ctrlKey||t.metaKey;("INPUT"!==l&&"TEXTAREA"!==l||a)&&e(t)},l=(0,a.ZP)(window,Object.entries(e).reduce((e,n)=>{let[l,a]=n;return{...e,[l]:t(a)}},{}));return()=>{l()}},[n,...t])}},21565:function(e,t,n){n.d(t,{c:function(){return r}});var l=n(2784),a=n(68663);let r=e=>{let{pathname:t}=(0,a.H)(),n=(0,l.useMemo)(()=>Object.entries(e).filter(e=>{let[,t]=e;return t.enabled}).map(e=>{let[n,l]=e;return{text:n,link:l.route,badge:l.badge,active:t===l.route.url}}),[t,e]),r=(0,l.useMemo)(()=>{let n=Object.entries(e).find(e=>{let[,n]=e;return n.route.url===t});return null!=n?n[0]:null},[t,e]);return{tabs:n,currentTab:r}}},24596:function(e,t,n){n.d(t,{Lh:function(){return g},TH:function(){return v},XH:function(){return m},a9:function(){return p},fg:function(){return u},lj:function(){return d},y$:function(){return x}});var l=n(28879),a=n.n(l),r=n(2784),s=n(42598),i=n(40940),o=n(63798),c=n(16231);let d="h:mma",u="MMM D",m=[{display:"1h",dateFormat:d,numDateTicks:6,sampleRate:1,getStartDate:()=>a()().subtract(1,"h").toDate().toISOString()},{display:"6h",dateFormat:d,numDateTicks:6,sampleRate:1,getStartDate:()=>a()().subtract(6,"h").toDate().toISOString()},{display:"1d",dateFormat:d,numDateTicks:6,sampleRate:4,getStartDate:()=>a()().subtract(1,"d").toDate().toISOString()},{display:"7d",dateFormat:u,numDateTicks:7,sampleRate:60,getStartDate:()=>a()().subtract(7,"d").toDate().toISOString()}],x=(0,s.Z)("@railway/metrics/grid","2up"),h=(0,s.Z)("@railway/metrics/range","1h"),v=(0,s.Z)("@railway/metrics/version","v1"),p=()=>{var e;let[t,n]=h(),l=(0,r.useMemo)(()=>null!==(e=m.find(e=>e.display===t))&&void 0!==e?e:m[0],[t]);return[l,n]},g=e=>{let{environmentId:t,serviceId:n,pluginId:l}=e,{graphqlClient:a}=(0,c.S)(),[r]=p();return(0,o.o)(["metricsv2",t,r.display,n,l],async()=>(await a.metrics({environmentId:t,serviceId:n,pluginId:l,startDate:r.getStartDate(),endDate:null!=r.getEndDate?r.getEndDate():null,measurements:[i.SMQ.CpuUsage,i.SMQ.MemoryUsageGb,i.SMQ.NetworkRxGb,i.SMQ.NetworkTxGb],sampleRateSeconds:60*r.sampleRate,averagingWindowSeconds:360*r.sampleRate})).metrics,{refetchInterval:3e4,retry:!1,staleTime:15e3})}},26390:function(e,t,n){n.d(t,{k:function(){return a}});var l=n(2784);let a=(e,t)=>{let[n,a]=(0,l.useState)(e),r=(0,l.useRef)(null),s=n=>{a(n),r.current=setTimeout(()=>{a(e)},t)};return(0,l.useEffect)(()=>()=>{null!=r.current&&(clearTimeout(r.current),r.current=null)},[]),[n,s]}},34142:function(e,t,n){n.d(t,{R:function(){return v}});var l=n(52322);n(2784);var a=n(60017),r=n(25154),s=n(84762),i=n(8560),o=n(64023),c=n(98937),d=n(77685),u=n(6518),m=n(16231),x=n(67930),h=n(82066);let v=e=>{let{projectId:t,environmentId:n,pluginId:v=null,serviceId:p=null}=e,g=(0,h.useQueryClient)(),{track:j}=(0,c.K)(),f=(0,s.Sb)({projectId:t,environmentId:n,serviceId:p,pluginId:v}),{graphqlClient:y}=(0,m.S)(),{projectVariables:b,setProjectVariables:w,queryKey:N,invalidateProjectVariables:C}=(0,o.aq)({projectId:t}),{onServiceChanged:S,onServicesChanged:k}=(0,d.Q)(),{invalidateDecryptedVariables:I,invalidateAllDecryptedVariables:D,setDecryptedUnrenderedVariables:A}=(0,s.Qy)({projectId:t,environmentId:n,serviceId:p,pluginId:v,enabled:!1}),E=e=>{var t;let l=(null!==(t=b.data)&&void 0!==t?t:[]).map(t=>{if(t.id!==n)return t;let l=e(t.variables),a=l.filter((e,t)=>l.findIndex(t=>t.pluginId===e.pluginId&&t.serviceId===e.serviceId&&t.name===e.name)===t);return{...t,variables:a}});w(l),S({serviceId:p,environmentId:n})},P=e=>{var t;let l=(null!==(t=b.data)&&void 0!==t?t:[]).map(t=>{if(t.id!==n)return t;let l=t.variables.filter(e=>!(e.serviceId===p&&e.pluginId===v)),a=t.variables.filter(e=>e.serviceId===p&&e.pluginId===v),r=e(a),s=r.filter((e,t)=>r.findIndex(t=>t.name===e.name)===t);return{...t,variables:[...l,...s]}});w(l),S({serviceId:p,environmentId:n})},{modalActions:T}=(0,r.o)(),R=e=>t=>{T.createToast((0,l.jsx)(a.FN,{title:"Error ".concat(e,": ").concat(t.message),variant:"error"}))},M=(0,i.f)(N,async e=>{var l;null!=t&&null!=n&&(P(t=>[...t,...e.map(e=>{var n;let{name:a}=e;return{name:a,serviceId:p,pluginId:v,references:null!==(l=null===(n=t.find(e=>e.name===a))||void 0===n?void 0:n.references)&&void 0!==l?l:[]}})]),A(t=>({...t,...e.reduce((e,t)=>{let{name:n,value:l}=t;return{...e,[n]:l}},{})})),await Promise.all(e.map(e=>{let{name:l,value:a}=e;return y.variableUpsert({input:{name:l,value:a.trim(),projectId:t,environmentId:n,serviceId:p}})})),I(),await g.invalidateQueries((0,x.GX)(t)))},R("Upserting variables")),O=e=>{let{name:t,value:n}=e;return M([{name:t,value:n}])},L=(0,i.f)(f,async e=>{let{name:l}=e;null!=t&&null!=n&&(j({action:"Delete",object:(0,u.P)({pluginId:v,serviceId:p})?"Shared Variable":"Variable"}),P(e=>e.filter(e=>e.name!==l)),await y.variableDelete({input:{name:l,projectId:t,environmentId:n,serviceId:p}}),I(),await g.invalidateQueries((0,x.GX)(t)))},R("Deleting variable")),U=(0,i.f)(f,async e=>{let{name:l,servicesMap:a}=e;if(null==t||null==n)return;let r=[],s=[];for(let e in a){let t=a[e];t?r.push(e):s.push(e)}await y.sharedVariableConfigure({input:{projectId:t,environmentId:n,name:l,enabledServiceIds:r,disabledServiceIds:s}}),await D(),await C(),await g.invalidateQueries((0,x.GX)(t));let i=[...s,...r];k({environmentId:n,serviceIds:i})},R("Configure shared variable")),F=(0,i.f)(f,async e=>{var l;let{name:a,value:r}=e;if(null==t||null==n)return;let s=r.trim(),i="${{".concat(o.ye,".").concat(a,"}}"),c={name:a,value:s,serviceId:null};j({action:"Promote",object:"variable"}),E(e=>{var t;return[...e,{...c,references:null!==(l=null===(t=e.find(e=>e.name===a))||void 0===t?void 0:t.references)&&void 0!==l?l:[]}]}),A(e=>({...e,[a]:i})),await y.variableUpsert({input:{...c,environmentId:n,projectId:t}}),await y.variableUpsert({input:{environmentId:n,projectId:t,serviceId:p,name:a,value:i}})},R("Promoting variable")),V=(0,i.f)(f,async e=>{var l;let{variables:a}=e;null!=t&&null!=n&&(P(e=>[...e,...Object.keys(a).map(t=>{var n;return{name:t,pluginId:v,serviceId:p,references:null!==(l=null===(n=e.find(e=>e.name===t))||void 0===n?void 0:n.references)&&void 0!==l?l:[]}})]),await y.variableCollectionUpsert({input:{variables:a,projectId:t,environmentId:n,serviceId:p}}),I(),C())},R("Adding variables")),B=(0,i.f)(f,async e=>{var l;let{variables:a}=e;null!=t&&null!=n&&(P(e=>[...Object.keys(a).map(t=>{var n;return{name:t,pluginId:v,serviceId:p,references:null!==(l=null===(n=e.find(e=>e.name===t))||void 0===n?void 0:n.references)&&void 0!==l?l:[]}})]),await y.variableCollectionUpsert({input:{replace:!0,variables:a,projectId:t,environmentId:n,serviceId:p}}),I())},R("Setting variables"));return{upsertVariable:O,upsertVariables:M,deleteVariable:L,upsertVariablesFromObject:V,setVariablesFromObject:B,promoteToSharedVariable:F,configureSharedVariable:U}}},70201:function(e,t,n){n.d(t,{b:function(){return a}});var l=n(92762);let a=e=>{let[t,n]=(0,l.ZP)("".concat(e,"-variables-order"),[]);return{order:t,setOrder:n}}},99888:function(e,t,n){n.d(t,{V:function(){return l}});let l=e=>{try{return JSON.parse(e),!0}catch(e){}return!1}},22048:function(e,t,n){n.d(t,{u:function(){return a}});var l=n(24489);let a=e=>e<1/l.KB_IN_GB?"".concat((e*l.B_IN_GB).toFixed(0)," B"):e<1/l.MB_IN_GB?"".concat((e*l.KB_IN_GB).toFixed(0)," KB"):e<1?"".concat((e*l.MB_IN_GB).toFixed(0)," MB"):"".concat(e.toFixed(2)," GB")}}]);