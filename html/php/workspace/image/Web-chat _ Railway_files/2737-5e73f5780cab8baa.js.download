"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2737],{27425:function(e,n,r){r.d(n,{Et:function(){return p},Lg:function(){return h},X2:function(){return v},XP:function(){return b},f4:function(){return f},iA:function(){return g},jn:function(){return y},qN:function(){return j}});var t=r(92228),s=r(52322);r(2784);var a=r(14307),i=r(4735),l=r(64648),o=r(25460),d=r(77967);function c(){let e=(0,t.Z)(["overflow-x-auto flex-grow rounded-lg border border-gray-200"]);return c=function(){return e},e}function u(){let e=(0,t.Z)(['\n    "[&>tr]:border [&>tr]:border-b [&>tr]:border-gray-100 [&>tr]:bg-transparent [&>tr]:hover:bg-transparent"\n']);return u=function(){return e},e}function x(){let e=(0,t.Z)(["py-3 px-4 text-left font-semibold text-xs text-gray-600"]);return x=function(){return e},e}function m(){let e=(0,t.Z)(["flex items-center justify-center pt-4"]);return m=function(){return e},e}let h=d.dy.div(c()),g=(0,d.Q$)("table")(e=>["w-full border-collapse",e.isSelecting?"select-none":"select-auto"]),p=(0,d.Q$)("thead")(u()),b=(0,d.Q$)("tbody")(e=>[e.showRowBorder&&"[&>tr]:border-b [&>tr]:border-gray-100 [&>tr:last-child]:border-none"]),v=(0,d.Q$)("tr")(e=>[e.isInserting&&"border-t-2 border-pink-500",e.unSelectable&&"[&>tr]:cursor-initial",e.isActive&&"bg-gray-100","[&.selected]:bg-gray-100 [&.inserting]:bg-transparent",e.unSelectable||!1===e.isActive?"hover:bg-transparent":"hover:bg-gray-100"]),j=d.dy.th(x()),f=(0,d.Q$)("td")(()=>["py-3 px-4 cursor-pointer overflow-hidden overflow-ellipsis whitespace-nowrap"],e=>({width:e.width,minWidth:64,maxWidth:400,textAlign:e.align})),y=e=>{let{canPreviousPage:n,canNextPage:r,pageIndex:t,totalPages:i,gotoPage:l,previousPage:d,nextPage:c,...u}=e;return(0,s.jsxs)(w,{space:2,...u,children:[(0,s.jsx)(k,{type:"button",title:"First Page",icon:a.Qs,isHidden:!n,onClick:()=>l(0)}),(0,s.jsx)(k,{type:"button",title:"Previous Page",icon:a.s$,isHidden:!n,onClick:()=>d()}),(0,s.jsxs)(o.xv,{className:"!text-sm whitespace-nowrap",children:["Page ",t+1," ",null!=i&&(0,s.jsxs)(s.Fragment,{children:["of ",i]})]}),(0,s.jsx)(k,{type:"button",title:"Next Page",icon:a._Q,isHidden:!r,onClick:()=>c()}),(0,s.jsx)(k,{type:"button",icon:a.Tr,title:"Last Page",isHidden:null==i||!r,onClick:()=>{null!=i&&l(i-1)}})]})},w=(0,d.Lq)(l.U)(m()),k=(0,d.Lq)(i.hU)(e=>[e.isHidden?"invisible":"visible"])},52737:function(e,n,r){r.r(n),r.d(n,{BanHistory:function(){return Y},BanUserReason:function(){return q},ReasonOptionButton:function(){return T},UserListItem:function(){return Q},default:function(){return D}});var t=r(52322),s=r(28879),a=r.n(s),i=r(77491),l=r.n(i),o=r(2784),d=r(82066),c=r(73796),u=r(4735),x=r(67168),m=r(37160),h=r(16163),g=r(67421),p=r(48212),b=r(23453),v=r(72776),j=r(64648),f=r(27425),y=r(25460),w=r(70749),k=r(26343),N=r(60017),U=r(88255),C=r(93327),P=r(63798),L=r(16231);let S=e=>{let{userId:n}=e,{graphqlClient:r}=(0,L.S)(),{result:t}=(0,P.o)(["ban-reason-history"],async()=>(await r.banReasonHistory({userId:n})).banReasonHistory);return{banReasonHistory:t}};var R=r(63986),A=r(68663),E=r(88082),B=r(14307),M=r(25154),F=r(77967),H=r(5326);a().extend(l());let I=()=>{var e,n,r,s;let[a,i]=(0,E.n)({page:0,admin:!1,usageSubscription:!1,referredUsers:!1,query:"",riskLevel:"all"}),l=(0,R.c)(a.query,500),{result:o,pagination:{page:d,setPage:c,hasNextPage:u,hasPreviousPage:m}}=(0,C.Rm)({input:{usageSubscription:a.usageSubscription,referredUsers:a.referredUsers,banned:"banned"===a.riskLevel,riskLevel:"safe"===a.riskLevel?0:"neutral"===a.riskLevel?.5:"risky"===a.riskLevel?1:null,admin:a.admin,filter:l}}),h=null!==(r=null===(e=o.data)||void 0===e?void 0:e.users)&&void 0!==r?r:[];return(0,t.jsxs)(w.l,{header:"Users",children:[(0,t.jsxs)("div",{className:"mb-4 space-y-4",children:[(0,t.jsx)(g.II,{placeholder:"Filter by name, email, or id",label:{text:"Filter",hidden:!0},value:a.query,onChange:e=>i({query:e.target.value,page:0})}),(0,t.jsxs)("div",{className:"flex items-center justify-between space-x-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 md:flex items-center md:space-x-4 text-sm",children:[(0,t.jsxs)(x.X,{isSelected:a.usageSubscription,onChange:e=>i({usageSubscription:e,page:0}),className:"whitespace-nowrap",children:["Usage ",(0,t.jsx)("span",{className:"hidden md:inline ml-1",children:"Subscription"})]}),(0,t.jsx)(x.X,{isSelected:a.admin,onChange:e=>i({admin:e,page:0}),className:"whitespace-nowrap",children:"Admin"}),(0,t.jsx)(x.X,{isSelected:a.referredUsers,onChange:e=>i({referredUsers:e,page:0}),className:"whitespace-nowrap",children:"Referred users"}),(0,t.jsx)(v.P,{value:a.riskLevel,onChange:e=>i({riskLevel:e,page:0}),label:{text:"Risk level",hidden:!0},options:[{value:"all",text:"Risk Level"},{value:"safe",text:"Safe"},{value:"neutral",text:"Neutral"},{value:"risky",text:"Risky"},{value:"banned",text:"Banned"}]})]}),o.isFetching&&null!=o.data&&(0,t.jsx)(b.gb,{className:"opacity-50"})]})]}),null!=o.data?(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[(0,t.jsx)(j.g,{space:1,className:"mb-8",children:h.map(e=>(0,t.jsx)(Q,{user:e,referredUsersCount:e.referredUsers.length,showProjectCount:!0},e.id))}),(u||m)&&(0,t.jsx)(f.jn,{canPreviousPage:m,canNextPage:u,pageIndex:d,gotoPage:c,previousPage:()=>c(d-1),nextPage:()=>c(d+1)})]}):o.isLoading?(0,t.jsx)(b.bJ,{}):o.isError?(0,t.jsx)(y.y,{children:null!==(s=null===(n=o.error)||void 0===n?void 0:n.message)&&void 0!==s?s:"Problem loading users"}):null]})};var D=I;I.adminOnly=!0;let Q=e=>{var n,r;let{user:s,relativeTime:i,showProjectCount:l,referredUsersCount:o,hideBanButton:x}=e,{modalActions:m}=(0,M.o)(),{adminActions:h}=(0,C.MD)(),g=(0,d.useQueryClient)(),{routes:b}=(0,A.H)(),v=async e=>{e.stopPropagation(),e.preventDefault(),m.openModal((0,t.jsx)(k.u_,{title:"Ban Reason",children:(0,t.jsx)(q,{user:s})}))},f=async e=>{e.stopPropagation(),e.preventDefault(),await h.unban({userId:s.id}),m.createToast((0,t.jsx)(N.FN,{variant:"success",title:"User Unbanned!",description:"".concat(s.email," has been unbanned!")}))};return(0,t.jsxs)(p.r,{onClick:()=>{g.setQueryData((0,C.kN)(s.id),s)},...b.adminUsers({id:s.id}),className:(0,F.AK)("grid items-center gap-3 min-h-[64px] focus:outline-none","px-4 py-2 bg-gray-100 border rounded cursor-pointer","hover:border-pink-500",(null===(n=s.customer)||void 0===n?void 0:n.state)==="ACTIVE"?"bg-pink-100 border-pink-100":null!=s.banReason?"bg-red-100 border-red-100":"bg-gray-100 border-gray-100",s.isAdmin&&"border-yellow-500"),style:{gridTemplateColumns:l?"min-content auto repeat(4, max-content)":"min-content 1fr minmax(min-content, 70px) min-content"},children:[(0,t.jsx)(c.q,{email:s.email,avatar:s.avatar,size:"sm"}),(0,t.jsxs)(j.g,{space:1,align:"start",className:"max-w-full min-w-0",children:[(0,t.jsx)(y.xv,{className:"truncate max-w-full overflow-hidden",children:null!==(r=s.name)&&void 0!==r?r:s.email}),null!=s.name&&(0,t.jsx)(y.Ew,{className:"truncate max-w-full overflow-hidden",children:s.email})]}),null!=o&&(0,t.jsxs)(y.Ew,{className:"hidden md:block",children:[o," ",(0,H._6)("referral",o)]}),l&&(0,t.jsxs)(y.Ew,{className:"hidden md:block",children:[s.projects.length," ",(0,H._6)("project",s.projects.length)]}),(0,t.jsx)(y.Ew,{className:"min-w-7",children:i?a()(s.createdAt).fromNow():a()(s.createdAt).format("YYYY-MM-DD h:mm a")}),!x&&(0,t.jsx)(t.Fragment,{children:null==s.banReason?(0,t.jsx)(u.hU,{icon:B.Tm,title:"Ban user",onClick:v}):(0,t.jsx)(u.hU,{icon:B.WP,title:"Unban user",onClick:f})})]})},q=e=>{let{user:n}=e,[r,s]=(0,o.useState)(""),[a,i]=(0,o.useState)(!1),{adminActions:l}=(0,C.MD)(),{modalActions:d}=(0,M.o)(),c=async()=>{""!==r.trim()&&(i(!0),await l.ban({input:{userId:n.id,reason:r}}),i(!1),d.exitModal(),d.createToast((0,t.jsx)(N.FN,{variant:"success",title:"Hammer Down!",description:"".concat(n.email," as been banned with reason - ").concat(r,"!")})))};return(0,t.jsxs)(h.l0,{onSubmit:c,enableBindings:!0,className:"min-w-sm max-w-lg space-y-5",children:[(0,t.jsx)(y.Wr,{children:"Ban User"}),(0,t.jsxs)(y.xv,{children:["Are you sure you want to ban ",(0,t.jsx)("strong",{children:n.email}),"? This action will ban the user from the platform and notify them via an email."]}),(0,t.jsxs)(j.g,{space:2,children:[(0,t.jsx)(g.II,{name:"reason",id:"reason",label:"Ban reason",placeholder:"Unspecified",value:r,onChange:e=>s(e.target.value)}),(0,t.jsx)(j.U,{className:"flex-wrap",children:U.y.map(e=>(0,t.jsx)(T,{reason:e,onClick:()=>s(e)},e))})]}),(0,t.jsxs)(j.U,{justify:"end",space:3,children:[(0,t.jsx)(u.zx,{color:"gray",type:"button",onClick:()=>d.exitModal(),children:"Cancel"}),(0,t.jsx)(u.zx,{color:"red",disabled:""===r.trim(),isLoading:a,children:"Ban"})]})]})},T=e=>{let{reason:n,onClick:r}=e;return(0,t.jsx)(u.zx,{type:"button",variant:"outline",color:"blue",onClick:r,className:"text-sm max-w-max leading-none mb-2 mr-2",children:n})},Y=e=>{var n,r,s,i;let{userId:l}=e,{banReasonHistory:o}=S({userId:l}),{modalActions:d}=(0,M.o)();return(0,t.jsxs)(j.g,{space:5,children:[(0,t.jsxs)(j.U,{justify:"between",align:"center",children:[(0,t.jsx)(y.Wr,{children:"Ban history"}),o.isFetching&&(0,t.jsx)(b.gb,{})]}),(0,t.jsxs)(j.g,{className:"min-h-[48px] max-h-[360px] overflow-y-auto",children:[(null===(n=o.data)||void 0===n?void 0:n.edges.length)===0&&(0,t.jsx)(y.xv,{children:"This user has not been banned before."}),null===(r=o.data)||void 0===r?void 0:r.edges.map((e,n)=>{var r;let{node:l}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(j.g,{space:1,children:[(0,t.jsx)(y.w4,{className:l.banReason?"text-red-500":"text-green-500",children:null!==(s=l.banReason)&&void 0!==s?s:"Un-banned"}),(0,t.jsxs)(j.U,{space:2,align:"center",children:[(0,t.jsx)(y.Ew,{children:a()(l.createdAt).format("MMM D, YYYY")}),(0,t.jsx)(y.Ew,{children:"\xb7"}),(0,t.jsx)(y.Ew,{children:null!==(i=null===(r=l.actor)||void 0===r?void 0:r.email)&&void 0!==i?i:"Automated system ban"})]})]},l.id),n!==o.data.edges.length-1&&(0,t.jsx)(m.i,{})]})})]}),(0,t.jsx)(j.U,{justify:"end",children:(0,t.jsx)(u.zx,{color:"gray",type:"button",onClick:()=>d.exitModal(),children:"Exit"})})]})}}}]);